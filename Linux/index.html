



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A Material Design theme for MyNotes">
      
      
      
        <meta name="author" content="Anonymous">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.2">
    
    
      
        <title>Linux - Material Design for MyNotes</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
      <link rel="manifest" href="../manifest.webmanifest">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-131093963-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="green" data-md-color-accent="light-green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#linux" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Material Design for MyNotes" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Material Design for MyNotes
            </span>
            <span class="md-header-nav__topic">
              
                Linux
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/Black-Gold/MyNotes/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Black-Gold/MyNotes
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Material Design for MyNotes" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Material Design for MyNotes
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/Black-Gold/MyNotes/" title="前往 Github 仓库" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Black-Gold/MyNotes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Vim/" title="Vim" class="md-nav__link">
      Vim
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Languages
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Languages
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Regex/" title="Regex" class="md-nav__link">
      Regex
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Shell/" title="Shell" class="md-nav__link">
      Shell
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Python3/" title="Python3" class="md-nav__link">
      Python3
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Go/" title="Go" class="md-nav__link">
      Go
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      CloudNative
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        CloudNative
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Docker/" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Kubernetes/" title="Kubernetes" class="md-nav__link">
      Kubernetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Coreos/" title="ContainerOS" class="md-nav__link">
      ContainerOS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Servers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Servers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Linux
      </label>
    
    <a href="./" title="Linux" class="md-nav__link md-nav__link--active">
      Linux
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    系统命令行快捷键
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#centos" class="md-nav__link">
    Centos源设置
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ubuntu-desktop" class="md-nav__link">
    ubuntu Desktop相关设置
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bash" class="md-nav__link">
    BASH环境变量的设置方法：
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linuxjava" class="md-nav__link">
    Linux安装设置java环境
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    分区方案参考
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esnet" class="md-nav__link">
    主机调整 [es.net]
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    优化内核参数 [根据实际情况调整]
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    不常用设置和记录
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    服务器配置双机互信
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centospythonyum" class="md-nav__link">
    centos完全重装python和yum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root" class="md-nav__link">
    普通账号赋予root权限
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-float-ipip" class="md-nav__link">
    未采用双机热备防止服务中断--float IP(浮动IP配置)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centosip" class="md-nav__link">
    安装最新稳定centos内核&amp;更改为静态ip、网卡名称
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssh" class="md-nav__link">
    SSH相关命令和配置
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssh_1" class="md-nav__link">
    ssh基本加固建议
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sedssh" class="md-nav__link">
    sed更改默认ssh连接端口
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sshd_configetcsshsshd_config" class="md-nav__link">
    sshd_config配置详解（/etc/ssh/sshd_config）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh_2" class="md-nav__link">
    SSH端口转发
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    本地转发实例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    远程转发实例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    多主机转发应用实例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    动态转发实例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#x" class="md-nav__link">
    X协议转发实例
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux_1" class="md-nav__link">
    linux磁盘详解
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linux_2" class="md-nav__link">
    Linux文件系统目录
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    添加硬盘或分区流程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_3" class="md-nav__link">
    linux系统引导流程解析
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grub" class="md-nav__link">
    GRUB配置文件讲解：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux_" class="md-nav__link">
    Linux_用户、组和权限
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linux_4" class="md-nav__link">
    Linux用户和用户组
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#r-w-x" class="md-nav__link">
    权限：r, w, x
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    三、管理命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    四、特殊权限
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_5" class="md-nav__link">
    Linux进程管理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux5" class="md-nav__link">
    linux上进程有5种状态
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vsftp" class="md-nav__link">
    Vsftp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bind-dns" class="md-nav__link">
    Bind-DNS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#email" class="md-nav__link">
    Email
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-configure-options" class="md-nav__link">
    Optional Configure Options
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#email_1" class="md-nav__link">
    email安装过程相关问题和配置
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dovecot" class="md-nav__link">
    安装和配置dovecot
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    管理员手册
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell" class="md-nav__link">
    shell脚本笔记
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    杀死进程命令例子
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    统计并杀死僵尸进程例子
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rss" class="md-nav__link">
    进程按rss排序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1pcputid" class="md-nav__link">
    进程按第1列pcpu排序、tid为线程号
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    按进程消耗内存多少排序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_6" class="md-nav__link">
    Linux中查看所有正在运行的进程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-vmware-tools" class="md-nav__link">
    Linux VMware Tools安装步骤简易版
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rm" class="md-nav__link">
    恢复rm误删的文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_7" class="md-nav__link">
    linux常用日志文件默认路径
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1gswap" class="md-nav__link">
    增加1G的swap空间
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_8" class="md-nav__link">
    Linux备份
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_9" class="md-nav__link">
    Linux测试硬盘读写速度
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    获取8位随机字符串
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8_1" class="md-nav__link">
    获取8位随机数字
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    定义一个颜色输出字符串函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    批量创建用户
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bash_1" class="md-nav__link">
    简单检测某个进程是否存在的bash小脚本。代码如下
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell_1" class="md-nav__link">
    shell变量的子串的删除/替换
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    清除大于5天的文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shellcpu" class="md-nav__link">
    shell采集系统cpu 内存 磁盘 网络信息
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpu" class="md-nav__link">
    cpu信息采集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    内存采集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    磁盘信息采集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    网络信息采集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell_2" class="md-nav__link">
    系统管理的常用shell命令
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#openssl" class="md-nav__link">
    openssl
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Utilities/" title="Iproute2&Net-tools" class="md-nav__link">
      Iproute2&Net-tools
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Iptables/" title="Iptables" class="md-nav__link">
      Iptables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Firewalld/" title="Firewalld" class="md-nav__link">
      Firewalld
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Ansible/" title="Ansible" class="md-nav__link">
      Ansible
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Windows/" title="WindowsServer" class="md-nav__link">
      WindowsServer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      WebServer
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        WebServer
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Nginx/" title="Nginx" class="md-nav__link">
      Nginx
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Apache/" title="Apache" class="md-nav__link">
      Apache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tomcat/" title="Tomcat" class="md-nav__link">
      Tomcat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Caddy/" title="Caddy" class="md-nav__link">
      Caddy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Database
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Database
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../MySQL/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MySQL/" title="MariaDB" class="md-nav__link">
      MariaDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Oracle/" title="Oracle" class="md-nav__link">
      Oracle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../MongoDB/" title="MongoDB" class="md-nav__link">
      MongoDB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Redis/" title="Redis" class="md-nav__link">
      Redis
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Memcached/" title="Memcached" class="md-nav__link">
      Memcached
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Monitor
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Monitor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Zabbix/" title="Zabbix" class="md-nav__link">
      Zabbix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Elk/" title="ELKStack" class="md-nav__link">
      ELKStack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Prometheus/" title="Prometheus" class="md-nav__link">
      Prometheus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Grafana/" title="Grafana" class="md-nav__link">
      Grafana
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Nagios/" title="Nagios" class="md-nav__link">
      Nagios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      CI/CD
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        CI/CD
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Git/" title="Git&GitLab" class="md-nav__link">
      Git&GitLab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Jenkins/" title="Jenkins" class="md-nav__link">
      Jenkins
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Cache
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Cache
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Squid/" title="Squid" class="md-nav__link">
      Squid
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Varnish/" title="Varnish" class="md-nav__link">
      Varnish
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Stunnel/" title="Stunnel" class="md-nav__link">
      Stunnel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../TrafficServer/" title="ApacheTraffic" class="md-nav__link">
      ApacheTraffic
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      LB&HA
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        LB&HA
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../LVS/" title="LVS" class="md-nav__link">
      LVS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Haproxy/" title="HAProxy" class="md-nav__link">
      HAProxy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      MessageQueue
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        MessageQueue
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Kafka/" title="Kafka" class="md-nav__link">
      Kafka
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ActiveMQ/" title="ActiveMQ" class="md-nav__link">
      ActiveMQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../RabbitMQ/" title="RabbitMQ" class="md-nav__link">
      RabbitMQ
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      FileSystem
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        FileSystem
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Ceph/" title="Ceph" class="md-nav__link">
      Ceph
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../GlusterFS/" title="GlusterFS" class="md-nav__link">
      GlusterFS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      Network
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        Network
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Cisco/" title="Cisco" class="md-nav__link">
      Cisco
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Monitors/" title="Monitors" class="md-nav__link">
      Monitors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Others/" title="Others" class="md-nav__link">
      Others
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    系统命令行快捷键
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#centos" class="md-nav__link">
    Centos源设置
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ubuntu-desktop" class="md-nav__link">
    ubuntu Desktop相关设置
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bash" class="md-nav__link">
    BASH环境变量的设置方法：
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linuxjava" class="md-nav__link">
    Linux安装设置java环境
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    分区方案参考
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#esnet" class="md-nav__link">
    主机调整 [es.net]
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    优化内核参数 [根据实际情况调整]
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    不常用设置和记录
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    服务器配置双机互信
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centospythonyum" class="md-nav__link">
    centos完全重装python和yum
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#root" class="md-nav__link">
    普通账号赋予root权限
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#-float-ipip" class="md-nav__link">
    未采用双机热备防止服务中断--float IP(浮动IP配置)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centosip" class="md-nav__link">
    安装最新稳定centos内核&amp;更改为静态ip、网卡名称
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ssh" class="md-nav__link">
    SSH相关命令和配置
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssh_1" class="md-nav__link">
    ssh基本加固建议
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sedssh" class="md-nav__link">
    sed更改默认ssh连接端口
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sshd_configetcsshsshd_config" class="md-nav__link">
    sshd_config配置详解（/etc/ssh/sshd_config）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh_2" class="md-nav__link">
    SSH端口转发
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    本地转发实例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    远程转发实例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    多主机转发应用实例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    动态转发实例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#x" class="md-nav__link">
    X协议转发实例
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux_1" class="md-nav__link">
    linux磁盘详解
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linux_2" class="md-nav__link">
    Linux文件系统目录
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    添加硬盘或分区流程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_3" class="md-nav__link">
    linux系统引导流程解析
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grub" class="md-nav__link">
    GRUB配置文件讲解：
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux_" class="md-nav__link">
    Linux_用户、组和权限
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linux_4" class="md-nav__link">
    Linux用户和用户组
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#r-w-x" class="md-nav__link">
    权限：r, w, x
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    三、管理命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    四、特殊权限
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_5" class="md-nav__link">
    Linux进程管理
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux5" class="md-nav__link">
    linux上进程有5种状态
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vsftp" class="md-nav__link">
    Vsftp
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bind-dns" class="md-nav__link">
    Bind-DNS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#email" class="md-nav__link">
    Email
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-configure-options" class="md-nav__link">
    Optional Configure Options
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#email_1" class="md-nav__link">
    email安装过程相关问题和配置
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dovecot" class="md-nav__link">
    安装和配置dovecot
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    管理员手册
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shell" class="md-nav__link">
    shell脚本笔记
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    杀死进程命令例子
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    统计并杀死僵尸进程例子
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rss" class="md-nav__link">
    进程按rss排序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1pcputid" class="md-nav__link">
    进程按第1列pcpu排序、tid为线程号
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    按进程消耗内存多少排序
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_6" class="md-nav__link">
    Linux中查看所有正在运行的进程
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux-vmware-tools" class="md-nav__link">
    Linux VMware Tools安装步骤简易版
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rm" class="md-nav__link">
    恢复rm误删的文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_7" class="md-nav__link">
    linux常用日志文件默认路径
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1gswap" class="md-nav__link">
    增加1G的swap空间
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_8" class="md-nav__link">
    Linux备份
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux_9" class="md-nav__link">
    Linux测试硬盘读写速度
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    获取8位随机字符串
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8_1" class="md-nav__link">
    获取8位随机数字
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    定义一个颜色输出字符串函数
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    批量创建用户
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bash_1" class="md-nav__link">
    简单检测某个进程是否存在的bash小脚本。代码如下
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell_1" class="md-nav__link">
    shell变量的子串的删除/替换
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    清除大于5天的文件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shellcpu" class="md-nav__link">
    shell采集系统cpu 内存 磁盘 网络信息
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpu" class="md-nav__link">
    cpu信息采集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    内存采集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    磁盘信息采集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    网络信息采集
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shell_2" class="md-nav__link">
    系统管理的常用shell命令
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#openssl" class="md-nav__link">
    openssl
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Black-Gold/MyNotes/edit/master/docs/Linux.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="linux">Linux<a class="headerlink" href="#linux" title="Permanent link">&para;</a></h1>
<p>I. stunnel -&gt; varnish -&gt; HAProxy -&gt; nginx -&gt; nodeJS -&gt; memcached(redis) (for session storage[Session 对象存储])</p>
<p>II. Apache Traffic Server/Squid/Vanish + HAProxy + Nginx + memcached(Redis) (for session storage[Session 对象存储])</p>
<p>III. nginx (for HTTP compression) –&gt; Varnish cache (for caching) –&gt; HTTP level load balancer (HAProxy, or nginx, or the Varnish built-in) –&gt; webservers</p>
<h2 id="_1">系统命令行快捷键<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="o">#</span> <span class="err">说明</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">k</span>      <span class="o">#</span> <span class="err">先按住</span> <span class="n">Ctrl</span> <span class="err">键，然后再按</span> <span class="n">k</span> <span class="err">键</span>
<span class="n">Alt</span> <span class="err">–</span> <span class="n">k</span>       <span class="o">#</span> <span class="err">先按住</span> <span class="n">Alt</span> <span class="err">键，然后再按</span> <span class="n">k</span> <span class="err">键</span>
<span class="n">M</span> <span class="err">–</span> <span class="n">k</span>         <span class="o">#</span> <span class="err">先单击</span> <span class="n">Esc</span> <span class="err">键，然后再按</span> <span class="n">k</span> <span class="err">键</span>

<span class="o">#</span> <span class="err">移动光标</span>
<span class="n">Ctrl</span> <span class="o">-</span> <span class="err">左右键</span>  <span class="o">#</span> <span class="err">在单词之间跳转</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">a</span>      <span class="o">#</span> <span class="err">移到行首</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">e</span>      <span class="o">#</span> <span class="err">移到行尾</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">b</span>      <span class="o">#</span> <span class="err">往回</span><span class="p">(</span><span class="err">左</span><span class="p">)</span><span class="err">移动一个字符</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">f</span>      <span class="o">#</span> <span class="err">往后</span><span class="p">(</span><span class="err">右</span><span class="p">)</span><span class="err">移动一个字符</span>
<span class="n">Alt</span> <span class="err">–</span> <span class="n">b</span>       <span class="o">#</span> <span class="err">往回</span><span class="p">(</span><span class="err">左</span><span class="p">)</span><span class="err">移动一个单词</span>
<span class="n">Alt</span> <span class="err">–</span> <span class="n">f</span>       <span class="o">#</span> <span class="err">往后</span><span class="p">(</span><span class="err">右</span><span class="p">)</span><span class="err">移动一个单词</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">xx</span>     <span class="o">#</span> <span class="err">在命令行尾和光标之间移动</span>
<span class="n">M</span><span class="o">-</span><span class="n">b</span>           <span class="o">#</span> <span class="err">往回</span><span class="p">(</span><span class="err">左</span><span class="p">)</span><span class="err">移动一个单词</span>
<span class="n">M</span><span class="o">-</span><span class="n">f</span>           <span class="o">#</span> <span class="err">往后</span><span class="p">(</span><span class="err">右</span><span class="p">)</span><span class="err">移动一个单词</span>

<span class="o">#</span> <span class="err">编辑命令</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">h</span>      <span class="o">#</span> <span class="err">删除光标左方位置的字符</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">d</span>      <span class="o">#</span> <span class="err">删除光标右方位置的字符（注意当前命令行没有任何字符时，会注销系统或结束终端）</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">w</span>      <span class="o">#</span> <span class="err">由光标位置开始，往左删除单词。往行首删</span>
<span class="n">Alt</span> <span class="err">–</span> <span class="n">d</span>       <span class="o">#</span> <span class="err">由光标位置开始，往右删除单词。往行尾删</span>
<span class="n">M</span> <span class="err">–</span> <span class="n">d</span>         <span class="o">#</span> <span class="err">由光标位置开始，删除单词，直到该单词结束</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">k</span>      <span class="o">#</span> <span class="err">由光标所在位置开始，删除右方所有的字符，直到该行结束</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">u</span>      <span class="o">#</span> <span class="err">由光标所在位置开始，删除左方所有的字符，直到该行开始</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">y</span>      <span class="o">#</span> <span class="err">粘贴</span><span class="n">Ctrl</span><span class="o">+</span><span class="n">u或ctrl</span><span class="o">+</span><span class="n">k剪切的内容</span>
<span class="n">ctrl</span> <span class="err">–</span> <span class="n">t</span>      <span class="o">#</span> <span class="err">交换光标处和之前两个字符的位置</span>
<span class="n">Alt</span> <span class="o">+</span> <span class="p">.</span>       <span class="o">#</span> <span class="err">使用上一条命令的最后一个参数</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">_</span>      <span class="o">#</span> <span class="err">回复之前的状态。撤销操作</span>
<span class="n">Ctrl</span> <span class="o">-</span><span class="n">a</span> <span class="o">+</span> <span class="n">Ctrl</span> <span class="o">-</span><span class="n">k</span> <span class="err">或</span> <span class="n">Ctrl</span> <span class="o">-</span><span class="n">e</span> <span class="o">+</span> <span class="n">Ctrl</span> <span class="o">-</span><span class="n">u</span> <span class="err">或</span> <span class="n">Ctrl</span> <span class="o">-</span><span class="n">k</span> <span class="o">+</span> <span class="n">Ctrl</span> <span class="o">-</span><span class="n">u</span> <span class="o">#</span> <span class="err">组合可删除整行</span>

<span class="o">#</span> <span class="err">控制命令</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">l</span>      <span class="o">#</span> <span class="err">清除屏幕，然后，在最上面重新显示目前光标所在的这一行的内容</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">o</span>      <span class="o">#</span> <span class="err">执行当前命令，并选择上一条命令</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">s</span>      <span class="o">#</span> <span class="err">阻止屏幕输出</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">q</span>      <span class="o">#</span> <span class="err">允许屏幕输出</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="k">c</span>      <span class="o">#</span> <span class="err">终止命令</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">z</span>      <span class="o">#</span> <span class="err">挂起命令</span>

<span class="o">#</span> <span class="n">Bang</span><span class="p">(</span><span class="o">!</span><span class="p">)</span><span class="err">命令</span>
<span class="o">!!</span>            <span class="o">#</span> <span class="err">执行上一条命令</span>
<span class="o">^</span><span class="n">foo</span><span class="o">^</span><span class="n">bar</span>      <span class="o">#</span> <span class="err">把上一条命令里的</span><span class="n">foo替换为bar</span><span class="err">，并执行</span>
<span class="o">!</span><span class="n">wget</span>         <span class="o">#</span> <span class="err">执行最近的以</span><span class="n">wget开头的命令</span>
<span class="o">!</span><span class="n">wget</span> <span class="n">p</span>       <span class="o">#</span> <span class="err">仅打印最近的以</span><span class="n">wget开头的命令</span><span class="err">，不执行</span>
<span class="o">!</span><span class="err">$</span>            <span class="o">#</span> <span class="err">上一条命令的最后一个参数，</span> <span class="err">与</span> <span class="n">Alt</span> <span class="o">-</span> <span class="p">.</span> <span class="err">和</span> <span class="err">$</span><span class="n">_</span> <span class="err">相同</span>
<span class="o">!*</span>            <span class="o">#</span> <span class="err">上一条命令的所有参数</span>
<span class="o">!*</span> <span class="n">p</span>          <span class="o">#</span> <span class="err">打印上一条命令是所有参数，也即</span> <span class="o">!*</span><span class="err">的内容</span>
<span class="o">^</span><span class="n">abc</span>          <span class="o">#</span> <span class="err">删除上一条命令中的</span><span class="n">abc</span>
<span class="o">^</span><span class="n">foo</span><span class="o">^</span><span class="n">bar</span>      <span class="o">#</span> <span class="err">将上一条命令中的</span> <span class="n">foo</span> <span class="err">替换为</span> <span class="n">bar</span>
<span class="o">^</span><span class="n">foo</span><span class="o">^</span><span class="n">bar</span><span class="o">^</span>     <span class="o">#</span> <span class="err">将上一条命令中的</span> <span class="n">foo</span> <span class="err">替换为</span> <span class="n">bar</span>
<span class="o">!-</span><span class="n">n</span>           <span class="o">#</span> <span class="err">执行前</span><span class="n">n条命令</span><span class="err">，执行上一条命令</span>      <span class="o">!-</span><span class="mi">1</span><span class="err">，</span> <span class="err">执行前</span><span class="mi">5</span><span class="err">条命令的格式是</span><span class="o">!-</span><span class="mi">5</span>

<span class="o">#</span> <span class="err">查找历史命令</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">p</span>      <span class="o">#</span> <span class="err">显示当前命令的上一条历史命令</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">n</span>      <span class="o">#</span> <span class="err">显示当前命令的下一条历史命令</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="n">r</span>      <span class="o">#</span> <span class="err">搜索历史命令，输入后显示历史命令中一条匹配命令，</span><span class="n">Enter键执行匹配命令</span><span class="err">；</span><span class="n">ESC键在命令行显示而不执行匹配命令</span>
<span class="n">Ctrl</span> <span class="err">–</span> <span class="k">g</span>      <span class="o">#</span> <span class="err">从历史搜索模式（</span><span class="n">Ctrl</span> <span class="err">–</span> <span class="n">r</span><span class="err">）退出</span>

<span class="o">#</span> <span class="err">重复执行操作动作</span>
<span class="n">M</span> <span class="err">–</span> <span class="err">操作次数</span> <span class="err">操作动作</span>   <span class="o">#</span> <span class="err">指定操作次数，重复执行指定的操作</span>
</pre></div>

<h2 id="centos">Centos源设置<a class="headerlink" href="#centos" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="c1"># 更改yum源为阿里云    # 备份</span>
mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup
<span class="c1"># 下载新的对应版本CentOS-Base.repo 到/etc/yum.repos.d/</span>
<span class="c1">## CentOS 5</span>
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-5.repo
curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-5.repo

<span class="c1">## CentOS 6</span>
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo
curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo

<span class="c1">## CentOS 7</span>
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo

<span class="c1"># 更改yum源为163    # 备份</span>
mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup
<span class="c1"># 下载对应版本repo文件, 放入/etc/yum.repos.d/(操作前请做好相应备份)</span>
CentOS5 http://mirrors.163.com/.help/CentOS5-Base-163.repo
CentOS6 http://mirrors.163.com/.help/CentOS6-Base-163.repo
CentOS7 http://mirrors.163.com/.help/CentOS7-Base-163.repo

yum clean all       <span class="c1"># 运行以下命令生成缓存</span>
yum makecache fast  <span class="c1"># 之后运行yum makecache生成缓存</span>
yum -y upgrade  <span class="c1"># 只升级所有包，不升级软件和系统内核</span>
yum -y update   <span class="c1"># 升级所有包同时也升级软件和系统内核</span>

<span class="c1"># 在线安装epel源</span>
rpm -ivh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
yum -y install epel-release
</pre></div>

<h2 id="ubuntu-desktop">ubuntu Desktop相关设置<a class="headerlink" href="#ubuntu-desktop" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>xdotool mouseup <span class="m">1</span> <span class="c1"># 挂起后进入系统输入,然后注销重新登录</span>
gsettings <span class="nb">set</span> com.canonical.unity.launcher launcher-position bottom <span class="c1"># 将ubuntu启动栏移动到最下方</span>
gsettings get com.canonical.unity.launcher launcher-position    <span class="c1"># 得到启动栏位置</span>

<span class="c1"># 设置临时文件不再放置在硬盘加快速度，而放在虚拟RAM磁盘上。总内存必须大于4G</span>
cp -v /usr/share/systemd/tmp.mount /etc/systemd/system/
systemctl <span class="nb">enable</span> tmp.mount
systemctl reload tmp.mount <span class="c1"># 不生效可重启计算机。systemctl status tmp.mount检查状态</span>
<span class="c1"># 取消tmpfs,删除后重启生效</span>
rm -v /etc/systemd/system/tmp.mount

: <span class="s">&lt;&lt; comment</span>
<span class="s"># 减少文件写入(当用于非服务器时)在/etc/fstab写入以下内容：</span>
<span class="s">tmpfs    /tmp        tmpfs    defaults    0  0</span>
<span class="s">tmpfs    /var/tmp    tmpfs    defaults    0  0</span>
<span class="s">tmpfs    /var/log    tmpfs    defaults    0  0</span>
<span class="s">comment</span>

<span class="c1"># 自定义terminal位置和大小</span>
cp /usr/share/applications/gnome-terminal.desktop ~/.local/share/applications
sed -i <span class="s1">&#39;s/^Exec=gnome-terminal$/&amp; --geometry=80x24+100+100/&#39;</span> ~/.local/share/applications/gnome-terminal.desktop
gsettings <span class="nb">set</span> org.gnome.desktop.default-applications.terminal <span class="nb">exec</span> <span class="s1">&#39;gnome-terminal --geometry=80x24+100+100&#39;</span>
<span class="c1"># 删除自定义</span>
rm ~/.local/share/applications/gnome-terminal.desktop
gsettings <span class="nb">set</span> org.gnome.desktop.default-applications.terminal <span class="nb">exec</span> <span class="s1">&#39;gnome-terminal&#39;</span>
</pre></div>

<h2 id="bash">BASH环境变量的设置方法：<a class="headerlink" href="#bash" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="c1"># 方法一：修改用户主目录下的.profile或.bashrc文件(推荐)，在文件末尾加入PATH的设置如下：该方式添加的变量只对当前用户有效</span>
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PATH</span><span class="s2">:your path1:your path2&quot;</span> 

<span class="c1"># 方法二：修改编辑系统目录下的profile文件(谨慎)：在最后加入PATH的设置如下：该方式添加的变量对所有的用户都有效</span>
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PATH</span><span class="s2">:your path1:your path2&quot;</span>

<span class="c1"># 方法三：修改系统目录下的 environment 文件的PATH变量(谨慎),各个path之间冒号分割，影响所有用户</span>

<span class="c1"># 方法四：直接在终端下输入,这种方式变量立即生效，但用户注销或系统重启后设置变成无效，适合临时变量的设置</span>
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PATH</span><span class="s2">:your path1:your path2&quot;</span>

<span class="c1"># 保存后执行source命令生效</span>
</pre></div>

<h2 id="linuxjava">Linux安装设置java环境<a class="headerlink" href="#linuxjava" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="o">#</span> <span class="err">在</span><span class="n">CentOS7安装Oracle</span> <span class="n">Java</span> <span class="n">JDK8</span>
<span class="n">rpm</span> <span class="o">-</span><span class="n">qa</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">E</span> <span class="s1">&#39;^open[jre|jdk]|j[re|dk]&#39;</span>    <span class="o">#</span> <span class="err">查找已安装的</span><span class="n">jdk组件</span>
<span class="n">yum</span> <span class="n">remove</span> <span class="n">java</span><span class="o">-</span><span class="err">$</span><span class="k">Version</span>   <span class="o">#</span> <span class="err">卸载之前已安装的</span><span class="n">jdk</span>
<span class="o">#</span> <span class="err">在</span><span class="o">/</span><span class="n">usr目录创建java文件夹</span><span class="err">，下载</span><span class="n">jdk包http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">oracle</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">technetwork</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">javase</span><span class="o">/</span><span class="n">downloads</span><span class="o">/</span><span class="k">index</span><span class="p">.</span><span class="n">html</span>
<span class="n">mkdir</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">java</span>
<span class="n">wget</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="p">.</span><span class="n">oracle</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">otn</span><span class="o">-</span><span class="n">pub</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">jdk</span><span class="o">/</span><span class="mi">8</span><span class="n">u161</span><span class="o">-</span><span class="n">b12</span><span class="o">/</span><span class="p">...</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">zxvf</span> <span class="n">jdk</span><span class="p">..</span>
<span class="o">#</span> <span class="err">编辑</span><span class="p">.</span><span class="n">bashrc文件</span><span class="err">，在</span><span class="n">export</span> <span class="n">PATH</span> <span class="k">USER</span> <span class="n">LOGNAME</span> <span class="n">MAIL</span> <span class="n">HOSTNAME</span> <span class="n">HISTSIZE</span> <span class="n">HISTCONTROL下面添加如下代码</span><span class="err">：</span>
<span class="n">export</span> <span class="n">JAVA_HOME</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">jdk</span><span class="o">-</span><span class="err">$</span><span class="k">version</span>
<span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="err">$</span><span class="n">JAVA_HOME</span><span class="o">/</span><span class="n">bin</span><span class="p">:</span><span class="err">$</span><span class="n">PATH</span>
<span class="n">export</span> <span class="n">CLASSPATH</span><span class="o">=</span><span class="p">.:</span><span class="err">$</span><span class="n">JAVA_HOME</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">dt</span><span class="p">.</span><span class="n">jar</span><span class="p">:</span><span class="err">$</span><span class="n">JAVA_HOME</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">tools</span><span class="p">.</span><span class="n">jar</span>
<span class="o">#</span> <span class="err">配置生效并验证</span>
<span class="k">source</span> <span class="p">.</span><span class="n">bashrc</span> <span class="o">&amp;&amp;</span> <span class="n">java</span> <span class="c1">--version</span>
</pre></div>

<h2 id="_2">分区方案参考<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th align="center">服务器类型</th>
<th align="center">基本raid方案</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">单机服务器</td>
<td align="center">视数据及性能要求，一般可采用raid5折中</td>
</tr>
<tr>
<td align="center">负载均衡器（如LVS等）</td>
<td align="center">数据量小，重要性高，可采用RAID1</td>
</tr>
<tr>
<td align="center">负载均衡下的RS server</td>
<td align="center">数据量大，重要性不高，有性能要求，数据要求低，可采用RAID0</td>
</tr>
<tr>
<td align="center">数据库服务器</td>
<td align="center">视数据及性能要求主库可采取raid10/raid5，从库可采用raid0提高性能（读写分离的情况下）</td>
</tr>
<tr>
<td align="center">存储服务器</td>
<td align="center">可采取sata盘，raid5</td>
</tr>
<tr>
<td align="center">共享存储服务器（如NFS）</td>
<td align="center">视性能及访问要求可以raid5,raid10,甚至raid0（要有高可用或双写方案）</td>
</tr>
<tr>
<td align="center">监控服务器</td>
<td align="center">单盘或双盘raid1即可。三盘就RAID5，看容量要求加盘即可</td>
</tr>
</tbody>
</table>
<h2 id="esnet">主机调整 [es.net]<a class="headerlink" href="#esnet" title="Permanent link">&para;</a></h2>
<p><a href="http://fasterdata.es.net/performance-testing/troubleshooting">网络故障排查参考</a></p>
<div class="codehilite"><pre><span></span>## 关于超大型数据集传输问题<span class="ss">(</span>引用<span class="nv">es</span>.<span class="nv">net</span><span class="ss">)</span>
在<span class="nv">Unix</span>环境中，<span class="nv">scp</span>，<span class="nv">sftp</span>和<span class="nv">rsync</span>通常用于在主机之间复制数据。虽然这些工具在本地环境中运行良好，但它们在<span class="nv">WAN</span>上的性能很差。<span class="nv">scp</span>和<span class="nv">sftp</span>
的<span class="nv">openssh</span>版本具有内置的<span class="mi">1</span><span class="nv">MB</span>缓冲区，严重限制了<span class="nv">WAN</span>上的性能。尽管<span class="nv">rsync</span>不是<span class="nv">openssh</span>发行版的一部分，但<span class="nv">rsync</span>通常使用<span class="nv">ssh</span>作为传输，因此
受到底层<span class="nv">ssh</span>实现所施加的限制。 如果您需要在<span class="nv">RTT</span>超过<span class="mi">20</span>毫秒的网络路径上传输大型数据集，请不要使用这些工具
匹兹堡超级计算机中心提供了解决<span class="nv">scp</span>和<span class="nv">sftp</span>关于这个问题的补丁：<span class="nv">HPN</span><span class="o">-</span><span class="nv">SSH</span>：<span class="nv">https</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">psc</span>.<span class="nv">edu</span><span class="o">/</span><span class="nv">hpn</span><span class="o">-</span><span class="nv">ssh</span>

# 根据<span class="nv">es</span> <span class="nv">net</span>官网<span class="nv">TCP</span>注意事项
注意：应该单独使用<span class="nv">net</span>.<span class="nv">tcp_mem</span>，因为默认设置没问题。一些性能专家说，还要增加<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">optmem_max</span>以匹配<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">rmem_max</span>
和<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">wmem_max</span>，但我们没有发现这有任何区别。一些专家还说将<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_timestamps</span>和<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_sack</span>设置为<span class="mi">0</span>，
这样做可以减少<span class="nv">CPU</span>负载，但默认值是<span class="mi">1</span>对于性能其实更有帮助

对于较旧的操作系（例如<span class="nv">CentOS5</span><span class="o">/</span><span class="mi">6</span>），增加<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">netdev_max_backlog</span>值也可以提高性能

# <span class="nv">UDP</span>调整

<span class="mi">1</span>. 使用<span class="nv">jumbo</span> <span class="nv">frames</span>在<span class="mi">9</span><span class="nv">k</span> <span class="nv">MTUs</span>下可以使性能提高<span class="mi">4</span><span class="o">-</span><span class="mi">5</span>倍
<span class="mi">2</span>. 数据包大小：最好的性能是<span class="nv">MTU</span>大小减去数据包头大小，例如：<span class="mi">9000</span><span class="nv">Byte</span> <span class="nv">MTU</span>，<span class="nv">ipv4</span>是<span class="mi">8972</span>，<span class="nv">ipv6</span>是<span class="mi">8952</span>
<span class="mi">3</span>. <span class="nv">socket</span>缓存大小：对于<span class="nv">UDP</span>，缓冲区大小与<span class="nv">TCP</span>的方式无关，但默认值仍然不够大。在大多数情况下，将套接字缓冲区设置为<span class="mi">4</span><span class="nv">M</span>似乎有很大帮助
<span class="mi">4</span>. <span class="nv">CPU</span>选择：<span class="mi">10</span><span class="nv">G</span>的<span class="nv">UDP</span>通常是<span class="nv">CPU</span>限制，因此需要考虑内核，尤其在<span class="nv">Sandy</span>或<span class="nv">lvy</span> <span class="nv">Bridge</span>主板

# 虚拟机调整

## <span class="nv">XEN</span>、<span class="nv">KVM</span>类型
要将所有的主机处理器功能传递给<span class="nv">guest</span>虚拟机执行
<span class="nv">qemu</span> <span class="o">-</span><span class="nv">cpu</span> <span class="nv">host</span>

如果希望保留兼容性，则可以向<span class="nv">guest</span>虚拟机公开所选功能。如果所有主机都具有这些功能，则会保留兼容性
<span class="nv">qemu</span> <span class="o">-</span><span class="nv">cpu</span> <span class="nv">qemu64</span>,<span class="o">+</span><span class="nv">ssse3</span>,<span class="o">+</span><span class="nv">sse4</span>.<span class="mi">1</span>,<span class="o">+</span><span class="nv">sse4</span>.<span class="mi">2</span>,<span class="o">+</span><span class="nv">x2apic</span>

要查看主机<span class="nv">CPU</span>与<span class="nv">guest</span>虚拟机功能之间的区别，只需比较每个系统上以下命令的输出
<span class="nv">grep</span> <span class="nv">flags</span> <span class="o">/</span><span class="nv">proc</span><span class="o">/</span><span class="nv">cpuinfo</span> <span class="o">|</span> <span class="nv">uniq</span>

<span class="nv">qemu</span>默认使用用户模式网络<span class="ss">(</span><span class="nv">slirp</span><span class="ss">)</span>，无需事先安装即可在主机使用管理权限，但是很慢，获得高性能可通过<span class="o">-</span><span class="nv">net</span> <span class="nv">tap</span>命令行开关切换到桥接模式
<span class="nv">qemu</span> <span class="o">-</span><span class="nv">net</span> <span class="nv">nic</span>,<span class="nv">model</span> <span class="o">=</span> <span class="nv">virtio</span>,<span class="nv">mac</span><span class="o">=</span>...<span class="o">-</span><span class="nv">net</span> <span class="nv">tap</span>,<span class="nv">ifname</span><span class="o">=</span>...
或
<span class="nv">qemu</span> <span class="o">-</span><span class="nv">net</span> <span class="nv">nic</span>,<span class="nv">model</span> <span class="o">=</span> <span class="nv">virtio</span>,<span class="nv">mac</span><span class="o">=</span>... <span class="o">-</span><span class="nv">net</span> <span class="nv">bridge</span>,<span class="nv">br</span><span class="o">=</span>...,<span class="nv">helper</span><span class="o">=/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">local</span><span class="o">/</span><span class="nv">libexec</span><span class="o">/</span><span class="nv">qemu</span><span class="o">-</span><span class="nv">bridge</span><span class="o">-</span><span class="nv">helper</span>

除了<span class="nv">virtio</span>之外，<span class="nv">vt</span><span class="o">-</span><span class="nv">d</span> <span class="nv">passthrough</span>方法可提供更高的性能
<span class="nv">qemu</span> <span class="o">-</span><span class="nv">net</span> <span class="nv">none</span> <span class="o">-</span><span class="nv">device</span> <span class="nv">vfio</span><span class="o">-</span><span class="nv">pci</span>,<span class="nv">host</span><span class="o">=</span>...

<span class="nv">QEMU</span>支持各种存储格式和后端。最容易使用的是<span class="nv">raw</span>和<span class="nv">qcow2</span>格式，但为了获得最佳性能，最好使用原始分区。创建逻辑卷或分区并将其分配给<span class="nv">guest</span>虚拟机：
<span class="nv">qemu</span> <span class="o">-</span><span class="nv">drive</span> <span class="nv">file</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">mapper</span><span class="o">/</span><span class="nv">ImagesVolumeGroup</span><span class="o">-</span><span class="nv">Guest1</span>,<span class="nv">cache</span><span class="o">=</span><span class="nv">none</span>,<span class="k">if</span><span class="o">=</span><span class="nv">virtio</span>

<span class="nv">QEMU</span>还支持各种缓存模式。如果您使用的是原始卷或分区，最好完全避免缓存，这会减少数据副本和总线流量

<span class="nv">qemu</span> <span class="o">-</span><span class="nv">drive</span> <span class="nv">file</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">mapper</span><span class="o">/</span><span class="nv">ImagesVolumeGroup</span><span class="o">-</span><span class="nv">Guest1</span>,<span class="nv">cache</span><span class="o">=</span><span class="nv">none</span>,<span class="k">if</span><span class="o">=</span><span class="nv">virtio</span>

与网络一样，<span class="nv">QEMU</span>支持多种存储接口。默认值<span class="nv">IDE</span>受到来宾的高度支持，但可能很慢，尤其是磁盘阵列。如果您的<span class="nv">guest</span>虚拟机支持它，请使用<span class="nv">virtio</span>接口
不要在主机上使用<span class="nv">linux</span>文件系统<span class="nv">btrfs</span>来获取图像文件。这将导致低<span class="nv">IO</span>性能。当客户端进行高<span class="nv">IO</span>流量时，<span class="nv">kvm</span> <span class="nv">guest</span>虚拟机甚至可能会冻结

<span class="nv">qemu</span> <span class="o">-</span><span class="nv">drive</span> <span class="nv">file</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">mapper</span><span class="o">/</span><span class="nv">ImagesVolumeGroup</span><span class="o">-</span><span class="nv">Guest1</span>,<span class="nv">cache</span><span class="o">=</span><span class="nv">none</span>,<span class="k">if</span><span class="o">=</span><span class="nv">virtio</span>

## <span class="nv">VMware</span>类型

[<span class="nv">VMware</span>兼容性指南]<span class="ss">(</span><span class="nv">http</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">vmware</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">resources</span><span class="o">/</span><span class="nv">compatibility</span><span class="o">/</span><span class="nv">search</span>.<span class="nv">php</span><span class="ss">)</span>
</pre></div>

<h2 id="_3">优化内核参数 [根据实际情况调整]<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>修改内核参数方法:</p>
<p>echo追加到文件里如：echo "1" &gt;/proc/sys/net/ipv4/tcp_syn_retries，或使用sysctl -w命令，但重启后失效,把参数添加到
/etc/sysctl.conf中，然后执行sysctl -p使参数生效，永久生效。内核生产环境常用优化参数参考，具体优化值要参考应用场景和设备</p>
<div class="codehilite"><pre><span></span># 下列参数设置后，文件所在目录为：<span class="o">/</span><span class="nv">proc</span><span class="o">/</span><span class="nv">sys</span><span class="o">/</span><span class="nv">kernel</span><span class="o">/</span>

# 开启<span class="nv">execshild</span>,即内存缓冲区溢出保护
<span class="nv">kernel</span>.<span class="k">exec</span><span class="o">-</span><span class="nv">shield</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nv">kernel</span>.<span class="nv">randomize_va_space</span> <span class="o">=</span> <span class="mi">1</span>

<span class="nv">kernel</span>.<span class="nv">sysrq</span> <span class="o">=</span> <span class="mi">0</span>    # 控制内核的系统请求调试功能，为安全起见设为<span class="mi">0</span>关闭
<span class="nv">kernel</span>.<span class="nv">core_uses_pid</span> <span class="o">=</span> <span class="mi">1</span>    # 控制核心转储是否将<span class="nv">PID</span>附加到核心文件名,用于调试多线程应用程序。
<span class="nv">kernel</span>.<span class="nv">msgmnb</span> <span class="o">=</span> <span class="mi">65536</span>   # 每个消息队列的大小（单位：字节）限制
<span class="nv">kernel</span>.<span class="nv">msgmax</span> <span class="o">=</span> <span class="mi">65536</span>   # 整个系统最大消息队列数量限制
<span class="nv">kernel</span>.<span class="nv">shmmax</span> <span class="o">=</span> <span class="mi">67108864</span> # 增加分配给<span class="nv">shm</span><span class="ss">(</span>单个共享内存段<span class="ss">)</span>的最大内存量<span class="ss">(</span>单位：字节<span class="ss">)</span>限制，计算公式<span class="mi">64</span><span class="nv">G</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="ss">(</span>字节<span class="ss">)</span>
<span class="nv">kernel</span>.<span class="nv">shmall</span> <span class="o">=</span> <span class="mi">4294967296</span>  # 所有内存大小<span class="ss">(</span>单位：页，<span class="mi">1</span>页 <span class="o">=</span> <span class="mi">4</span><span class="nv">Kb</span><span class="ss">)</span>，计算公式<span class="mi">16</span><span class="nv">G</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="o">/</span><span class="mi">4</span><span class="nv">KB</span><span class="ss">(</span>页<span class="ss">)</span>

# 下列参数设置后，文件所在目录为：<span class="o">/</span><span class="nv">proc</span><span class="o">/</span><span class="nv">sys</span><span class="o">/</span><span class="nv">net</span><span class="o">/</span><span class="nv">bridge</span><span class="o">/</span>

# <span class="nv">bridge</span><span class="o">-</span><span class="nv">nf</span>使得<span class="nv">netfilter</span>可以对<span class="nv">Linux</span>网桥上的<span class="nv">IPv4</span><span class="o">/</span><span class="nv">ARP</span><span class="o">/</span><span class="nv">IPv6</span>包过滤，以下是常用配置，<span class="mi">1</span>代表启用，<span class="mi">0</span>代表不启用
<span class="nv">net</span>.<span class="nv">bridge</span>.<span class="nv">bridge</span><span class="o">-</span><span class="nv">nf</span><span class="o">-</span><span class="nv">call</span><span class="o">-</span><span class="nv">arptables</span> <span class="o">=</span> <span class="mi">0</span>     # 是否启用在<span class="nv">arptables</span>的<span class="nv">FORWARD</span>中过滤网桥的<span class="nv">ARP</span>包<span class="ss">(</span>默认：<span class="mi">0</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">bridge</span>.<span class="nv">bridge</span><span class="o">-</span><span class="nv">nf</span><span class="o">-</span><span class="nv">call</span><span class="o">-</span><span class="nv">ip6tables</span> <span class="o">=</span> <span class="mi">0</span>     # 是否启用在<span class="nv">ip6tables</span>链中过滤<span class="nv">IPv6</span>包<span class="ss">(</span>默认：<span class="mi">0</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">bridge</span>.<span class="nv">bridge</span><span class="o">-</span><span class="nv">nf</span><span class="o">-</span><span class="nv">call</span><span class="o">-</span><span class="nv">iptables</span> <span class="o">=</span> <span class="mi">0</span>      # 是否启用在<span class="nv">iptables</span>链中过滤<span class="nv">IPv4</span>包<span class="ss">(</span>默认：<span class="mi">0</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">bridge</span>.<span class="nv">bridge</span><span class="o">-</span><span class="nv">nf</span><span class="o">-</span><span class="nv">filter</span><span class="o">-</span><span class="nv">vlan</span><span class="o">-</span><span class="nv">tagged</span> <span class="o">=</span> <span class="mi">0</span> # 是否启用在<span class="nv">iptables</span><span class="o">/</span><span class="nv">arptables</span>中过滤打了<span class="nv">vlan</span>标签的包<span class="ss">(</span>默认：<span class="mi">0</span><span class="ss">)</span>

# 下列参数设置后，文件所在目录为：<span class="o">/</span><span class="nv">proc</span><span class="o">/</span><span class="nv">sys</span><span class="o">/</span><span class="nv">net</span><span class="o">/</span><span class="nv">core</span><span class="o">/</span>

<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">rmem_default</span> <span class="o">=</span> <span class="mi">65535</span>   # 为<span class="nv">TCP</span> <span class="nv">socket</span>预留用于接收缓冲的内存默认值（单位：字节）
<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">rmem_max</span> <span class="o">=</span> <span class="mi">25165824</span>     # 为<span class="nv">TCP</span> <span class="nv">socket</span>预留用于接收缓冲的内存最大值（单位：字节）<span class="ss">(</span><span class="mi">24</span><span class="nv">MB</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">wmem_default</span> <span class="o">=</span> <span class="mi">65535</span>   # 为<span class="nv">TCP</span> <span class="nv">socket</span>预留用于发送缓冲的内存默认值（单位：字节）
<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">wmem_max</span> <span class="o">=</span> <span class="mi">25165824</span>     # 为<span class="nv">TCP</span> <span class="nv">socket</span>预留用于发送缓冲的内存最大值（单位：字节）
<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">hot_list_length</span> <span class="o">=</span> <span class="mi">256</span>  # 增加要缓存的<span class="nv">skb</span><span class="o">-</span><span class="nv">heads</span>数目
<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">optmem_max</span> <span class="o">=</span> <span class="mi">40960</span>     # 增加内存缓冲区的最大数量<span class="ss">(</span>默认：<span class="mi">20480</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">busy_poll</span> <span class="o">=</span> <span class="mi">50</span> # 轮询有助于减少网络接收路径中的延迟,允许套接字层代码轮询网络设备的接收队列，并禁用网络中断<span class="ss">(</span>默认：<span class="mi">0</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">netdev_max_backlog</span> <span class="o">=</span> <span class="mi">16384</span> # 当接口接收数据包的速度超过内核可以处理的速度时，增加<span class="nv">incoming</span>连接的数量，<span class="nv">backlog</span>队列设置
                                    在<span class="nv">INPUT</span>端排队的最大数据包数,高负载可以增加该值<span class="ss">(</span>默认：<span class="mi">1000</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">somaxconn</span> <span class="o">=</span> <span class="mi">1024</span>  # 增加<span class="nv">incoming</span>连接数,<span class="nv">somaxconn</span>定义每个<span class="nv">listen</span>调用分配的<span class="nv">request_sock</span>结构的数量。此队列在监听套接字的
                           生命周期中是持久性的,<span class="nv">web</span>应用环境非常有必要调整此值

<span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">default_qdisc</span> <span class="o">=</span> <span class="nv">fq</span>     # 推荐用于<span class="nv">Centos7</span>、<span class="nv">Debian8</span>主机。
                                在<span class="nv">centos5</span>或<span class="mi">6</span>主机需要在<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">local</span>添加：<span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">ifconfig</span> <span class="nv">ethN</span> <span class="nv">txqueuelen</span> <span class="mi">10000</span>
                                <span class="ss">(</span><span class="nv">N</span>代表<span class="mi">10</span><span class="nv">G</span> <span class="nv">NIC</span>的编号，即万兆网卡的系统编号<span class="ss">)</span>

# 下列参数设置后，文件所在目录下：<span class="o">/</span><span class="nv">proc</span><span class="o">/</span><span class="nv">sys</span><span class="o">/</span><span class="nv">fs</span><span class="o">/</span>

<span class="nv">fs</span>.<span class="nv">file</span><span class="o">-</span><span class="nv">max</span> <span class="o">=</span> <span class="mi">2097152</span>    # 增加文件句柄和<span class="nv">inode</span>缓存的大小

# 下列参数设置后，文件所在目录为：<span class="o">/</span><span class="nv">proc</span><span class="o">/</span><span class="nv">sys</span><span class="o">/</span><span class="nv">net</span><span class="o">/</span><span class="nv">ipv4</span><span class="o">/</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">ip_forward</span> <span class="o">=</span> <span class="mi">1</span> # 值为<span class="mi">0</span>表示禁止数据转发，<span class="mi">1</span>则开启
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_no_metrics_save</span> <span class="o">=</span> <span class="mi">1</span>    # 不要在关闭连接时缓存<span class="nv">metrics</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_congestion_control</span> <span class="o">=</span> <span class="nv">cubic</span> # 设置默认拥塞控制算法是<span class="nv">cubic</span>,<span class="ss">(</span>推荐使用<span class="nv">htcp</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_mtu_probing</span> <span class="o">=</span> <span class="mi">1</span>    # 设置主机启用<span class="nv">jumbo</span> <span class="nv">frames</span>，避免<span class="nv">MTU</span>黑洞问题
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_rfc1337</span> <span class="o">=</span> <span class="mi">1</span>    # 防止<span class="nv">TCP</span>时间等待
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">icmp_echo_ignore_broadcasts</span> <span class="o">=</span> <span class="mi">1</span>     # 设置为<span class="mi">1</span>表示忽略<span class="nv">icmp</span>广播请求,避免放大攻击
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">icmp_ignore_bogus_error_responses</span> <span class="o">=</span> <span class="mi">1</span>      # 开启恶意<span class="nv">icmp</span>错误消息保护
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">icmp_echo_ignore_all</span> <span class="o">=</span> <span class="mi">1</span>    # 忽略所有<span class="nv">icmp</span>请求,即关闭<span class="nv">ping</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_keepalive_time</span> <span class="o">=</span> <span class="mi">600</span>   # <span class="nv">TCP</span>发送<span class="nv">keepalive</span>消息的频率<span class="ss">(</span>单位：秒<span class="ss">)</span>,用于确认<span class="nv">TCP</span>连接是否有效，防止建立连接但不发送数据的攻击
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_keepalive_probes</span> <span class="o">=</span> <span class="mi">5</span>   # 发送<span class="nv">keepalive</span>消息超时之前的探测次数    # 默认值：<span class="mi">9</span>，推荐<span class="mi">5</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_keepalive_intvl</span> <span class="o">=</span> <span class="mi">15</span>   # 确定了<span class="nv">isAlive</span>间隔探测之间的等待时间   <span class="ss">(</span>默认<span class="mi">75</span><span class="nv">s</span>,建议<span class="mi">15</span><span class="o">-</span><span class="mi">30</span><span class="nv">s</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_retries1</span> <span class="o">=</span> <span class="mi">3</span>   # 放弃回应一个<span class="nv">TCP</span>连接请求前进行重试的次数。<span class="nv">RFC</span>规定值最低为<span class="mi">3</span>，默认值为<span class="mi">3</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_retries2</span> <span class="o">=</span> <span class="mi">5</span>   # 在丢弃激活已建立通讯状况的<span class="nv">TCP</span>连接之前﹐需要进行多少次重试。默认值为<span class="mi">15</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_orphan_retries</span> <span class="o">=</span> <span class="mi">3</span> # 本地丢弃<span class="nv">TCP</span>连接前进行的重试次数，默认<span class="mi">7</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_abort_on_overflow</span> <span class="o">=</span> <span class="mi">0</span>  # 守护进程过于繁忙不能接受新的连接时，就发送<span class="nv">reset</span>信息，默认<span class="mi">0</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_syncookies</span> <span class="o">=</span> <span class="mi">1</span> # 开启<span class="nv">SYN</span> <span class="nv">Cookies</span>，当出现<span class="nv">SYN</span>等待队列溢出时，启用<span class="nv">cookies</span>来处理，可以做<span class="nv">SYN</span>洪水攻击保护<span class="ss">(</span>默认：<span class="mi">0</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_stdurg</span> <span class="o">=</span> <span class="mi">0</span> # 默认使用<span class="nv">tcp</span> <span class="nv">urg</span> <span class="nv">pointer</span>字段中的主机请求解释功能，打开可能导致不能正常通信<span class="ss">(</span>默认：<span class="mi">0</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_window_scaling</span> <span class="o">=</span> <span class="mi">1</span> # 支持更大的<span class="nv">TCP</span><span class="o">/</span><span class="nv">ip</span>会话的滑动窗口,如果<span class="nv">TCP</span>窗口最大超过<span class="mi">65535</span><span class="ss">(</span><span class="mi">64</span><span class="nv">K</span><span class="ss">)</span>, 必须设置该数值为<span class="mi">1</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_timestamps</span> <span class="o">=</span> <span class="mi">1</span> # 可防范伪造的<span class="nv">sequence</span>号码，启用实现更好的网络性能<span class="ss">(</span>默认：<span class="mi">1</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_sack</span> <span class="o">=</span> <span class="mi">1</span>   # 开启有选择的应答,用于查看特定的遗失数据包，用于快速恢复连接状态<span class="ss">(</span>默认<span class="mi">1</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_fack</span> <span class="o">=</span> <span class="mi">1</span>  # 打开<span class="nv">fack</span>拥塞避免和快速重传功能，注意：当<span class="nv">tcp_sack</span>设置为<span class="mi">0</span>时，此值设置<span class="mi">1</span>也是无效的<span class="ss">(</span>默认：<span class="mi">1</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_dsack</span> <span class="o">=</span> <span class="mi">1</span> # 允许<span class="nv">TCP</span>发送<span class="s2">&quot;</span><span class="s">两个完全相同</span><span class="s2">&quot;</span>的<span class="nv">SACK</span><span class="ss">(</span>默认：<span class="mi">1</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_ecn</span> <span class="o">=</span> <span class="mi">0</span>   # <span class="nv">TCP</span>的直接拥塞通告功能<span class="ss">(</span>默认：<span class="mi">0</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_reordering</span> <span class="o">=</span> <span class="mi">5</span> # <span class="nv">TCP</span>流中重排序的数据报最大数量。一般推荐把这个数值略微调整大一些<span class="ss">(</span>默认：<span class="mi">3</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_retrans_collapse</span> <span class="o">=</span> <span class="mi">0</span>  # 对于某些有<span class="nv">bug</span>的打印机提供针对其<span class="nv">bug</span>的兼容性。一般不需要这个支持,可以关闭它<span class="ss">(</span>默认：<span class="mi">1</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_app_win</span> <span class="o">=</span> <span class="mi">31</span>   # 保留<span class="nv">max_window</span><span class="o">/</span><span class="mi">2</span><span class="o">^</span><span class="nv">tcp_app_win</span>数量的用于应用缓存，<span class="mi">0</span>表示不需要缓存<span class="ss">(</span>默认：<span class="mi">31</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_adv_win_scale</span> <span class="o">=</span> <span class="mi">2</span>  # 计算缓冲开销<span class="ss">(</span>默认：<span class="mi">2</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_low_latency</span> <span class="o">=</span> <span class="mi">0</span>    # 允许<span class="nv">tcp</span><span class="o">/</span><span class="nv">ip</span>栈在高吞吐下低延迟，一般禁用，但在<span class="nv">beowulf</span>集群中打开很有帮助<span class="ss">(</span>默认：<span class="mi">0</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_westwood</span> <span class="o">=</span> <span class="mi">0</span>   # 启用发送端的拥塞控制算法，可对带宽利用情况进行优化<span class="ss">(</span>默认：<span class="mi">0</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_bic</span> <span class="o">=</span> <span class="mi">0</span>    # 为快速长距离网络启用<span class="nv">binary</span> <span class="nv">increase</span> <span class="nv">congestion</span>；可更好利用<span class="ss">(</span>默认：<span class="mi">0</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">ip_local_port_range</span> <span class="o">=</span> <span class="mi">1024</span> <span class="mi">65000</span>   # 对外连接端口范围，<span class="nv">RHEL</span> <span class="mi">7</span> <span class="nv">default</span>: <span class="mi">32768</span> <span class="mi">61000</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">ip_conntrack_max</span> <span class="o">=</span> <span class="mi">65536</span>   # 系统最大支持的<span class="nv">ipv4</span>连接数<span class="ss">(</span>默认：<span class="mi">65536</span><span class="ss">)</span>，但如果内存<span class="mi">128</span><span class="nv">M</span>以下，最大只有<span class="mi">8192</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_syn_retries</span> <span class="o">=</span> <span class="mi">3</span>        # 在内核放弃建立连接之前发送<span class="nv">SYN</span>包的数量,此值不应大于<span class="mi">255</span>，默认是<span class="mi">5</span>，高负载物理
                                    通信良好时，建议为<span class="mi">2</span>，此值仅针对对外连接，对进来的连接则由<span class="nv">tcp_retries</span>决定
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_synack_retries</span> <span class="o">=</span> <span class="mi">2</span> # 对于远端的连接请求<span class="nv">SYN</span>，内核会发送<span class="nv">SYN</span><span class="o">+</span><span class="nv">ACK</span>数据包以确认收到上一个<span class="nv">SYN</span>请求。即三次握手的第二次握手。
                                此设置决定内核放弃连接之前发送<span class="nv">SYN</span><span class="o">+</span><span class="nv">ACK</span>包的数量，不应大于<span class="mi">255</span>，默认为<span class="mi">5</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_fin_timeout</span> <span class="o">=</span> <span class="mi">15</span>   # 此参数决定了<span class="nv">TCP</span>连接保持在<span class="nv">FIN</span><span class="o">-</span><span class="k">WAIT</span><span class="o">-</span><span class="mi">2</span>状态的时间，<span class="ss">(</span>默认<span class="mi">60</span><span class="nv">s</span>，建议<span class="mi">15</span><span class="o">-</span><span class="mi">30</span><span class="nv">s</span><span class="ss">)</span>对于生成或支持高级别网络
                                流量的工作负载或系统，此值设置到<span class="mi">10</span>秒以下
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_max_syn_backlog</span> <span class="o">=</span> <span class="mi">2048</span> # 记录尚未收到客户端确认信息的连接请求的最大值，内存大于<span class="mi">128</span><span class="nv">Mb</span>默认<span class="mi">1024</span>，内存小于<span class="mi">128</span>时，则值
                                      默认时<span class="mi">128</span>,服务器过载时可增加此值
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_limit_output_bytes</span> <span class="o">=</span> <span class="mi">131072</span> # 默认是<span class="mi">262144</span>字节；限制设备上的字节数，以减少较大队列大小导致的延迟效应；对于延迟优先
                                         级高于吞吐量的工作负载或环境，降低此值可以改善延迟，推荐<span class="mi">131072</span>字节

# 增加<span class="nv">time</span><span class="o">-</span><span class="nv">wait</span>存储池大小可防止简单<span class="nv">DOS</span>攻击
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_max_tw_buckets</span> <span class="o">=</span> <span class="mi">1440000</span> # 指定允许在任何时间存在的“<span class="nv">time</span><span class="o">-</span><span class="k">wait</span>”状态的最大<span class="nv">sockets</span>数。如果超过最大值，则会立即销毁处于
                                    “<span class="nv">time</span><span class="o">-</span><span class="k">wait</span>”状态的套接字并显示警告。此设置用于阻止某些类型的拒绝服务攻击。在降低此值之前应小心
                                    谨慎。更改后，应增加其值，尤其是在系统中添加了更多内存或网络需求较高且环境较少受外部威胁影响时
                                    默认<span class="mi">262144</span>，当网络需求很高且环境较少受到外部威胁时，可以增加到<span class="mi">450000</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_tw_recycle</span> <span class="o">=</span> <span class="mi">1</span> # 开启<span class="nv">TCP</span>连接中<span class="nv">time_wait</span> <span class="nv">sockets</span>的快速回收,默认为<span class="mi">0</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_tw_reuse</span> <span class="o">=</span> <span class="mi">1</span>   # 开启<span class="nv">TCP</span>连接复用，允许将<span class="nv">time_wait</span> <span class="nv">sockets</span>重新用于新的<span class="nv">TCP</span>连接<span class="ss">(</span>主要针对<span class="nv">time_wait</span>连接<span class="ss">)</span>启用后，此参数
                            可以绕过通常与套接字创建相关的分配和初始化开销，从而节省<span class="nv">CPU</span>周期，系统负载和时间
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_max_orphans</span> <span class="o">=</span> <span class="mi">32768</span>  # 告诉内核有多少<span class="nv">TCP</span>套接字未附加到系统保留的任何用户文件句柄的最大数量,如果超过此数量，则立即重置
                                    孤立连接并打印警告。此限制仅用于防止简单的<span class="nv">DoS</span>攻击，但不能人为地依赖此限制或降低限制，而是增加
                                    它（可能在增加已安装的内存之后），如果网络条件需要超过默认值，调整网络服务以延迟并更积极地杀死
                                    这些状态。再次提醒：每个<span class="nv">orphan</span>都会吃掉大约<span class="mi">64</span><span class="nv">K</span>的<span class="nv">unswappable</span>内存<span class="ss">(</span>默认：<span class="mi">8192</span><span class="ss">)</span>

# 增加读取缓冲区空间
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">udp_rmem_min</span> <span class="o">=</span> <span class="mi">16384</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_rmem</span> <span class="o">=</span> <span class="mi">4096</span> <span class="mi">87380</span> <span class="mi">25165824</span> # 三个值表示<span class="nv">TCP</span>套接字接收缓冲区的最小值、默认值和最大值

# 增加可分配的写缓冲区空间
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">udp_wmem_min</span> <span class="o">=</span> <span class="mi">16384</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_wmem</span> <span class="o">=</span> <span class="mi">4096</span> <span class="mi">65536</span> <span class="mi">25165824</span> # 三个参数依次为：最小值，默认值和最大值；最小值表示新创建的
                                            套接字作为其创建的一部分有权获得的最小接收缓冲区大小；默认值表示<span class="nv">TCP</span>套接字接收缓冲区的
                                            初始大小；最大值表示<span class="nv">TCP</span>套接字的自动调整发送缓冲区的最大接收缓冲区大小，该值不会覆盖
                                            <span class="nv">net</span>.<span class="nv">core</span>.<span class="nv">rmem_max</span>。根据系统中可用的内存量，此设置的默认值介于<span class="mi">64</span><span class="nv">K</span>字节和<span class="mi">4</span><span class="nv">M</span>字节之间。
                                            建议使用<span class="mi">16</span><span class="nv">M</span>字节或更高的最大值（取决于内核级别），尤其是<span class="mi">10</span>千兆位适配器

# 增加可分配的最大总缓冲区空间,此为以<span class="nv">page</span>为单位（<span class="mi">4096</span>字节）测量
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">udp_mem</span> <span class="o">=</span> <span class="mi">65536</span> <span class="mi">131072</span> <span class="mi">262144</span>  
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">tcp_mem</span> <span class="o">=</span> <span class="mi">65536</span> <span class="mi">131072</span> <span class="mi">262144</span>  # 第一次低于此值,<span class="nv">TCP</span>没有内存压力,第二次进入内存压力阶段,
                                        第三次<span class="nv">TCP</span>拒绝分配<span class="nv">socket</span><span class="ss">(</span>默认：<span class="mi">5814</span> <span class="mi">7754</span> <span class="mi">11628</span><span class="ss">)</span>

# 下列参数设置后，文件所在目录及其目录下：<span class="o">/</span><span class="nv">proc</span><span class="o">/</span><span class="nv">sys</span><span class="o">/</span><span class="nv">net</span><span class="o">/</span><span class="nv">ipv4</span><span class="o">/</span><span class="nv">conf</span><span class="o">/</span>

#启用源路由核查功能，反向路径过滤
# <span class="mi">0</span> ——未进行源验证
# <span class="mi">1</span> ——处于如 <span class="nv">RFC3704</span> 所定义的严格模式
# <span class="mi">2</span> ——处于如 <span class="nv">RFC3704</span> 所定义的松散模式
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">conf</span>.<span class="nv">all</span>.<span class="nv">rp_filter</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">conf</span>.<span class="nv">default</span>.<span class="nv">rp_filter</span> <span class="o">=</span> <span class="mi">1</span>

# 确保无人能修改路由表
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">conf</span>.<span class="nv">all</span>.<span class="nv">accept_redirects</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">conf</span>.<span class="nv">all</span>.<span class="nv">secure_redirects</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">conf</span>.<span class="nv">default</span>.<span class="nv">accept_redirects</span> <span class="o">=</span> <span class="mi">0</span>  # 禁止<span class="nv">icmp</span>重定向检查
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">conf</span>.<span class="nv">default</span>.<span class="nv">secure_redirects</span> <span class="o">=</span> <span class="mi">0</span>

# 不充当路由器
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">conf</span>.<span class="nv">all</span>.<span class="nv">send_redirects</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">conf</span>.<span class="nv">default</span>.<span class="nv">send_redirects</span> <span class="o">=</span> <span class="mi">0</span>

# 记录在不可达的地址的数据包<span class="ss">(</span>错误的路由<span class="ss">)</span>；开启并记录欺骗、源路由、重定向数据包
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">conf</span>.<span class="nv">all</span>.<span class="nv">log_martians</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">conf</span>.<span class="nv">default</span>.<span class="nv">log_martians</span> <span class="o">=</span> <span class="mi">1</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">conf</span>.<span class="nv">all</span>.<span class="nv">accept_source_route</span> <span class="o">=</span> <span class="mi">0</span>   # 处理无源路由的包
<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">conf</span>.<span class="nv">default</span>.<span class="nv">accept_source_route</span> <span class="o">=</span> <span class="mi">0</span>   # 禁用所有<span class="nv">IP</span>源路由

# 下列参数设置后，文件所在目录下：<span class="o">/</span><span class="nv">proc</span><span class="o">/</span><span class="nv">sys</span><span class="o">/</span><span class="nv">net</span><span class="o">/</span><span class="nv">ipv4</span><span class="o">/</span><span class="nv">route</span><span class="o">/</span>

<span class="nv">net</span>.<span class="nv">ipv4</span>.<span class="nv">route</span>.<span class="nv">gc_timeout</span> <span class="o">=</span> <span class="mi">100</span>     # 路由刷新频率

# 下列参数设置后，文件所在目录下<span class="ss">(</span>防火墙相关<span class="ss">)</span>：<span class="o">/</span><span class="nv">proc</span><span class="o">/</span><span class="nv">sys</span><span class="o">/</span><span class="nv">net</span><span class="o">/</span><span class="nv">netfilter</span><span class="o">/</span>

# <span class="nv">nf_conntrack</span>是<span class="nv">Linux</span>内核连接跟踪的模块：与<span class="nv">nf_conntrack</span>相关的内核参数有三个：
# <span class="mi">1</span>、<span class="nv">nf_conntrack_max</span>：连接跟踪表的大小，建议根据内存计算该值<span class="nv">CONNTRACK_MAX</span> <span class="o">=</span> <span class="nv">RAMSIZE</span> <span class="ss">(</span><span class="nv">in</span> <span class="nv">bytes</span><span class="ss">)</span> <span class="o">/</span> <span class="mi">16384</span> <span class="o">/</span> <span class="ss">(</span><span class="nv">x</span> <span class="o">/</span> <span class="mi">32</span><span class="ss">)</span>，
     并满足<span class="nv">nf_conntrack_max</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="nv">nf_conntrack_buckets</span>，默认<span class="mi">262144</span>
# <span class="mi">2</span>、<span class="nv">nf_conntrack_buckets</span>：哈希表的大小，<span class="ss">(</span><span class="nv">nf_conntrack_max</span><span class="o">/</span><span class="nv">nf_conntrack_buckets</span>就是每条哈希记录链表的长度<span class="ss">)</span>，默认<span class="mi">65536</span>
# <span class="mi">3</span>、<span class="nv">nf_conntrack_tcp_timeout_established</span>：<span class="nv">tcp</span>会话的超时时间，默认：<span class="mi">432000</span> <span class="ss">(</span><span class="mi">5</span>天<span class="ss">)</span>

# 以下为<span class="mi">64</span>内存推荐配置
<span class="nv">net</span>.<span class="nv">nf_conntrack_max</span> <span class="o">=</span> <span class="mi">262144</span>
<span class="nv">net</span>.<span class="nv">netfilter</span>.<span class="nv">nf_conntrack_max</span> <span class="o">=</span> <span class="mi">65536</span>   # 系统支持的最大<span class="nv">ipv4</span>连接数<span class="ss">(</span>默认：<span class="mi">65536</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">netfilter</span>.<span class="nv">nf_conntrack_tcp_timeout_established</span> <span class="o">=</span> <span class="mi">300</span> # 已建立的<span class="nv">tcp</span>连接超时时间<span class="ss">(</span>默认：<span class="mi">43200</span>，即<span class="mi">5</span>天<span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">netfilter</span>.<span class="nv">nf_conntrack_buckets</span> <span class="o">=</span> <span class="mi">1048576</span><span class="ss">(</span>默认：<span class="mi">65535</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">netfilter</span>.<span class="nv">nf_conntrack_tcp_timeout_time_wait</span> <span class="o">=</span> <span class="mi">30</span>  # <span class="nv">time_wait</span>状态超时时间，超过该时间就清除该连接<span class="ss">(</span>默认：<span class="mi">120</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">netfilter</span>.<span class="nv">nf_conntrack_tcp_timeout_close_wait</span> <span class="o">=</span> <span class="mi">60</span>  # <span class="nv">close_wait</span>状态超时时间，超过该时间就清除该连接<span class="ss">(</span>默认：<span class="mi">60</span><span class="ss">)</span>
<span class="nv">net</span>.<span class="nv">netfilter</span>.<span class="nv">nf_conntrack_tcp_timeout_fin_wait</span> <span class="o">=</span> <span class="mi">30</span>    # <span class="nv">fin_wait</span>状态超时时间，超过该时间就清除该连接<span class="ss">(</span>默认：<span class="mi">120</span><span class="ss">)</span>
</pre></div>

<h2 id="_4">不常用设置和记录<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="_5">服务器配置双机互信<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1"># 服务器1的IP：192.168.1.1   服务器2的IP：192.168.1.2</span>
<span class="c1"># 在两台服务器上分别按照以下步骤操作</span>
ssh-keygen -t rsa -b <span class="m">4096</span>   <span class="c1"># 创建公钥和密钥</span>
cat ~/.ssh/id_rsa.pub &gt;&gt; authorized_keys    <span class="c1"># 将自己的公钥追加到认证公钥</span>

<span class="c1"># 将公钥互相复制到对应的主机</span>
<span class="c1"># 方法一:使用ssh-copy-id命令</span>
ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.2 <span class="c1"># 在1主机执行，复制公钥到远程主机192.168.1.2,cat追加公钥到authorized_keys</span>
ssh-copy-id -i /root/.ssh/id_rsa.pub root@192.168.1.1 <span class="c1"># 在2主机执行，复制公钥到远程主机192.168.1.1,cat追加公钥到authorized_keys</span>

<span class="c1"># 方法二：使用ssh命令并用cat追加到authorized_keys中</span>
ssh <span class="m">192</span>.168.1.2 cat ~/.ssh/id_rsa.pub &gt;&gt; authorized_keys    <span class="c1"># 在服务器1上操作，将服务器2的公钥追加到认证公钥</span>
ssh <span class="m">192</span>.168.1.1 cat ~/.ssh/id_rsa.pub &gt;&gt; authorized_keys    <span class="c1"># 在服务器2上操作，将服务器1的公钥追加到认证公钥</span>
ssh <span class="m">192</span>.168.1.2 ifconfig    <span class="c1"># 测试,在服务器1上执行下面的命令，如果配置正确的话就无需输入密码也能显示服务器2的网卡信息</span>
</pre></div>

<h3 id="centospythonyum">centos完全重装python和yum<a class="headerlink" href="#centospythonyum" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1"># 删除现有Python</span>
rpm -qa<span class="p">|</span>grep python<span class="p">|</span> xargs rpm -ev --allmatches --nodeps <span class="c1"># 强制删除已安装程序及其关联</span>
whereis python <span class="p">|</span> xargs rm -frv <span class="c1"># 删除所有残余文件,xargs，允许你对输出执行其他某些命令</span>
whereis python <span class="c1"># 验证删除，返回无结果</span>

<span class="c1"># 删除现有的yum</span>
rpm -qa<span class="p">|</span>grep yum<span class="p">|</span> xargs rpm -ev --allmatches --nodeps
whereis yum <span class="p">|</span> xargs rm -frv

<span class="c1"># 从http://mirrors.aliyun.com/centos/7/os/x86_64/Packages/下载相应的包,由于源中版本会更新，具体请查看URL中的版本！</span>
rpm -Uvh --replacepkgs *.rpm    <span class="c1"># 可能之间还需要zlib和zlib-devel包，根据情况下载并安装！安装完进行测试</span>

<span class="c1"># 源码编译安装yum</span>
wget http://yum.baseurl.org/download/3.4/yum-3.4.3.tar.gz
tar xvf yum-3.4.3.tar.gz <span class="o">&amp;&amp;</span> <span class="nb">cd</span> yum-3.4.3
yummain.py install yum
<span class="c1"># 如果结果提示错误： CRITICAL:yum.cli:Config Error: Error accessing file for config file:///etc/缺少配置文件</span>
<span class="c1"># 在etc目录下面新建yum.conf文件，然后再次运行 yummain.py install yum，顺利完成安装</span>
</pre></div>

<h3 id="root">普通账号赋予root权限<a class="headerlink" href="#root" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1"># 建议使用方法二，不要轻易使用方法三</span>
: <span class="s">&lt;&lt; comment</span>
<span class="s"># 方法一： 修改 /etc/sudoers 文件，找到%wheel一行，把前面的注释（#）去掉</span>
<span class="s">Allows people in group wheel to run all commands</span>
<span class="s">%wheel    ALL=(ALL)    ALL</span>
<span class="s">然后修改用户，使其属于root组（wheel），命令如下：</span>
<span class="s">#usermod -g root tommy</span>
<span class="s">修改完毕，现在可以用tommy帐号登录，然后用命令 sudo su - ，即可获得root权限进行操作</span>
<span class="s">comment</span>

: <span class="s">&lt;&lt; comment</span>
<span class="s"># 方法二： 修改 /etc/sudoers 文件，找到root一行，在root下面添加一行，如下所示：</span>
<span class="s">Allow root to run any commands anywhere</span>
<span class="s">root    ALL=(ALL)     ALL</span>
<span class="s">tommy   ALL=(ALL)     ALL</span>
<span class="s">修改完毕，现在可以用tommy帐号登录，然后用命令 sudo su - ，即可获得root权限进行操作</span>
<span class="s">comment</span>

: <span class="s">&lt;&lt; comment</span>
<span class="s"># 方法三： 修改 /etc/passwd 文件，找到如下行，把用户ID修改为 0 ，如下所示：</span>
<span class="s">tommy:x:500:500:tommy:/home/tommy:/bin/bash</span>
<span class="s">修改后如下</span>
<span class="s">tommy:x:0:500:tommy:/home/tommy:/bin/bash</span>
<span class="s">保存，用tommy账户登录后，直接获取的就是root帐号的权限</span>
<span class="s">comment</span>
</pre></div>

<h3 id="-float-ipip">未采用双机热备防止服务中断--float IP(浮动IP配置)<a class="headerlink" href="#-float-ipip" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>: <span class="s">&lt;&lt; comment</span>
<span class="s">有两台Linux服务器，其中一台主机（IP：192.168.2.2）对外提供了一定的网络服务，另一台从机（IP：192.168.2.3）能提供相同的服务，但IP地址</span>
<span class="s">没有对外部公开,客户端连接的都是192.168.2.2这个IP地址，如果主机故障，则会使网络服务暂时中断</span>
<span class="s">由于没有采用双机热备份技术,考虑用Linux脚本来实现简单的浮动IP技术，当主机故障时从机获得192.168.2.2这个IP，暂时替代主机提供服务，当主机</span>
<span class="s">恢复时，从机自动释放这个IP</span>
<span class="s">思路：</span>
<span class="s">利用单个网卡绑定多个IP地址的技术和crontab自动执行技术</span>
<span class="s">为主机的网卡多绑定一个静态IP，如192.168.2.8,这个地址便于从机判断的</span>
<span class="s">为从机的网卡多绑定一个动态IP，127.0.0.1，它在主机故障时将会被脚本修改为192.168.2.2</span>
<span class="s">在从机上添加一个脚本 /root/autoFloatIP.sh，使用crontab技术让这个脚本每分钟执行一次，这个脚本的作用是判断主机的地址192.168.2.8能否</span>
<span class="s">Ping通，一旦不正常则将让自己的网卡多余的那个IP地址改为192.168.2.2，如果主机恢复，则将这个地址改回为127.0.0.1</span>
<span class="s">comment</span>
<span class="c1"># 步骤如下：</span>
<span class="c1"># 1. 为主机添加一个静态IP192.168.2.8，在/etc/sysconfig/network-scripts目录修改类似ifcfg-eth0:1的文件，内容为:</span>
<span class="nv">DEVICE</span><span class="o">=</span>eth0:1
<span class="nv">IPADDR</span><span class="o">=</span><span class="m">139</span>.24.214.82
<span class="nv">NETMASK</span><span class="o">=</span> <span class="m">255</span>.255.255.0
<span class="nv">ONBOOT</span><span class="o">=</span> yes

<span class="c1"># 2. 在从机上，在/root下建立一个脚本autoFloatIP.sh,内容如下：</span>

<span class="c1">#!/bin/bash</span>
<span class="nv">c1</span><span class="o">=</span><span class="k">$(</span>ping <span class="m">139</span>.24.214.82 -c <span class="m">1</span><span class="p">|</span>grep Unreachable<span class="p">|</span>wc -l<span class="k">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$c1</span> -gt <span class="m">0</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
<span class="nv">c2</span><span class="o">=</span><span class="k">$(</span>ping <span class="m">139</span>.24.214.82 -c <span class="m">10</span><span class="p">|</span>grep Unreachable<span class="p">|</span>wc -l<span class="k">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$c2</span> -gt <span class="m">9</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
    <span class="nv">c3</span><span class="o">=</span><span class="k">$(</span>ping <span class="m">139</span>.24.214.22 -c <span class="m">10</span><span class="p">|</span>grep Unreachable<span class="p">|</span>wc -l<span class="k">)</span>
      <span class="k">if</span> <span class="o">[</span> <span class="nv">$c3</span> -gt <span class="m">9</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
         /sbin/ifconfig eth0:1 <span class="m">139</span>.24.214.22 netmask <span class="m">255</span>.255.254.0
<span class="nb">echo</span> <span class="s2">&quot;float ip to 22&quot;</span>
      <span class="k">fi</span>
<span class="k">fi</span>
<span class="nb">echo</span> <span class="s2">&quot;can not connect&quot;</span>
<span class="k">else</span>
<span class="nv">c4</span><span class="o">=</span><span class="k">$(</span>/sbin/ifconfig<span class="p">|</span>grep <span class="m">139</span>.24.214.22<span class="p">|</span>wc -l<span class="k">)</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$c4</span> -gt <span class="m">0</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
    /sbin/ifconfig eth0:2 <span class="m">127</span>.0.0.1 netmask <span class="m">255</span>.255.254.0
    <span class="nb">echo</span> <span class="s2">&quot;reset ip&quot;</span>
<span class="k">fi</span>
<span class="nb">echo</span> <span class="s2">&quot;connection is ok&quot;</span>
<span class="k">fi</span>

<span class="c1"># 其中关键的命令如下，用这个方法来动态修改IP，动态IP在电脑重启会消失</span>
/sbin/ifconfig eth0:1 <span class="m">139</span>.24.214.22 netmask <span class="m">255</span>.255.254.0
/sbin/ifconfig eth0:2 <span class="m">127</span>.0.0.1 netmask <span class="m">255</span>.255.254.0

<span class="c1"># 3. 从机上建立crontab，加上如下一行并保存</span>
* * * * * /root/autoFloatIP.sh &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</pre></div>

<h3 id="centosip">安装最新稳定centos内核&amp;更改为静态ip、网卡名称<a class="headerlink" href="#centosip" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1"># 在CentOS主机上安装最新的稳定内核</span>
<span class="c1"># 导入key（内核3.0以上需要导入key）,如果已经修改了repo的gpgcheck=0也可以不导入key</span>
rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
<span class="c1"># To install ELRepo for RHEL-6, SL-6 or CentOS-6</span>
rpm -Uvh http://www.elrepo.org/elrepo-release-6-8.el6.elrepo.noarch.rpm
<span class="c1"># 安装elrepo的yum源,To install ELRepo for RHEL-7, SL-7 or CentOS-7</span>
rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm
<span class="c1"># 安装内核,在yum的ELRepo源中，有mainline颁布的，可以这样安装</span>
yum --enablerepo<span class="o">=</span>elrepo-kernel install  kernel-ml-devel kernel-ml -y

yum --enablerepo<span class="o">=</span>elrepo-kernel  install  kernel-lt -y   <span class="c1"># 安装long term的内核</span>

<span class="c1"># 配置Grub使用新内核，配置完后重启启用新内核</span>
<span class="c1">## CentOS 6配置，修改/boot/grub/grub.conf </span>
  <span class="nv">default</span><span class="o">=</span><span class="m">0</span> <span class="c1"># 更改为 0 </span>
  <span class="nv">fallback</span><span class="o">=</span><span class="m">1</span> <span class="c1"># 添加此项</span>

<span class="c1">## CentOS 7</span>
grub2-set-default <span class="m">0</span>
grub2-install /dev/sda
grub2-mkconfig -o /boot/grub2/grub.cfg

<span class="c1"># 更改为静态IP：/etc/sysconfig/network-scripts/ifcfg-ens33</span>
<span class="nv">BOOTPROTO</span><span class="o">=</span><span class="s2">&quot;static&quot;</span> <span class="c1">#dhcp改为static</span>
<span class="nv">ONBOOT</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span> <span class="c1">#开机启用本配置</span>
<span class="nv">IPADDR</span><span class="o">=</span><span class="m">192</span>.168.7.106 <span class="c1">#静态IP</span>
<span class="nv">GATEWAY</span><span class="o">=</span><span class="m">192</span>.168.7.1 <span class="c1">#默认网关</span>
<span class="nv">NETMASK</span><span class="o">=</span><span class="m">255</span>.255.255.0 <span class="c1">#子网掩码</span>
<span class="nv">DNS1</span><span class="o">=</span><span class="m">192</span>.168.7.1 <span class="c1">#DNS 配置</span>

vim /etc/sysconfig/grub     <span class="c1"># 编辑 grub 配置文件,实际是/etc/default/grub的软连接</span>
<span class="c1"># 为GRUB_CMDLINE_LINUX变量增加2个参数，具体内容如下(加粗)：</span>
<span class="nv">GRUB_CMDLINE_LINUX</span><span class="o">=</span><span class="s2">&quot;crashkernel=auto rd.lvm.lv=cl/root rd.lvm.lv=cl/swap net.ifnames=0 biosdevname=0 rhgb quiet&quot;</span>
<span class="c1"># 重新生成 grub 配置文件，然后重新启动 Linux 操作系统，通过 ip addr 可以看到网卡名称已经变为 eth0 </span>
grub2-mkconfig -o /boot/grub2/grub.cfg
<span class="c1"># 修改网卡配置文件，原网卡配置文件名称为 ifcfg-ens33，这里需要修改为ethx的格式，并适当调整网卡配置文件</span>
mv /etc/sysconfig/network-scripts/ifcfg-ens33 /etc/sysconfig/network-scripts/ifcfg-eth0
<span class="c1"># 修改ifcfg-eth0文件如下内容(其它内容不变)</span>
<span class="nv">NAME</span><span class="o">=</span>eth0
<span class="nv">DEVICE</span><span class="o">=</span>eth0

systemctl restart network.service    <span class="c1"># 重启网络服务，注意：ifcfg-ens33 文件最好删除掉，否则重启 network 服务时候会报错</span>
</pre></div>

<h2 id="ssh">SSH相关命令和配置<a class="headerlink" href="#ssh" title="Permanent link">&para;</a></h2>
<h3 id="ssh_1">ssh基本加固建议<a class="headerlink" href="#ssh_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="err">使用非密码登陆方式如密钥对，请忽略此项。在</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">login</span><span class="p">.</span><span class="n">defs</span> <span class="err">中将</span> <span class="n">PASS_MAX_DAYS</span> <span class="err">参数设置为</span> <span class="mi">60</span><span class="o">-</span><span class="mi">180</span><span class="err">之间，</span>
<span class="err">如</span> <span class="n">PASS_MAX_DAYS</span> <span class="mi">90</span><span class="err">。需同时执行命令设置</span><span class="n">root密码失效时间</span><span class="err">：</span> <span class="n">chage</span> <span class="c1">--maxdays 90 root</span>

<span class="err">在</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">login</span><span class="p">.</span><span class="n">defs</span> <span class="err">中将</span> <span class="n">PASS_MIN_DAYS</span> <span class="err">参数设置为</span><span class="mi">7</span><span class="o">-</span><span class="mi">14</span><span class="err">之间</span><span class="p">,</span><span class="err">建议为</span><span class="mi">7</span><span class="err">：</span> <span class="n">PASS_MIN_DAYS</span> <span class="mi">7</span> <span class="err">需同时执行命令</span>
<span class="err">为</span><span class="n">root用户设置</span><span class="err">：</span> <span class="n">chage</span> <span class="c1">--mindays 7 root</span>

<span class="err">编辑</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="k">security</span><span class="o">/</span><span class="n">pwquality</span><span class="p">.</span><span class="n">conf</span><span class="err">，把</span><span class="n">minlen</span><span class="err">（密码最小长度）设置为</span><span class="mi">9</span><span class="o">-</span><span class="mi">32</span><span class="err">位，把</span><span class="n">minclass</span><span class="err">（至少包含小写字母、</span>
<span class="err">大写字母、数字、特殊字符等</span><span class="mi">4</span><span class="err">类字符中等</span><span class="mi">3</span><span class="err">类或</span><span class="mi">4</span><span class="err">类）设置为</span><span class="mi">3</span><span class="err">或</span><span class="mi">4</span><span class="err">。如：</span> <span class="n">minlen</span><span class="o">=</span><span class="mi">10</span> <span class="n">minclass</span><span class="o">=</span><span class="mi">3</span>
</pre></div>

<h3 id="sedssh">sed更改默认ssh连接端口<a class="headerlink" href="#sedssh" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>iptables -I INPUT -p tcp --dport <span class="m">22</span> -j ACCEPT <span class="c1"># iptables开放22端口</span>
sed -i <span class="s2">&quot;/A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT/d&quot;</span> /etc/sysconfig/iptables
iptables save
service iptables restart

sed -i <span class="s1">&#39;s/#Port 22/Port 2121/&#39;</span> /etc/ssh/sshd_config     <span class="c1"># 修改sshd_config文件，将#Port 22直接替换成Port 2121</span>
</pre></div>

<h3 id="sshd_configetcsshsshd_config">sshd_config配置详解（/etc/ssh/sshd_config）<a class="headerlink" href="#sshd_configetcsshsshd_config" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span># <span class="nv">The</span> <span class="nv">strategy</span> <span class="nv">used</span> <span class="k">for</span> <span class="nv">options</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">default</span> <span class="nv">sshd_config</span> <span class="nv">shipped</span> <span class="nv">with</span>
# <span class="nv">OpenSSH</span> <span class="nv">is</span> <span class="nv">to</span> <span class="nv">specify</span> <span class="nv">options</span> <span class="nv">with</span> <span class="nv">their</span> <span class="nv">default</span> <span class="nv">value</span> <span class="nv">where</span>
# <span class="nv">possible</span>, <span class="nv">but</span> <span class="nv">leave</span> <span class="nv">them</span> <span class="nv">commented</span>.  <span class="nv">Uncommented</span> <span class="nv">options</span> <span class="nv">override</span> <span class="nv">the</span>
# <span class="nv">default</span> <span class="nv">value</span>

#
# <span class="nv">AddressFamily</span>指定<span class="nv">sshd</span>应当使用哪种地址族。取值范围是：<span class="s2">&quot;</span><span class="s">any</span><span class="s2">&quot;</span><span class="ss">(</span>默认<span class="ss">)</span>、<span class="s2">&quot;</span><span class="s">inet</span><span class="s2">&quot;</span><span class="ss">(</span>仅<span class="nv">IPv4</span><span class="ss">)</span>、<span class="s2">&quot;</span><span class="s">inet6</span><span class="s2">&quot;</span><span class="ss">(</span>仅<span class="nv">IPv6</span><span class="ss">)</span>
#<span class="nv">AddressFamily</span> <span class="nv">any</span>

# 指定<span class="nv">sshd</span>监听的网络地址，默认监听所有地址。可以使用下面的格式：
# <span class="nv">ListenAddress</span> <span class="nv">host</span><span class="o">|</span><span class="nv">IPv4_addr</span><span class="o">|</span><span class="nv">IPv6_addr</span>
# <span class="nv">ListenAddress</span> <span class="nv">host</span><span class="o">|</span><span class="nv">IPv4_addr</span>:<span class="nv">port</span>
# <span class="nv">ListenAddress</span> [<span class="nv">host</span><span class="o">|</span><span class="nv">IPv6_addr</span>]:<span class="nv">port</span>
# 如果未指定 <span class="nv">port</span> ，那么将使用 <span class="nv">Port</span> 指令的值
# 可以使用多个 <span class="nv">ListenAddress</span> 指令监听多个地址
#<span class="nv">ListenAddress</span> <span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">0</span>.<span class="mi">0</span>
#<span class="nv">ListenAddress</span> ::

# <span class="nv">HostKey</span>
# 主机私钥文件的位置。如果权限不对，<span class="nv">sshd</span>可能会拒绝启动
# <span class="nv">SSH</span><span class="o">-</span><span class="mi">1</span>默认是 <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ssh</span><span class="o">/</span><span class="nv">ssh_host_key</span> 
# <span class="nv">SSH</span><span class="o">-</span><span class="mi">2</span>默认是 <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ssh</span><span class="o">/</span><span class="nv">ssh_host_rsa_key</span> 和 <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ssh</span><span class="o">/</span><span class="nv">ssh_host_dsa_key</span> 
# 一台主机可以拥有多个不同的私钥。<span class="s2">&quot;</span><span class="s">rsa1</span><span class="s2">&quot;</span>仅用于<span class="nv">SSH</span><span class="o">-</span><span class="mi">1</span>，<span class="s2">&quot;</span><span class="s">dsa</span><span class="s2">&quot;</span>和<span class="s2">&quot;</span><span class="s">rsa</span><span class="s2">&quot;</span>仅用于<span class="nv">SSH</span><span class="o">-</span><span class="mi">2</span>
#<span class="nv">HostKey</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ssh</span><span class="o">/</span><span class="nv">ssh_host_rsa_key</span>
#<span class="nv">HostKey</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ssh</span><span class="o">/</span><span class="nv">ssh_host_ecdsa_key</span>
#<span class="nv">HostKey</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ssh</span><span class="o">/</span><span class="nv">ssh_host_ed25519_key</span>

# 指定<span class="nv">SSH</span><span class="o">-</span><span class="mi">2</span>允许使用的加密算法。多个算法之间使用逗号分隔。可以使用的算法如下：
# <span class="s2">&quot;</span><span class="s">aes128-cbc</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">aes192-cbc</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">aes256-cbc</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">aes128-ctr</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">aes192-ctr</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">aes256-ctr</span><span class="s2">&quot;</span>,
# <span class="s2">&quot;</span><span class="s">3des-cbc</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">arcfour128</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">arcfour256</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">arcfour</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">blowfish-cbc</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">cast128-cbc</span><span class="s2">&quot;</span>
# 默认值是可以使用上述所有算法
# <span class="nv">Ciphers</span> <span class="nv">and</span> <span class="nv">keying</span>
#<span class="nv">RekeyLimit</span> <span class="nv">default</span> <span class="nv">none</span>

# 指定<span class="nv">sshd</span>将日志消息通过哪个日志子系统<span class="ss">(</span><span class="nv">facility</span><span class="ss">)</span>发送。有效值是：<span class="nv">DAEMON</span>, <span class="nv">USER</span>, <span class="nv">AUTH</span><span class="ss">(</span>默认<span class="ss">)</span>, <span class="nv">LOCAL0</span>, <span class="nv">LOCAL1</span>, <span class="nv">LOCAL2</span>, <span class="nv">LOCAL3</span>, 
# <span class="nv">LOCAL4</span>, <span class="nv">LOCAL5</span>, <span class="nv">LOCAL6</span>, <span class="nv">LOCAL7</span>
# <span class="nv">Logging</span>
#<span class="nv">SyslogFacility</span> <span class="nv">AUTH</span>

# 指定 <span class="nv">sshd</span><span class="ss">(</span><span class="mi">8</span><span class="ss">)</span> 的日志等级<span class="ss">(</span>详细程度<span class="ss">)</span>。可用值如下：
# <span class="nv">QUIET</span>, <span class="nv">FATAL</span>, <span class="nv">ERROR</span>, <span class="nv">INFO</span><span class="ss">(</span>默认<span class="ss">)</span>, <span class="nv">VERBOSE</span>, <span class="nv">DEBUG</span>, <span class="nv">DEBUG1</span>, <span class="nv">DEBUG2</span>, <span class="nv">DEBUG3</span>
# <span class="nv">DEBUG</span> 与 <span class="nv">DEBUG1</span> 等价；<span class="nv">DEBUG2</span> 和 <span class="nv">DEBUG3</span> 则分别指定了更详细、更罗嗦的日志输出
# 比 <span class="nv">DEBUG</span> 更详细的日志可能会泄漏用户的敏感信息，因此反对使用
#<span class="nv">LogLevel</span> <span class="nv">INFO</span>

# <span class="nv">Authentication</span>:

# 限制用户必须在指定的时限内认证成功，<span class="mi">0</span> 表示无限制。默认值是 <span class="mi">120</span> 秒
#<span class="nv">LoginGraceTime</span> <span class="mi">2</span><span class="nv">m</span>

# 是否允许 <span class="nv">root</span> 登录。可用值如下：
# <span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span><span class="ss">(</span>默认<span class="ss">)</span> 表示允许。<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>表示禁止
# <span class="s2">&quot;</span><span class="s">without-password</span><span class="s2">&quot;</span>表示禁止使用密码认证登录
# <span class="s2">&quot;</span><span class="s">forced-commands-only</span><span class="s2">&quot;</span>表示只有在指定了<span class="nv">command</span>选项时才允许使用公钥认证登录。同时其它认证方法全部被禁止。该值常用于做远程备份之类的事情
#<span class="nv">PermitRootLogin</span> <span class="nv">prohibit</span><span class="o">-</span><span class="nv">password</span>

# 指定是否要求<span class="nv">sshd</span>在接受连接请求前对用户主目录和相关的配置文件进行宿主和权限检查。强烈建议使用默认值<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>来预防可能出现的低级错误
#<span class="nv">StrictModes</span> <span class="nv">yes</span>

# 指定每个连接最大允许的认证次数。默认值是 <span class="mi">6</span> 
# 如果失败认证的次数超过这个数值的一半，连接将被强制断开，且会生成额外的失败日志消息
#<span class="nv">MaxAuthTries</span> <span class="mi">6</span>

#<span class="nv">MaxSessions</span> <span class="mi">10</span>

# 是否允许公钥认证。仅可以用于<span class="nv">SSH</span><span class="o">-</span><span class="mi">2</span>。默认值为<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>
#<span class="nv">PubkeyAuthentication</span> <span class="nv">yes</span>

######################################################################################################################

# 存放该用户可以用来登录的 <span class="nv">RSA</span><span class="o">/</span><span class="nv">DSA</span> 公钥
# 该指令中可以使用下列根据连接时的实际情况进行展开的符号：
# <span class="o">%%</span> 表示<span class="s1">&#39;</span><span class="s">%</span><span class="s1">&#39;</span>、<span class="o">%</span><span class="nv">h</span> 表示用户的主目录、<span class="o">%</span><span class="nv">u</span> 表示该用户的用户名
# 经过扩展之后的值必须要么是绝对路径，要么是相对于用户主目录的相对路径
# 默认值是<span class="s2">&quot;</span><span class="s">.ssh/authorized_keys</span><span class="s2">&quot;</span>
# <span class="nv">Expect</span> .<span class="nv">ssh</span><span class="o">/</span><span class="nv">authorized_keys2</span> <span class="nv">to</span> <span class="nv">be</span> <span class="nv">disregarded</span> <span class="nv">by</span> <span class="nv">default</span> <span class="nv">in</span> <span class="nv">future</span>
#<span class="nv">AuthorizedKeysFile</span> .<span class="nv">ssh</span><span class="o">/</span><span class="nv">authorized_keys</span> .<span class="nv">ssh</span><span class="o">/</span><span class="nv">authorized_keys2</span>

######################################################################################################################

#<span class="nv">AuthorizedPrincipalsFile</span> <span class="nv">none</span>

#<span class="nv">AuthorizedKeysCommand</span> <span class="nv">none</span>
#<span class="nv">AuthorizedKeysCommandUser</span> <span class="nv">nobody</span>

# 是否使用强可信主机认证<span class="ss">(</span>通过检查远程主机名和关联的用户名进行认证<span class="ss">)</span>。仅用于<span class="nv">SSH</span><span class="o">-</span><span class="mi">1</span>
# 这是通过在<span class="nv">RSA</span>认证成功后再检查 <span class="o">~/</span>.<span class="nv">rhosts</span> 或 <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">hosts</span>.<span class="nv">equiv</span> 进行认证的
# 出于安全考虑，建议使用默认值<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>
#<span class="nv">RhostsRSAAuthentication</span>

# 这个指令与 <span class="nv">RhostsRSAAuthentication</span> 类似，但是仅可以用于<span class="nv">SSH</span><span class="o">-</span><span class="mi">2</span>。推荐使用默认值<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>
# 推荐使用默认值<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>禁止这种不安全的认证方式
# <span class="k">For</span> <span class="nv">this</span> <span class="nv">to</span> <span class="nv">work</span> <span class="nv">you</span> <span class="nv">will</span> <span class="nv">also</span> <span class="nv">need</span> <span class="nv">host</span> <span class="nv">keys</span> <span class="nv">in</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ssh</span><span class="o">/</span><span class="nv">ssh_known_hosts</span>
#<span class="nv">HostbasedAuthentication</span> <span class="nv">no</span>

#<span class="nv">HostbasedUsesNameFromPacketOnly</span>
# 在开启 <span class="nv">HostbasedAuthentication</span> 的情况下，
# 指定服务器在使用 <span class="o">~/</span>.<span class="nv">shosts</span> <span class="o">~/</span>.<span class="nv">rhosts</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">hosts</span>.<span class="nv">equiv</span> 进行远程主机名匹配时，是否进行反向域名查询
# <span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>表示<span class="nv">sshd</span>信任客户端提供的主机名而不进行反向查询。默认值是<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>

# 是否在 <span class="nv">RhostsRSAAuthentication</span> 或 <span class="nv">HostbasedAuthentication</span> 过程中忽略用户的 <span class="o">~/</span>.<span class="nv">ssh</span><span class="o">/</span><span class="nv">known_hosts</span> 文件
# 默认值是<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>。为了提高安全性，可以设为<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>
# <span class="nv">Change</span> <span class="nv">to</span> <span class="nv">yes</span> <span class="k">if</span> <span class="nv">you</span> <span class="nv">don</span><span class="s1">&#39;</span><span class="s">t trust ~/.ssh/known_hosts for</span>
# <span class="nv">HostbasedAuthentication</span>
#<span class="nv">IgnoreUserKnownHosts</span> <span class="nv">no</span>

# 是否在 <span class="nv">RhostsRSAAuthentication</span> 或 <span class="nv">HostbasedAuthentication</span> 过程中忽略 .<span class="nv">rhosts</span> 和 .<span class="nv">shosts</span> 文件
# 不过 <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">hosts</span>.<span class="nv">equiv</span> 和 <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">shosts</span>.<span class="nv">equiv</span> 仍将被使用。推荐设为默认值<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>
# <span class="nv">Don</span><span class="s1">&#39;</span><span class="s">t read the user</span><span class="s1">&#39;</span><span class="nv">s</span> <span class="o">~/</span>.<span class="nv">rhosts</span> <span class="nv">and</span> <span class="o">~/</span>.<span class="nv">shosts</span> <span class="nv">files</span>
#<span class="nv">IgnoreRhosts</span> <span class="nv">yes</span>


# <span class="nv">To</span> <span class="nv">disable</span> <span class="nv">tunneled</span> <span class="nv">clear</span> <span class="nv">text</span> <span class="nv">passwords</span>, <span class="nv">change</span> <span class="nv">to</span> <span class="nv">no</span> <span class="nv">here</span><span class="o">!</span>

# 是否允许使用基于密码的认证。默认为<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>
#<span class="nv">PasswordAuthentication</span> <span class="nv">yes</span>

# 是否允许密码为空的用户远程登录。默认为<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>
#<span class="nv">PermitEmptyPasswords</span> <span class="nv">no</span>

# 是否允许质疑<span class="o">-</span>应答<span class="ss">(</span><span class="nv">challenge</span><span class="o">-</span><span class="nv">response</span><span class="ss">)</span>认证。默认值是<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>
# 所有 <span class="nv">login</span>.<span class="nv">conf</span><span class="ss">(</span><span class="mi">5</span><span class="ss">)</span> 中允许的认证方式都被支持
# <span class="nv">Change</span> <span class="nv">to</span> <span class="nv">yes</span> <span class="nv">to</span> <span class="nv">enable</span> <span class="nv">challenge</span><span class="o">-</span><span class="nv">response</span> <span class="nv">passwords</span> <span class="ss">(</span><span class="nv">beware</span> <span class="nv">issues</span> <span class="nv">with</span>
# <span class="nv">some</span> <span class="nv">PAM</span> <span class="nv">modules</span> <span class="nv">and</span> <span class="nv">threads</span><span class="ss">)</span>
<span class="nv">ChallengeResponseAuthentication</span> <span class="nv">no</span>

# <span class="nv">Kerberos</span> <span class="nv">options</span>

# 是否要求用户为 <span class="nv">PasswordAuthentication</span> 提供的密码必须通过 <span class="nv">Kerberos</span> <span class="nv">KDC</span> 认证，也就是是否使用<span class="nv">Kerberos</span>认证
# 要使用<span class="nv">Kerberos</span>认证，服务器需要一个可以校验 <span class="nv">KDC</span> <span class="nv">identity</span> 的 <span class="nv">Kerberos</span> <span class="nv">servtab</span> 。默认值是<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>
#<span class="nv">KerberosAuthentication</span> <span class="nv">no</span>

# 如果 <span class="nv">Kerberos</span> 密码认证失败，那么该密码还将要通过其它的认证机制<span class="ss">(</span>比如 <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">passwd</span><span class="ss">)</span>
# 默认值为<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>
#<span class="nv">KerberosOrLocalPasswd</span> <span class="nv">yes</span>

# 是否在用户退出登录后自动销毁用户的 <span class="nv">ticket</span> 。默认值是<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>
#<span class="nv">KerberosTicketCleanup</span> <span class="nv">yes</span>

# 如果使用了 <span class="nv">AFS</span> 并且该用户有一个 <span class="nv">Kerberos</span> <span class="mi">5</span> <span class="nv">TGT</span>，那么开启该指令后，
# 将会在访问用户的家目录前尝试获取一个 <span class="nv">AFS</span> <span class="nv">token</span> 。默认为<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>
#<span class="nv">KerberosGetAFSToken</span> <span class="nv">no</span>

# <span class="nv">GSSAPI</span> <span class="nv">options</span>

# 是否允许使用基于 <span class="nv">GSSAPI</span> 的用户认证。默认值为<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>。仅用于<span class="nv">SSH</span><span class="o">-</span><span class="mi">2</span>
#<span class="nv">GSSAPIAuthentication</span> <span class="nv">no</span>

# 是否在用户退出登录后自动销毁用户凭证缓存。默认值是<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>。仅用于<span class="nv">SSH</span><span class="o">-</span><span class="mi">2</span>
#<span class="nv">GSSAPICleanupCredentials</span> <span class="nv">yes</span>


#<span class="nv">GSSAPIStrictAcceptorCheck</span> <span class="nv">yes</span>
#<span class="nv">GSSAPIKeyExchange</span> <span class="nv">no</span>

# <span class="nv">Set</span> <span class="nv">this</span> <span class="nv">to</span> <span class="s1">&#39;</span><span class="s">yes</span><span class="s1">&#39;</span> <span class="nv">to</span> <span class="nv">enable</span> <span class="nv">PAM</span> <span class="nv">authentication</span>, <span class="nv">account</span> <span class="nv">processing</span>,
# <span class="nv">and</span> <span class="nv">session</span> <span class="nv">processing</span>. <span class="k">If</span> <span class="nv">this</span> <span class="nv">is</span> <span class="nv">enabled</span>, <span class="nv">PAM</span> <span class="nv">authentication</span> <span class="nv">will</span>
# <span class="nv">be</span> <span class="nv">allowed</span> <span class="nv">through</span> <span class="nv">the</span> <span class="nv">ChallengeResponseAuthentication</span> <span class="nv">and</span>
# <span class="nv">PasswordAuthentication</span>.  <span class="nv">Depending</span> <span class="nv">on</span> <span class="nv">your</span> <span class="nv">PAM</span> <span class="nv">configuration</span>,
# <span class="nv">PAM</span> <span class="nv">authentication</span> <span class="nv">via</span> <span class="nv">ChallengeResponseAuthentication</span> <span class="nv">may</span> <span class="nv">bypass</span>
# <span class="nv">the</span> <span class="nv">setting</span> <span class="nv">of</span> <span class="s2">&quot;</span><span class="s">PermitRootLogin without-password</span><span class="s2">&quot;</span>
# <span class="k">If</span> <span class="nv">you</span> <span class="nv">just</span> <span class="nv">want</span> <span class="nv">the</span> <span class="nv">PAM</span> <span class="nv">account</span> <span class="nv">and</span> <span class="nv">session</span> <span class="nv">checks</span> <span class="nv">to</span> <span class="nv">run</span> <span class="nv">without</span>
# <span class="nv">PAM</span> <span class="nv">authentication</span>, <span class="k">then</span> <span class="nv">enable</span> <span class="nv">this</span> <span class="nv">but</span> <span class="nv">set</span> <span class="nv">PasswordAuthentication</span>
# <span class="nv">and</span> <span class="nv">ChallengeResponseAuthentication</span> <span class="nv">to</span> <span class="s1">&#39;</span><span class="s">no</span><span class="s1">&#39;</span>
<span class="nv">UsePAM</span> <span class="nv">yes</span>

#<span class="nv">AllowAgentForwarding</span> <span class="nv">yes</span>

# 是否允许<span class="nv">TCP</span>转发，默认值为<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>
# 禁止<span class="nv">TCP</span>转发并不能增强安全性，除非禁止了用户对<span class="nv">shell</span>的访问，因为用户可以安装他们自己的转发器
#<span class="nv">AllowTcpForwarding</span> <span class="nv">yes</span>

######################################################################################################################

# <span class="nv">GatewayPorts</span>
# 是否允许远程主机连接本地的转发端口。默认值是<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>
# <span class="nv">sshd</span><span class="ss">(</span><span class="mi">8</span><span class="ss">)</span> 默认将远程端口转发绑定到<span class="nv">loopback</span>地址。这样将阻止其它远程主机连接到转发端口
# <span class="nv">GatewayPorts</span> 指令可以让 <span class="nv">sshd</span> 将远程端口转发绑定到非<span class="nv">loopback</span>地址，这样就可以允许远程主机连接了
# <span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>表示仅允许本地连接，<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>表示强制将远程端口转发绑定到统配地址<span class="ss">(</span><span class="nv">wildcard</span> <span class="nv">address</span><span class="ss">)</span>，
# <span class="s2">&quot;</span><span class="s">clientspecified</span><span class="s2">&quot;</span>表示允许客户端选择将远程端口转发绑定到哪个地址
#<span class="nv">GatewayPorts</span> <span class="nv">no</span>

######################################################################################################################

# 是否允许进行 <span class="nv">X11</span> 转发。默认值是<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>，设为<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>表示允许
# 如果允许<span class="nv">X11</span>转发并且<span class="nv">sshd</span><span class="ss">(</span><span class="mi">8</span><span class="ss">)</span>代理的显示区被配置为在含有通配符的地址<span class="ss">(</span><span class="nv">X11UseLocalhost</span><span class="ss">)</span>上监听
# 那么将可能有额外的信息被泄漏。由于使用<span class="nv">X11</span>转发的可能带来的风险，此指令默认值为<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>
# 需要注意的是，禁止<span class="nv">X11</span>转发并不能禁止用户转发<span class="nv">X11</span>通信，因为用户可以安装他们自己的转发器
# 如果启用了 <span class="nv">UseLogin</span> ，那么<span class="nv">X11</span>转发将被自动禁止
<span class="nv">X11Forwarding</span> <span class="nv">yes</span>

# 指定<span class="nv">sshdX11</span> 转发的第一个可用的显示区<span class="ss">(</span><span class="nv">display</span><span class="ss">)</span>数字。默认值是 <span class="mi">10</span> 
# 这个可以用于防止 <span class="nv">sshd</span> 占用了真实的 <span class="nv">X11</span> 服务器显示区，从而发生混淆
#<span class="nv">X11DisplayOffset</span> <span class="mi">10</span>

# <span class="nv">sshd</span>是否应当将<span class="nv">X11</span>转发服务器绑定到本地<span class="nv">loopback</span>地址。默认值是<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>
# <span class="nv">sshd</span> 默认将转发服务器绑定到本地<span class="nv">loopback</span>地址并将 <span class="nv">DISPLAY</span> 环境变量的主机名部分设为<span class="s2">&quot;</span><span class="s">localhost</span><span class="s2">&quot;</span>
# 这可以防止远程主机连接到 <span class="nv">proxy</span> <span class="nv">display</span> 。不过某些老旧的<span class="nv">X11</span>客户端不能在此配置下正常工作
# 为了兼容这些老旧的<span class="nv">X11</span>客户端，你可以设为<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>
#<span class="nv">X11UseLocalhost</span> <span class="nv">yes</span>
#<span class="nv">PermitTTY</span> <span class="nv">yes</span>

# 指定<span class="nv">sshd</span>是否在每一次交互式登录时打印 <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">motd</span> 文件的内容。默认值是<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>
<span class="nv">PrintMotd</span> <span class="nv">no</span>

# 指定<span class="nv">sshd</span>是否在每一次交互式登录时打印最后一位用户的登录时间。默认值是<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>
#<span class="nv">PrintLastLog</span> <span class="nv">yes</span>

# 指定系统是否向客户端发送<span class="nv">TCPkeepalive</span>消息。默认<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>。消息可以检测到死连接、连接不当关闭、客户端崩溃等异常。可以设为<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>关闭这个特性
#<span class="nv">TCPKeepAlive</span> <span class="nv">yes</span>

# 是否在交互式会话的登录过程中使用 <span class="nv">login</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span> 。默认值是<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>
# 如果开启此指令，那么 <span class="nv">X11Forwarding</span> 将会被禁止，因为 <span class="nv">login</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span> 不知道如何处理 <span class="nv">xauth</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span> <span class="nv">cookies</span> 
# 需要注意的是，<span class="nv">login</span><span class="ss">(</span><span class="mi">1</span><span class="ss">)</span> 是禁止用于远程执行命令的
# 如果指定了 <span class="nv">UsePrivilegeSeparation</span> ，那么它将在认证完成后被禁用
#<span class="nv">UseLogin</span> <span class="nv">no</span>

# 是否让<span class="nv">sshd</span>通过创建非特权子进程处理接入请求的方法来进行权限分离。默认值是<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>
# 认证成功后，将以该认证用户的身份创建另一个子进程,这样做的目的是为了防止通过有缺陷的子进程提升权限，从而使系统更加安全
#<span class="nv">UsePrivilegeSeparation</span> <span class="nv">sandbox</span>

# 指定是否允许 <span class="nv">sshd</span><span class="ss">(</span><span class="mi">8</span><span class="ss">)</span> 处理 <span class="o">~/</span>.<span class="nv">ssh</span><span class="o">/</span><span class="nv">environment</span> 以及 <span class="o">~/</span>.<span class="nv">ssh</span><span class="o">/</span><span class="nv">authorized_keys</span> 中的 <span class="nv">environment</span><span class="o">=</span> 选项
# 默认值是<span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>。如果设为<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>可能会导致用户有机会使用某些机制<span class="ss">(</span>比如 <span class="nv">LD_PRELOAD</span><span class="ss">)</span>绕过访问控制，造成安全漏洞
#<span class="nv">PermitUserEnvironment</span> <span class="nv">no</span>

# 是否对通信数据进行压缩，还是延迟到认证成功之后再对通信数据进行压缩
# 可用值：<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">delayed</span><span class="s2">&quot;</span><span class="ss">(</span>默认<span class="ss">)</span>, <span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span>
#<span class="nv">Compression</span> <span class="nv">delayed</span>

######################################################################################################################

# 设置一个以秒记的时长，如果超过这么长时间没有收到客户端的任何数据，
# <span class="nv">sshd</span><span class="ss">(</span><span class="mi">8</span><span class="ss">)</span> 将通过安全通道向客户端发送一个<span class="s2">&quot;</span><span class="s">alive</span><span class="s2">&quot;</span>消息，并等候应答
# 默认值 <span class="mi">0</span> 表示不发送<span class="s2">&quot;</span><span class="s">alive</span><span class="s2">&quot;</span>消息。这个选项仅对<span class="nv">SSH</span><span class="o">-</span><span class="mi">2</span>有效
#<span class="nv">ClientAliveInterval</span> <span class="mi">0</span>

######################################################################################################################

# <span class="nv">sshd</span>在未收到任何客户端回应前最多允许发送多少个<span class="s2">&quot;</span><span class="s">alive</span><span class="s2">&quot;</span>消息。默认值是 <span class="mi">3</span> 
# 到达这个上限后，<span class="nv">sshd</span><span class="ss">(</span><span class="mi">8</span><span class="ss">)</span> 将强制断开连接、关闭会话
# 需要注意的是，<span class="s2">&quot;</span><span class="s">alive</span><span class="s2">&quot;</span>消息与 <span class="nv">TCPKeepAlive</span> 有很大差异
# <span class="s2">&quot;</span><span class="s">alive</span><span class="s2">&quot;</span>消息是通过加密连接发送的，因此不会被欺骗；而 <span class="nv">TCPKeepAlive</span> 却是可以被欺骗的
# 如果 <span class="nv">ClientAliveInterval</span> 被设为 <span class="mi">15</span> 并且将 <span class="nv">ClientAliveCountMax</span> 保持为默认值，
# 那么无应答的客户端大约会在<span class="mi">45</span>秒后被强制断开。这个指令仅可以用于<span class="nv">SSH</span><span class="o">-</span><span class="mi">2</span>协议
#<span class="nv">ClientAliveCountMax</span> <span class="mi">3</span>

######################################################################################################################

# 指定<span class="nv">sshd</span>是否应该对远程主机名进行反向解析，以检查此主机名是否与其<span class="nv">IP</span>地址真实对应。默认值为<span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>
#<span class="nv">UseDNS</span> <span class="nv">no</span>

# 指定在哪个文件中存放<span class="nv">SSH</span>守护进程的进程号，默认为 <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">run</span><span class="o">/</span><span class="nv">sshd</span>.<span class="nv">pid</span> 文件
#<span class="nv">PidFile</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">run</span><span class="o">/</span><span class="nv">sshd</span>.<span class="nv">pid</span>

# 最大允许保持多少个未认证的连接。默认值是 <span class="mi">10</span> 
# 到达限制后，将不再接受新连接，除非先前的连接认证成功或超出 <span class="nv">LoginGraceTime</span> 的限制
#<span class="nv">MaxStartups</span> <span class="mi">10</span>:<span class="mi">30</span>:<span class="mi">100</span>

# 是否允许 <span class="nv">tun</span><span class="ss">(</span><span class="mi">4</span><span class="ss">)</span> 设备转发。可用值如下：
# <span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>, <span class="s2">&quot;</span><span class="s">point-to-point</span><span class="s2">&quot;</span><span class="ss">(</span><span class="nv">layer</span> <span class="mi">3</span><span class="ss">)</span>, <span class="s2">&quot;</span><span class="s">ethernet</span><span class="s2">&quot;</span><span class="ss">(</span><span class="nv">layer</span> <span class="mi">2</span><span class="ss">)</span>, <span class="s2">&quot;</span><span class="s">no</span><span class="s2">&quot;</span><span class="ss">(</span>默认<span class="ss">)</span>
# <span class="s2">&quot;</span><span class="s">yes</span><span class="s2">&quot;</span>同时蕴含着<span class="s2">&quot;</span><span class="s">point-to-point</span><span class="s2">&quot;</span>和<span class="s2">&quot;</span><span class="s">ethernet</span><span class="s2">&quot;</span>
#<span class="nv">PermitTunnel</span> <span class="nv">no</span>

#<span class="nv">ChrootDirectory</span> <span class="nv">none</span>
#<span class="nv">VersionAddendum</span> <span class="nv">none</span>

# 这个特性仅能用于<span class="nv">SSH</span><span class="o">-</span><span class="mi">2</span>，默认什么内容也不显示。<span class="s2">&quot;</span><span class="s">none</span><span class="s2">&quot;</span>表示禁用这个特性
# <span class="nv">no</span> <span class="nv">default</span> <span class="nv">banner</span> <span class="nv">path</span>
#<span class="nv">Banner</span> <span class="nv">none</span>

######################################################################################################################
# <span class="nv">AcceptEnv</span>
# 指定客户端发送的哪些环境变量将会被传递到会话环境中。[注意]只有<span class="nv">SSH</span><span class="o">-</span><span class="mi">2</span>协议支持环境变量的传递
# 细节可以参考<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ssh</span><span class="o">/</span><span class="nv">ssh_config</span>中的 <span class="nv">SendEnv</span> 配置指令
# 指令的值是空格分隔的变量名列表<span class="ss">(</span>其中可以使用<span class="s1">&#39;</span><span class="s">*</span><span class="s1">&#39;</span>和<span class="s1">&#39;</span><span class="s">?</span><span class="s1">&#39;</span>作为通配符<span class="ss">)</span>。也可以使用多个 <span class="nv">AcceptEnv</span> 达到同样的目的
# 需要注意的是，有些环境变量可能会被用于绕过禁止用户使用的环境变量。由于这个原因，该指令应当小心使用
# 默认是不传递任何环境变量
# <span class="nv">Allow</span> <span class="nv">client</span> <span class="nv">to</span> <span class="nv">pass</span> <span class="nv">locale</span> <span class="nv">environment</span> <span class="nv">variables</span>
<span class="nv">AcceptEnv</span> <span class="nv">LANG</span> <span class="nv">LC_</span><span class="o">*</span>

######################################################################################################################

# 系统内开启<span class="nv">ssh</span>服务和<span class="nv">sftp</span>服务都是通过<span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">sbin</span><span class="o">/</span><span class="nv">sshd</span>这个后台程序监听<span class="mi">22</span>端口，而<span class="nv">sftp</span>服务作为一个子服务，是通过<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">ssh</span><span class="o">/</span><span class="nv">sshd_config</span>配置
# 文件中的<span class="nv">Subsystem</span>实现的，如果没有配置<span class="nv">Subsystem</span>参数，则系统是不能<span class="nv">sftp</span>访问的
# <span class="nv">override</span> <span class="nv">default</span> <span class="nv">of</span> <span class="nv">no</span> <span class="nv">subsystems</span>
<span class="nv">Subsystem</span>   <span class="nv">sftp</span>    <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">openssh</span><span class="o">/</span><span class="nv">sftp</span><span class="o">-</span><span class="nv">server</span>

# <span class="nv">AllowGroups</span>
# 这个指令后面跟着一串用空格分隔的组名列表<span class="ss">(</span>其中可以使用<span class="s2">&quot;</span><span class="s">*</span><span class="s2">&quot;</span>和<span class="s2">&quot;</span><span class="s">?</span><span class="s2">&quot;</span>通配符<span class="ss">)</span>。默认允许所有组登录
# 如果使用了这个指令，那么将仅允许这些组中的成员登录，而拒绝其它所有组
# 这里的<span class="s2">&quot;</span><span class="s">组</span><span class="s2">&quot;</span>是指<span class="s2">&quot;</span><span class="s">主组</span><span class="s2">&quot;</span><span class="ss">(</span><span class="nv">primary</span> <span class="nv">group</span><span class="ss">)</span>，也就是<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">passwd</span>文件中指定的组
# 这里只允许使用组的名字而不允许使用<span class="nv">GID</span>。相关的 <span class="nv">allow</span><span class="o">/</span><span class="nv">deny</span> 指令按照下列顺序处理：
# <span class="nv">DenyUsers</span>, <span class="nv">AllowUsers</span>, <span class="nv">DenyGroups</span>, <span class="nv">AllowGroups</span>
#<span class="nv">AllowGroups</span><span class="o">&lt;</span>组名<span class="mi">1</span><span class="o">&gt;</span> <span class="o">&lt;</span>组名<span class="mi">2</span><span class="o">&gt;</span> <span class="o">&lt;</span>组名<span class="mi">3</span><span class="o">&gt;</span> ..
##指定允许通过远程访问的组，多个组以空格隔开。当多个用户需要通过<span class="nv">ssh</span>登录系统时，可将所有用户加入一个组中

# <span class="nv">DenyGroups</span>
# 这个指令后面跟着一串用空格分隔的组名列表<span class="ss">(</span>其中可以使用<span class="s2">&quot;</span><span class="s">*</span><span class="s2">&quot;</span>和<span class="s2">&quot;</span><span class="s">?</span><span class="s2">&quot;</span>通配符<span class="ss">)</span>。默认允许所有组登录
# 如果使用了这个指令，那么这些组中的成员将被拒绝登录
# 这里的<span class="s2">&quot;</span><span class="s">组</span><span class="s2">&quot;</span>是指<span class="s2">&quot;</span><span class="s">主组</span><span class="s2">&quot;</span><span class="ss">(</span><span class="nv">primary</span> <span class="nv">group</span><span class="ss">)</span>，也就是<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">passwd</span>文件中指定的组
# 这里只允许使用组的名字而不允许使用<span class="nv">GID</span>。相关的 <span class="nv">allow</span><span class="o">/</span><span class="nv">deny</span> 指令按照下列顺序处理：
# <span class="nv">DenyUsers</span>, <span class="nv">AllowUsers</span>, <span class="nv">DenyGroups</span>, <span class="nv">AllowGroups</span>
#<span class="nv">DenyGroups</span><span class="o">&lt;</span>组名<span class="mi">1</span><span class="o">&gt;</span> <span class="o">&lt;</span>组名<span class="mi">2</span><span class="o">&gt;</span> <span class="o">&lt;</span>组名<span class="mi">3</span><span class="o">&gt;</span> ..
##指定禁止通过远程访问的组，多个组以空格隔开

######################################################################################################################

# <span class="nv">AllowUsers</span>
# 这个指令后面跟着一串用空格分隔的用户名列表<span class="ss">(</span>其中可以使用<span class="s2">&quot;</span><span class="s">*</span><span class="s2">&quot;</span>和<span class="s2">&quot;</span><span class="s">?</span><span class="s2">&quot;</span>通配符<span class="ss">)</span>。默认允许所有用户登录
# 如果使用了这个指令，那么将仅允许这些用户登录，而拒绝其它所有用户
# 如果指定了 <span class="nv">USER</span>@<span class="nv">HOST</span> 模式的用户，那么 <span class="nv">USER</span> 和 <span class="nv">HOST</span> 将同时被检查。# <span class="nv">override</span> <span class="nv">default</span> <span class="nv">of</span> <span class="nv">no</span> <span class="nv">subsystems</span>
# 这里只允许使用用户的名字而不允许使用<span class="nv">UID</span>。相关的 <span class="nv">allow</span><span class="o">/</span><span class="nv">deny</span> 指令按照下列顺序处理：<span class="nv">Subsystem</span> <span class="nv">sftp</span> <span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">openssh</span><span class="o">/</span><span class="nv">sftp</span><span class="o">-</span><span class="nv">server</span>
# <span class="nv">DenyUsers</span>, <span class="nv">AllowUsers</span>, <span class="nv">DenyGroups</span>, <span class="nv">AllowGroups</span>
#<span class="nv">AllowUsers</span><span class="o">&lt;</span>用户名<span class="mi">1</span><span class="o">&gt;</span> <span class="o">&lt;</span>用户名<span class="mi">2</span><span class="o">&gt;</span> <span class="o">&lt;</span>用户名<span class="mi">3</span><span class="o">&gt;</span> ..
##指定允许通过远程访问的用户，多个用户以空格隔开

# <span class="nv">DenyUsers</span>
# 这个指令后面跟着一串用空格分隔的用户名列表<span class="ss">(</span>其中可以使用<span class="s2">&quot;</span><span class="s">*</span><span class="s2">&quot;</span>和<span class="s2">&quot;</span><span class="s">?</span><span class="s2">&quot;</span>通配符<span class="ss">)</span>。默认允许所有用户登录
# 如果使用了这个指令，那么这些用户将被拒绝登录
# 如果指定了 <span class="nv">USER</span>@<span class="nv">HOST</span> 模式的用户，那么 <span class="nv">USER</span> 和 <span class="nv">HOST</span> 将同时被检查
# 这里只允许使用用户的名字而不允许使用<span class="nv">UID</span>。相关的 <span class="nv">allow</span><span class="o">/</span><span class="nv">deny</span> 指令按照下列顺序处理：
# <span class="nv">DenyUsers</span>, <span class="nv">AllowUsers</span>, <span class="nv">DenyGroups</span>, <span class="nv">AllowGroups</span>
#<span class="nv">DenyUsers</span><span class="o">&lt;</span>用户名<span class="mi">1</span><span class="o">&gt;</span> <span class="o">&lt;</span>用户名<span class="mi">2</span><span class="o">&gt;</span> <span class="o">&lt;</span>用户名<span class="mi">3</span><span class="o">&gt;</span> ..
##指定禁止通过远程访问的用户，多个用户以空格隔开

######################################################################################################################

# <span class="nv">Match</span>
# 引入一个条件块。块的结尾标志是另一个 <span class="nv">Match</span> 指令或者文件结尾
# 如果 <span class="nv">Match</span> 行上指定的条件都满足，那么随后的指令将覆盖全局配置中的指令
# <span class="nv">Match</span> 的值是一个或多个<span class="s2">&quot;</span><span class="s">条件-模式</span><span class="s2">&quot;</span>对。可用的<span class="s2">&quot;</span><span class="s">条件</span><span class="s2">&quot;</span>是：<span class="nv">User</span>, <span class="nv">Group</span>, <span class="nv">Host</span>, <span class="nv">Address</span> 
# 只有下列指令可以在 <span class="nv">Match</span> 块中使用：<span class="nv">AllowTcpForwarding</span>, <span class="nv">Banner</span>,
# <span class="nv">ForceCommand</span>, <span class="nv">GatewayPorts</span>, <span class="nv">GSSApiAuthentication</span>,
# <span class="nv">KbdInteractiveAuthentication</span>, <span class="nv">KerberosAuthentication</span>,
# <span class="nv">PasswordAuthentication</span>, <span class="nv">PermitOpen</span>, <span class="nv">PermitRootLogin</span>,
# <span class="nv">RhostsRSAAuthentication</span>, <span class="nv">RSAAuthentication</span>, <span class="nv">X11DisplayOffset</span>,
# <span class="nv">X11Forwarding</span>, <span class="nv">X11UseLocalHost</span>

# 指定<span class="nv">TCP</span>端口转发允许的目的地，可以使用空格分隔多个转发目标。默认允许所有转发请求
# 合法的指令格式如下：
# <span class="nv">PermitOpen</span> <span class="nv">host</span>:<span class="nv">port</span>
# <span class="nv">PermitOpen</span> <span class="nv">IPv4_addr</span>:<span class="nv">port</span>
# <span class="nv">PermitOpen</span> [<span class="nv">IPv6_addr</span>]:<span class="nv">port</span>
# <span class="s2">&quot;</span><span class="s">any</span><span class="s2">&quot;</span>可以用于移除所有限制并允许一切转发请求

# <span class="nv">Example</span> <span class="nv">of</span> <span class="nv">overriding</span> <span class="nv">settings</span> <span class="nv">on</span> <span class="nv">a</span> <span class="nv">per</span><span class="o">-</span><span class="nv">user</span> <span class="nv">basis</span>
#<span class="nv">Match</span> <span class="nv">User</span> <span class="nv">anoncvs</span>
#   <span class="nv">X11Forwarding</span> <span class="nv">no</span>
#   <span class="nv">AllowTcpForwarding</span> <span class="nv">no</span>
#   <span class="nv">PermitTTY</span> <span class="nv">no</span>

#   <span class="nv">ForceCommand</span> <span class="nv">cvs</span> <span class="nv">server</span>
#   <span class="nv">ForceCommand</span>
#   强制执行这里指定的命令而忽略客户端提供的任何命令。这个命令将使用用户的登录<span class="nv">shell</span>执行<span class="ss">(</span><span class="nv">shell</span> <span class="o">-</span><span class="nv">c</span><span class="ss">)</span>
#   这可以应用于 <span class="nv">shell</span> 、命令、子系统的完成，通常用于 <span class="nv">Match</span> 块中
#   这个命令最初是在客户端通过 <span class="nv">SSH_ORIGINAL_COMMAND</span> 环境变量来支持的

<span class="nv">PermitRootLogin</span> <span class="nv">yes</span>

# 指定<span class="nv">sshd</span>守护进程监听的端口号，默认为 <span class="mi">22</span> 。可以使用多条指令监听多个端口
# 默认将在本机的所有网络接口上监听，但是可以通过 <span class="nv">ListenAddress</span> 指定只在某个特定的接口上监听
<span class="nv">Port</span> <span class="mi">22</span>
</pre></div>

<h3 id="ssh_2">SSH端口转发<a class="headerlink" href="#ssh_2" title="Permanent link">&para;</a></h3>
<p>SSH端口转发将其他TCP端口的网络数据通过SSH链路转发，并自动加密和解密</p>
<h4 id="_6">本地转发实例<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="o">#</span> <span class="err">一台</span><span class="n">LDAP</span> <span class="n">server</span><span class="err">，但限制远程机器连接，此时利用</span><span class="n">ssh端口转发达到从远程机器测试server的目的</span>
<span class="o">#</span> <span class="err">命令格式：</span>
<span class="n">ssh</span> <span class="o">-</span><span class="n">L</span> <span class="o">&lt;</span><span class="k">local</span> <span class="n">port</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">remote</span> <span class="k">host</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">remote</span> <span class="n">port</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">SSH</span> <span class="n">hostname</span><span class="o">&gt;</span>
<span class="o">#</span> <span class="err">在</span><span class="n">LDAP</span> <span class="n">client执行以下命令即可建立ssh的本地端口转发</span>
<span class="n">ssh</span> <span class="o">-</span><span class="n">L</span> <span class="mi">7001</span><span class="p">:</span><span class="n">localhost</span><span class="p">:</span><span class="mi">389</span> <span class="n">LDAPServer</span>
<span class="o">#</span> <span class="err">在选择端口号时要注意非管理员帐号是无权绑定</span> <span class="mi">1</span><span class="o">-</span><span class="mi">1023</span> <span class="err">端口的，所以一般是选用一个</span> <span class="mi">1024</span><span class="o">-</span><span class="mi">65535</span> <span class="err">之间的并且尚未使用的端口号即可</span>
<span class="o">#</span> <span class="err">然后我们可以将远程机器（</span><span class="n">LdapClientHost</span><span class="err">）上的应用直接配置到本机的</span> <span class="mi">7001</span> <span class="err">端口上（而不是</span> <span class="n">LDAP</span> <span class="err">服务器的</span> <span class="mi">389</span> <span class="err">端口上）</span>
<span class="o">#</span> <span class="n">SSH</span> <span class="err">同时提供了</span> <span class="n">GatewayPorts</span> <span class="err">关键字，我们可以通过指定它与其他机器共享这个本地端口转发</span>
<span class="n">ssh</span> <span class="o">-</span><span class="k">g</span> <span class="o">-</span><span class="n">L</span> <span class="o">&lt;</span><span class="k">local</span> <span class="n">port</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">remote</span> <span class="k">host</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">remote</span> <span class="n">port</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">SSH</span> <span class="n">hostname</span><span class="o">&gt;</span>
</pre></div>

<p><img alt="fagure" src="http://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/image002.jpg" /></p>
<h4 id="_7">远程转发实例<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<p><div class="codehilite"><pre><span></span><span class="err">假设由于网络或防火墙的原因我们不能用</span> <span class="n">SSH</span> <span class="err">直接从</span> <span class="n">LdapClientHost</span> <span class="err">连接到</span> <span class="n">LDAP</span> <span class="err">服务器（</span><span class="n">LdapServertHost</span><span class="err">），但是反向连接却是被允许的。</span>
<span class="err">那此时我们的选择自然就是远程端口转发了</span>
<span class="o">#</span> <span class="err">命令格式：</span>
<span class="n">ssh</span> <span class="o">-</span><span class="n">R</span> <span class="o">&lt;</span><span class="k">local</span> <span class="n">port</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">remote</span> <span class="k">host</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">remote</span> <span class="n">port</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">SSH</span> <span class="n">hostname</span><span class="o">&gt;</span>
<span class="o">#</span> <span class="err">在</span><span class="n">LDAP服务器</span><span class="err">（</span><span class="n">LdapServertHost</span><span class="err">）端执行如下命令：</span>
<span class="n">ssh</span> <span class="o">-</span><span class="n">R</span> <span class="mi">7001</span><span class="p">:</span><span class="n">localhost</span><span class="p">:</span><span class="mi">389</span> <span class="n">LdapClientHost</span>
</pre></div>
<img alt="figure" src="http://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/image003.jpg" /></p>
<h4 id="_8">多主机转发应用实例<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h4>
<p><div class="codehilite"><pre><span></span><span class="c1"># 本地转发命令中的&lt;remote host&gt;和&lt;SSH hostname&gt;可以是不同的机器</span>
<span class="n">ssh</span> <span class="o">-</span><span class="n">L</span> <span class="o">&lt;</span><span class="n">local</span> <span class="n">port</span><span class="o">&gt;:&lt;</span><span class="n">remote</span> <span class="n">host</span><span class="o">&gt;:&lt;</span><span class="n">remote</span> <span class="n">port</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">SSH</span> <span class="n">hostname</span><span class="o">&gt;</span>
<span class="c1"># 看一个涉及到四台机器 (A,B,C,D) 的例子</span>
<span class="c1"># 在 SSH Client(C) 执行下列命令来建立 SSH 连接以及端口转发：</span>
<span class="n">ssh</span> <span class="o">-</span><span class="n">g</span> <span class="o">-</span><span class="n">L</span> <span class="m">7001</span><span class="o">:&lt;</span><span class="n">B</span><span class="o">&gt;:</span><span class="m">389</span> <span class="o">&lt;</span><span class="n">D</span><span class="o">&gt;</span>
<span class="c1"># 然后在我们的应用客户端（A）上配置连接机器（C ）的 7001 端口即可,在上述连接中，（A）&lt;-&gt; (C) 以及 (B)&lt;-&gt;(D) 之间的连接并不是安全连接，</span>
它们之间没有经过 <span class="n">SSH</span> 的加密及解密
</pre></div>
<img alt="figure" src="http://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/image004.jpg" /></p>
<h4 id="_9">动态转发实例<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<p><div class="codehilite"><pre><span></span><span class="o">#</span> <span class="err">当我们在一个不安全的</span> <span class="n">WiFi</span> <span class="err">环境下上网，用</span> <span class="n">SSH</span> <span class="err">动态转发来保护我们的网页浏览及</span> <span class="n">MSN</span> <span class="err">信息无疑是十分必要的。实际是创建了一个</span><span class="n">socks代理服务</span>
<span class="o">#</span> <span class="err">命令格式：</span>
<span class="n">ssh</span> <span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="k">local</span> <span class="n">port</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">SSH</span> <span class="n">Server</span><span class="o">&gt;</span>
<span class="o">#</span> <span class="err">此时</span> <span class="n">SSH</span> <span class="err">所包护的范围只包括从浏览器端（</span><span class="n">SSH</span> <span class="n">Client</span> <span class="err">端）到</span> <span class="n">SSH</span> <span class="n">Server</span> <span class="err">端的连接，并不包含从</span> <span class="n">SSH</span> <span class="n">Server</span> <span class="err">端</span> <span class="err">到目标网站的连接。如果后</span>
<span class="err">半截连接的安全不能得到充分的保证的话，这种方式仍不是合适的解决方案</span>
</pre></div>
<img alt="figure" src="http://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/image005.jpg" /></p>
<h4 id="x">X协议转发实例<a class="headerlink" href="#x" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><span class="o">#</span> <span class="err">可用作远程桌面连接，被远程端是</span><span class="n">Windows可安装xming作为xserver</span><span class="err">。</span><span class="n">ssh</span> <span class="n">client可以选择putty配置ssh访问并建立x</span><span class="o">-</span><span class="k">forward</span><span class="err">（转发）</span>
<span class="n">ssh</span> <span class="o">-</span><span class="n">X</span> <span class="o">&lt;</span><span class="n">SSH</span> <span class="n">Server</span><span class="o">&gt;</span>
</pre></div>

<h2 id="linux_1">linux磁盘详解<a class="headerlink" href="#linux_1" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="err">磁盘分区有主分区、扩展分区、逻辑分区，一块硬盘最多可以有四个主分区，其中一个主分区的位置可以用一个扩展分区替换，且一块硬盘只能有一个扩展</span>
<span class="err">分区，在这个扩展分区内可以划分多个逻辑分区</span>
<span class="err">预计超过四个分区，至少一个扩展分区：</span>
<span class="mi">3</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="err">、</span><span class="mi">2</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="err">、</span><span class="mi">1</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="n">e</span><span class="c1">-----p：主分区、e：扩展分区</span>
<span class="err">最多只能有一个扩展分区，扩展分区不能使用，必须再扩展分区上划分多个逻辑分区，然后格式化</span><span class="p">(</span><span class="err">格式化的主要目的是创建文件系统</span><span class="c1">--存储数据的方式)</span>
<span class="err">接着才能存放数据或者安装系统</span>

<span class="err">磁盘分区的设备名：</span>
<span class="err">再</span><span class="n">linux中</span><span class="err">，通过设备名访问设备，设备名存放在</span><span class="o">/</span><span class="n">dev目录</span>
<span class="c1">--系统的第一块IDE接口的硬盘名称为/dev/hda</span>
<span class="c1">--系统的第二块IDE接口的硬盘名称为/dev/hdb</span>
<span class="c1">--系统的第一块SCSI接口的硬盘名称为/dev/sda</span>
<span class="c1">--系统的第二块SCSI接口的硬盘名称为/dev/sdb</span>

<span class="err">分区则使用数字编号标识：</span>
<span class="c1">--系统的第一块IDE接口的硬盘第一个分区名称为/dev/hda1</span>
<span class="c1">--系统的第二块IDE接口的硬盘第六个分区名称为/dev/hda6</span>
<span class="c1">--系统的第一块SCSI接口的硬盘第一个分区名称为/dev/sdb1</span>
<span class="c1">--系统的第二块SCSI接口的硬盘第一个分区名称为/dev/sdb6</span>

<span class="err">注意：</span>
<span class="err">分区数字编号</span><span class="mi">1</span><span class="o">-</span><span class="mi">4</span><span class="err">留给主分区或者扩展分区使用，逻辑分区是在扩展分区的基础上编号从</span><span class="mi">5</span><span class="err">开始</span>
<span class="n">SCSI</span><span class="o">/</span><span class="n">SAS</span><span class="o">/</span><span class="n">SATA</span><span class="o">/</span><span class="n">USB接口的硬盘的设备名均以</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sd开头</span><span class="err">，不同硬盘编号依次是</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda</span><span class="err">、</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb</span>
<span class="n">SAS</span><span class="o">/</span><span class="n">SATA是主流硬盘接口</span><span class="err">，</span><span class="n">SSD固态硬盘</span><span class="err">，速度性能</span><span class="n">SSD</span><span class="o">&gt;</span><span class="n">SAS</span><span class="o">&gt;</span><span class="n">SATA</span>
</pre></div>

<h3 id="linux_2">Linux文件系统目录<a class="headerlink" href="#linux_2" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>基本文件系统类型：
<span class="o">--</span>普通文件：如文本文件、<span class="nv">c</span>语言源代码、<span class="nv">shell</span>脚本等，可以用<span class="nv">cat</span>、<span class="nv">less</span>、<span class="nv">more</span>、<span class="nv">vi</span>等来察看内容，用<span class="nv">mv</span>来改名
<span class="o">--</span>目录文件：包括文件名、子目录名及其指针，可以用<span class="nv">ls</span>列出目录文件
<span class="o">--</span>链接文件：是指向一索引节点的那些目录条目，用<span class="nv">ls</span>来查看时，链接文件的标志用<span class="nv">l</span>开头，而文件后以<span class="s2">&quot;</span><span class="s">-&gt;</span><span class="s2">&quot;</span>指向所链接的文件
<span class="o">--</span>特殊文件：如磁盘、终端、打印机等都在文件系统中表示出来，常放在<span class="o">/</span><span class="nv">dev</span>目录内
可以用<span class="nv">file</span>命令来识别

.：表示当前目录，也可以用.<span class="o">/</span>表示
..：表示上一级目录，也可以用..<span class="o">/</span>表示
<span class="o">~</span>：代表用户自己的宿主目录

<span class="o">/</span><span class="nv">bin</span>       保存可执行的二进制文件（可执行的指令）权限对所有用户开放

<span class="o">/</span><span class="nv">boot</span><span class="ss">(</span>分区大小：<span class="mi">100</span><span class="nv">m</span><span class="ss">)</span>     引导启动所需要的文件都在此目录中、包含了内核文件<span class="mi">3</span>.<span class="mi">7</span><span class="nv">M</span>大小，驱动，插件，模块等文件
<span class="o">/</span><span class="nv">boot</span>：存放开机启动加载程序的核心文件,包括引导文件、内核文件、驱动、 插件、模块等；<span class="ss">(</span>如<span class="nv">kernel</span>和<span class="nv">grup</span><span class="ss">)</span>
    <span class="nv">config</span><span class="o">-</span><span class="mi">2</span>.<span class="mi">6</span>.<span class="mi">18</span><span class="o">-</span><span class="mi">164</span>.<span class="nv">el5</span>：系统<span class="nv">kernel</span>的配置文件，内核编译完成保存的就是这个配置文件
    <span class="nv">lost</span><span class="o">+</span><span class="nv">found</span>：说明<span class="o">/</span><span class="nv">boot</span>是一个独立的<span class="nv">ext3</span>文件系统
    <span class="nv">vmlinuz</span><span class="o">-</span><span class="mi">2</span>.<span class="mi">6</span>.<span class="mi">18</span><span class="o">-</span><span class="mi">164</span>.<span class="nv">el5</span>：系统使用<span class="nv">kernel</span>，非常重要
    <span class="nv">grub</span>：多系统启动管理程序<span class="nv">grub</span>的目录，里面存放的都是<span class="nv">grub</span>在启时所需要的画面、配置及各阶段的配置文件；其中<span class="nv">grub</span>.<span class="nv">conf</span>是<span class="nv">grub</span>配置文件
    <span class="nv">symvers</span><span class="o">-</span><span class="mi">2</span>.<span class="mi">6</span>.<span class="mi">18</span><span class="o">-</span><span class="mi">164</span>.<span class="nv">el5</span>.<span class="nv">gz</span>
    <span class="nv">initrd</span><span class="o">-</span><span class="mi">2</span>.<span class="mi">6</span>.<span class="mi">18</span><span class="o">-</span><span class="mi">164</span>.<span class="nv">el5</span>.<span class="nv">img</span>：此文件是<span class="nv">linux</span>系统启动时的模块应主要来源，<span class="nv">initrd</span>的目的就是在<span class="nv">kernel</span>加载系统识别<span class="nv">cpu</span>和内存等心信息之后，
                               让系统进一步知道还有那些硬件是启动所必须使用的
    <span class="nv">System</span>.<span class="nv">map</span><span class="o">-</span><span class="mi">2</span>.<span class="mi">6</span>.<span class="mi">18</span><span class="o">-</span><span class="mi">164</span>.<span class="nv">el5</span>：是系统<span class="nv">kernel</span>中的变量对应表；<span class="ss">(</span>可以理解为是索引文件<span class="ss">)</span>

<span class="o">/</span><span class="nv">dev</span>      存放了所有的硬件设备文件；网卡，声卡，硬盘，光驱；<span class="nv">tty1</span>,<span class="nv">tty2</span>终端，设备文件目录，虚拟文件系统，主要存放所有系统中<span class="nv">device</span>的相关
          信息，不论是使用的或未使用的设备，只要有可能使用到，就会在<span class="o">/</span><span class="nv">dev</span>中建立一个相对应的设备文件；设备文件分为<span class="mi">2</span>种类型：字符设备文件和
          块设备文件<span class="ss">(</span>目录中基本上都是设备文件，如硬盘设备文件<span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">sda</span><span class="ss">)</span>
 <span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">console</span>：系统控制台，也就是直接和系统连接的监视器
 <span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">hd</span>：<span class="nv">IDE</span>设备文件
 <span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">sd</span>：<span class="nv">sata</span>、<span class="nv">usb</span>、<span class="nv">scsi</span>等设备文件
 <span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">fd</span>：软驱设备文件
 <span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">tty</span>：虚拟控制台设备文件
 <span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">pty</span>：提供远程虚拟控制台设备文件
 <span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">null</span>：所谓<span class="s2">&quot;</span><span class="s">黑洞</span><span class="s2">&quot;</span>，所有写入该设备的信息都将消失，如当想将屏幕上的输出信息隐藏起来时，只要将输出信息输入到<span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">null</span>即可

<span class="o">/</span><span class="nv">etc</span>：主机、系统或网络配置文件存放目录
    简单的将<span class="o">/</span><span class="nv">etc</span>目录分为以下几类：
    <span class="o">--</span>基本文件：所有直接放在<span class="o">/</span><span class="nv">etc</span>目录下的文件归类为基本文件
            <span class="nv">aliases</span>：用于设置邮件别名
            <span class="nv">auto</span>.<span class="o">*</span> ：代表的是一系列<span class="nv">autofs</span>服务所需要的配置文件，这个服务主要是让管理员可以事先定义出一些网络、本机或光驱等默认的路径
            <span class="nv">auto</span>.<span class="nv">master</span>：负责规划目录的分配与使用，目前默认提供三种自动挂载模式
            <span class="nv">auto</span>.<span class="nv">misc</span>：文件中的配置都以实体连接本机的磁盘驱动器为主
            <span class="nv">auto</span>.<span class="nv">net</span>：并不是一个配置文件，而是一个脚本文件，在使用上其实不须做任何调整；
            <span class="nv">auto</span>.<span class="nv">smb</span>：与<span class="nv">auto</span>.<span class="nv">net</span>一样，都是以个脚本文件
            <span class="nv">bashrc</span>：用户登录功能配置，全局配置，对所有用户生效，主要配置别名
            <span class="nv">profile</span>：与系统环境配置或初始化软件的相关配置，全局配置，对所有用户生效，主要配置变量
            <span class="nv">DIR_COLORS</span>：用于配置<span class="nv">ls</span>命令的颜色，主要针对<span class="nv">tty</span>登录的用户
            <span class="nv">DIR_COLORS</span>.<span class="nv">xterm</span>：用于配置<span class="nv">ls</span>命令的颜色，主要针对<span class="nv">xterm</span>登录的用户
            <span class="nv">fstab</span>：系统启动时自动挂载文件系统的配置文件
            <span class="nv">inittab</span>：启动时系统所需要的第一个配置文件；也即是<span class="nv">init</span>进程的配置文件
            <span class="nv">issue</span>：用户本机登录时，看到的欢迎信息
            <span class="nv">issue</span>.<span class="nv">net</span>：用户网络登录时，看到的欢迎信息
            <span class="nv">ld</span>.<span class="nv">so</span>.<span class="nv">conf</span>：包含<span class="nv">ld</span>.<span class="nv">so</span>.<span class="nv">conf</span>.<span class="nv">d</span><span class="cm">/*.conf配置；主要是ld.so.conf.d/*.conf目录的作用</span>
<span class="cm">            localtime：系统所使用的时区对应的配置文件；对应的时区文件都存在于/usr/share/zoneinfo/</span>
<span class="cm">            motd：登录成功的用户显示的信息对应的配置文件</span>
<span class="cm">            mtab：可以当做是检查当前文件系统挂载情况的配置文件；与mount命令结果一致</span>
<span class="cm">            prelink.conf：定义哪些执行文件和函数库是需要预先连接的</span>
<span class="cm">            securetty：主要是login程序在使用的，只要是列在该文件中的接口，就表示是可以使用的接口，相反，若从列表中删除，则无法使用该接口</span>
<span class="cm">            shells：记录目前系统所拥有shell种类的路径，通过cssh命令使用</span>
<span class="cm">            sudoers：sudo命令对应的配置文件，用于配置权限的分配方式</span>
<span class="cm">            sysctl.conf：主要是帮助用户配置/proc/sys目录下所有文件的值，与sysctl命令对应</span>
<span class="cm">            syslogd.conf：是syslogd服务的配置文件</span>
<span class="cm">            host.conf：主机名解析配置文件，主要说明解析的方式及顺序</span>
<span class="cm">            hosts：主机名解析配置文件，主要列出所有需要本地解析的主机名与IP地址的对应关系</span>
<span class="cm">            hosts.allow和hosts.deny：linux网络安全机制TCP Wrapper对应的配置文件</span>
<span class="cm">            nsswitch.conf：主要记录系统应如何查询主机名、密码、用户组、网络等，或是查询顺序的编排</span>
<span class="cm">            resolv.conf：记录DNS服务器地址，用于DNS域名解析</span>
<span class="cm">            services：定义了网络服务的默认端口号</span>
<span class="cm">            xinetd.conf：xinetd的主配置文件，目的是为xinetd.d下的所有子服务建立一个标准的规范使其可以遵循</span>
<span class="cm">            anacrontab：属于一种任务计划软件的配置文件，anacrontab软件和crond其实有点相辅相成，crond负责任务计划，而anacrontab则是</span>
<span class="cm">                        负责以&quot;间隔多久&quot;为主要的目标</span>
<span class="cm">            at.deny：该文件属于拒绝列表，只要被记录在其中的用户，就无法使用at所提供的任务计划服务</span>
<span class="cm">            at.allow：与at.deny刚好相反</span>
<span class="cm">            crontab：crontab的主配置文件，crond默认会执行的文件可以参考此配置文件</span>
<span class="cm">            cron.deny：该文件属于拒绝列表，只要被记录在其中的用户，就无法使用crond所提供的任务计划服务</span>
<span class="cm">            cron.allow：与cron.deny刚好相反</span>
<span class="cm">            exports：是NFS服务的主配置文件，主要目的就是将本机的目录共享到网络上，供其他人使用</span>
<span class="cm">            group与gshadow：用户组配置文件，group主要保存用户组信息，gshadow主要保存群组密码</span>
<span class="cm">            login.defs：设置系统在建立账号时所参考的配置</span>
<span class="cm">            passwd：主要保存系统用户账号的信息</span>
<span class="cm">            shadow：linux系统通常包经过&quot;hash&quot;处理后的密码存储在这个文件中</span>
<span class="cm">            protocols：通信协议对应端口号的一个对照表，包含协议名称、协议号码、注释等</span>
<span class="cm">            wgetrc：wget程序对应的配置文件，其中有quota、mail header、重传文件的预设次数、firewall和proxy等相关设置</span>
<span class="cm">            init.d：RHEL中所有服务的默认启动脚本都存放在这里；这个是链接文件，链接到/etc/rc.d/init.d</span>
<span class="cm">            csh.cshrc和csh.login： 用户启动c shells执行的初始化配置文件</span>
<span class="cm">            printcap：linux系统中打印机设备对应的配置文件</span>
<span class="cm">    --服务器目录：如samba、http、vsftpd等服务器配置相关目录</span>
<span class="cm">            cups：linux下的打印机服务器，目录下存放的是打印机服务的配置文件</span>
<span class="cm">            dnsmasq.d：dnsmasq是一种DNS的&quot;轻薄机种&quot;，转为区域或小型网络所设计，拥有比一般DNS更为方便简易的配置</span>
<span class="cm">            httpd：apache网页服务器的配置文件所在目录</span>
<span class="cm">            mail：Mail Server组件的主要配置目录，如sendmail</span>
<span class="cm">            ntp：网络时间服务器的配置目录，其主要配置文件为/etc/ntp.conf</span>
<span class="cm">            openldap：目录明显是LDAP的配置目录，软件名称为OpenLDAP</span>
<span class="cm">            postfix：postfix组件所提供的主要配置文件目录</span>
<span class="cm">            samba：文件共享服务samba的主要配置文件目录</span>
<span class="cm">            smrsh：这是sendmail为了限制用户可使用的命令设计的程序，将原本用户所使用的/bin/sh替换为/usr/sbin/smrsh</span>
<span class="cm">            snmp：简单网络管理软件的配置文件目录，存在snmpd.conf主配置文件</span>
<span class="cm">            squid：这是linux下的代理服务器squid的配置文件目录，主配置文件是squid.conf</span>
<span class="cm">            ssh：SSH服务的主要配置目录，主配置文件是sshd_config</span>
<span class="cm">            vsftpd：vsftpd服务器的主要配置目录，主配置文件是vsftpd.conf</span>
<span class="cm">            xinetd.d：xinetd是一个管理多个服务的daemon，这个目录下列出的服务都是由xinetd进程管理的，其主配置文件是/etc/xinetd.conf</span>
<span class="cm">    --系统目录：如sysconfig、xen或网络配置等与系统运行相关的目录</span>
<span class="cm">            blkid：此目录所存放一个块设备ID的临时文件，主要记录系统中所有区块设备的标签名称、硬件的唯一识别码、文件系统的格式等基本信息</span>
<span class="cm">            bluetooth：linux下使用蓝牙设备所需的配置文件；启动蓝牙检测的主要服务仍是/etc/rc.d/init.d/bluetooth，该程序使用的是</span>
<span class="cm">                       hcid.conf配置文件</span>
<span class="cm">            cron.X：cron.X的目录都是给cron软件存放其需要任务计划的文件所使用的，按任务计划时间的长短及配置特性分为cron.d、cron.daily、</span>
<span class="cm">                    cron.hourly、cron.monthly、cron.weekly五个主要目录</span>
<span class="cm">            dbus-1：D-BUS的主要配置目录，D-BUS也是一种IPC交流的方式</span>
<span class="cm">            default：这里是存放一些系统软件默认值的目录，存放某些软件执行时的基本参数</span>
<span class="cm">            firmware：这个目录所存放的东西是非常底层的信息，是CPU所需的microcode的实体文件</span>
<span class="cm">            foomatic：与打印机相关的配置目录，实现打印一对多的方式，在foomatic中，可以记录多条打印机数据，让用户只在使用前先行配置所有</span>
<span class="cm">                      需要使用的打印机即可</span>
<span class="cm">            hal：全名Hardware Abstraction Layer，是linux一种管理硬件的机制，它会帮所有的应用程序或用户搜集所有PCI及USB等硬件信息，</span>
<span class="cm">                因此用户可以很简单并实时地通过HAL的方式取得硬件的相关数据</span>
<span class="cm">            isdn：ISDN服务的主要配置目录，里面包含可拨号的用户、电话、联机方式等</span>
<span class="cm">            ld.so.conf.d：这个目录是ldconfig所使用的，更准确的说，它是由/etc/ld.so.conf文件所决定的；ldconfig命令的目的在于将系统</span>
<span class="cm">                          中的一些函数库预先存放到内存中，让系统使用时可以比以往通过硬盘的读取速度来的更快，这样可以大幅提高系统性能，</span>
<span class="cm">                          尤其当要重复读取时更明显；ldconfig要将哪些函数库丢到内存中，则须看/etc/ld.so.conf文件中所记录的信息</span>
<span class="cm">            logrotate.d：此目录对系统管理员来说，是十分重要的一个目录，因为目录中的文件，记录了如何定期备份系统所需要备份的系统或软件</span>
<span class="cm">                         日志文件及备份方式，目录是由logrotate组件所提供的，而里面所有文件是由各软件各自产生的；其主要配置文件是</span>
<span class="cm">                         /etc/logrotate.conf</span>
<span class="cm">            logwatch：logrotate主要是实现如何备份日志文件，这个目录就是记载如何分析日志文件并告诉用户的软件logwatch的配置目录</span>
<span class="cm">            lsb-release.d：LSB是一个由很多人所执行的项目，其目的是将所有的Linux发行版定义为一些共同的标准</span>
<span class="cm">            lvm：这个目录是LVM的基本配置文件，但配置或操作一般都只需要通过LVM提供的命令，而不会用到这个目录，除非要使用到很高级的配置</span>
<span class="cm">                才会更改此文件</span>
<span class="cm">            makedev.d：MAKEDEV软件对应的配置文件目录，MAKEDEV主要用来产生设备文件，也就是说，在/dev目录下的文件都由这个命令产生的，</span>
<span class="cm">                       此目录下的文件主要是针对设备文件的定义或属性，目录中存在的设备文件可以由MAKEDEV来创建，否则需要使用mknod命令</span>
<span class="cm">            modprobe.d：是modprobe命令的住配置目录，一般系统启动默认要加载的模块放在/etc/modprobe.conf中</span>
<span class="cm">            netplug和netplug.d：这两个目录和网络接口的联机与否由直接关系，因为主要是控制联机时的接口操作</span>
<span class="cm">            opt：此目录原本是定义为存放所有额外安装软件的主机配置文件，但目前并没有被使用到，此目录为空</span>
<span class="cm">            pcmcia：这是PCMCIA的配置文件目录，PCMCIA是笔记本电脑不可或缺的接口，需要即插即用的方式，此接口使用较少</span>
<span class="cm">            pm：由pm-utils组件所提供的目录，pm-utils是一套电源管理的工具软件，其中/usr/lib/pm-utils也是主要目录之一</span>
<span class="cm">            ppp：ppp相关的配置文件都放在这个目录中</span>
<span class="cm">            profile.d：目录存放系统部分的软件配置，但按不同的shell执行不同文件，默认所使用bash会直接执行该目录下所有扩展名为.sh的文件</span>
<span class="cm">            rc.d：主要用来定义在每一个执行阶段必须要执行哪些系统服务或程序，在目录中主要分为三个重要的部分：</span>
<span class="cm">                    --rc.sysinit：系统一开始启动时所遇到的第一个文件，此脚本记录服务启动之前所需准备的所有事情，包括启动时的欢迎画面</span>
<span class="cm">                    --rcX.d：在rc.sysinit文件之后所要执行的，X是系统启动时的initdefault值，值为几则会转到那个目录下，并执行其中的</span>
<span class="cm">                             所有文件，在此目录中，文件一律都由两个英文字母开始K和S，K代表kill，S代表Start</span>
<span class="cm">                    --rc.local：系统初始化过程中最后一个执行的脚本文件，可以将需要开机启动的程序或脚本放置在这个脚本文件中，以实现自动</span>
<span class="cm">                                运行的目的</span>
<span class="cm">            readahead.d：是readahead程序的主要配置目录，为了加速操作系统的使用速度，readahead_early和readahead_later这两个进程在</span>
<span class="cm">                         系统加载时，直接将日常所需要的一些文件，全部先放到硬盘的高速缓存中</span>
<span class="cm">            redhat-lsb：都lsb-release.d目录都是由程序redhat-lsb所提供的</span>
<span class="cm">            rwtab.d：这个目录是一个在启动时会去参考的目录，主要的文件在/etc/rwtab；这是一个系统初期的备份机制</span>
<span class="cm">            sane.d：这是在系统下要使用扫描仪所需的配置目录，主要配置文件是sane.conf，sane为了方便用户在各式的扫描仪连接时都可以使用，</span>
<span class="cm">                    因此在这一目录中放置了很多种不同类型扫描仪的硬件信息，让系统在检测到扫描仪时可以直接使用</span>
<span class="cm">            setuptool.d：这个目录是&quot;setup&quot;系统配置工具的主要配置目录</span>
<span class="cm">            skel：用于初始化用户宿主目录的配置目录，当建立一个用户时，会把此目录下的所有文件复制一份到用户的宿主目录，作为用户的初始化配置</span>
<span class="cm">            sysconfig：非常重要的系统配置文件的存放目录，里面放置了大量系统启动及运行相关的配置文件</span>
<span class="cm">            sysconfig/network-scripts/ifcfg-eth0：网卡eth0对应的配置文件，设置内容包括设备名称、IP地址、广播地址、网关地址、网段、</span>
<span class="cm">                                                  开机是否激活等参数</span>
<span class="cm">            udev：udev程序本身是一套设备的管理机制，udev通过sysfs的文件系统，可以正确地掌握目前系统上存在的硬件设备，以及针对每一个硬件</span>
<span class="cm">                  设备做出不同的判断与执行</span>
<span class="cm">            yum和yum.repos.d：两个都是yum配置目录，可用来替代rpm包管理方式，主配置文件是/etc/yum.conf；yum是更新方式及外挂程序的</span>
<span class="cm">                             配置目录，yum.repos.d是存放定期更新组件内容的信息</span>
<span class="cm">    --安全性目录：如selinux或pam.d等管理系统安全性的目录</span>
<span class="cm">            audit：这个目录所代表的是一种和目录名称一致的audit安全机制，主要以服务的方式协助管理员持续监控各文件被存取的情况；目录下的</span>
<span class="cm">                   audit.rules文件主要是定义一些必要的监控规则</span>
<span class="cm">            pam.d：此目录是Linux-PAM的所有配置文件，配合/lib/security目录中所有觉得函数库，提供Linux下的应用程序认证的机制</span>
<span class="cm">            pam_pkcs11：PAM机制中的一种登录模块，可以让用户通过smart card做登录的操作</span>
<span class="cm">            pki：PKI是一种公开密钥的管理方式，通过这样的管理模式，可以让所有网络传输有更多保障</span>
<span class="cm">            racoon：这个目录是由ipsec-tools组件所提供的，ipsec的主要目的是让系统实现VPN的网路技术，在racoon目录的主配置文件racoon.conf中，定义在ipsec操作中所需要的加密算法种类以及其他细节的配置</span>
<span class="cm">            security：与pam.d目录相辅相成，pam.d中的所有PAM的规则都要用到/lib/security下的PAM函数库，而/etc/security目录中，就是针对这些函数库，提供以配置文件的方式进行细节配置，对希望调整系统安全性部分增加了非常大的方便性</span>
<span class="cm">            selinux：selinux是一个很新的安全性方案，它是一种针对各种文件、目录、设备或daemon等在linux所需使用到的安全性机制，而且其安全性的数据时直接记录在文件系统中</span>
<span class="cm">            wpa_supplicant：这个目录被归类到安全性目录中，是因为其属于无线中安全认证的部分，存在wpa_supplicant.conf配置文件，用户可以在这个目录中加入已知可登陆的AP</span>
<span class="cm">    --X Windows目录：如X11或gdm管理X windows启动或使用上的配置目录</span>
<span class="cm">            alternatives：linux下可辨识扩展名的&quot;文件类型&quot;选项，可以针对同一类型的文件，选出一个默认用户所要使用的程序去执行；/etc/alternatives目录下有所有目前已经定义的程序名称，都以软链接的方式存在，里面每一个文件其实都有定义好的默认执行程序，可以使用alternatives命令查看及修改配置</span>
<span class="cm">            fonts：这个目录就是fontconfig软件的最主要配置目录，其中/etc/fonts/fonts.conf就是对应的配置文件，/etc/fonts目录下的配置都是以XML的方式配置的</span>
<span class="cm">            gconf：这一目录是GConf2的组件所建立的，GConf的作用就是提供GNOME下的应用程序注册的机制，有些类似于windows下的regedit</span>
<span class="cm">            gdm：全名为GNOME Display Manger，也就是协助X Windows启动的管理软件，在GDM中的主配置文件是custom.conf，在X windows下可以利用gdmsetup命令对这个文件进行配置</span>
<span class="cm">            gnome-vfs-2.0：GNOME VFS机制，让GNOME的系统可以知道每一种文件格式要如何开启或浏览，而所有的配置都需要有相对应的函数库</span>
<span class="cm">            gtk-2.0：由gtk+组件提供的目录，主要是提供X Windows窗口的颜色、按钮或图案，包含软件选项的画面、选项的按钮、滚动轴的样式等</span>
<span class="cm">            kde：KDE Desktop Manager的主要配置目录；主配置文件是kdmrc</span>
<span class="cm">            NetworkManager：此目录的目的是让用户不需要做任何操作和配置，只要用户曾经登陆过无线AP，系统就可以记录下来，以后再次登陆时就可以方便的登陆;</span>
<span class="cm">            pango：pango是一套协助GTK+将字体描绘出来的函数库，不论任何的字体或语言，都可以通过pango描绘出来</span>
<span class="cm">            rhgb：系统在进入X Windows之前，有一个前置配置的图形接口，这个接口就是rhgb，其主要目的是让系统启动变得漂亮</span>
<span class="cm">            scim：是Linux下目前很好用的输入法</span>
<span class="cm">            sound：GNOME下有许多的应用软件，很多都会有其特殊的声音，这个目录中存放所有声音的命令路径</span>
<span class="cm">            X11：X windows的核心配置目录；该目录下比较重要的文件有prefdm(判断X windows使用哪一个Display Manager)、主配置文件xorg.conf(定了X windows所需使用的键盘、鼠标、显卡等相关硬件设备，重点是关于显卡的配置)、xinit子目录(里面都是一些X windows资源相关的配置)</span>
<span class="cm">            xdg：X windows上的菜单画面，就是从这里出来的，所有在X windows中使用的菜单文字及分类，都可以在这个目录下做配置，其下的子目录menu，可以通过配置里面的文件自定义应用程序、系统管理、外观等菜单内容</span>
<span class="cm">    --其他目录：针对单一特殊软件的配置或未能按以上分类方式则放在此目录中</span>
<span class="cm">            a2ps.cfg和a2ps-site.cfg：用于将一份文件格式转换为postscript的格式，在某些打印机或要将文件输出成一份标准格式的文件时，它会被用到</span>
<span class="cm">            alsa：主要任务在于提供linux声音及声音的功能，并试着让其性能达到最佳化</span>
<span class="cm">            ghostscript：在linux下要读取Adobe格式文件(如pdf)，最方便的方式就是使用ghostscript命令，这个目录主要用于设置在显示时使用哪种字体作为默认字体</span>
<span class="cm">            gre.d：GRE是Mozilla注册的一种机制，目录中的配置文件gre.conf会注明所使用的Mozilla软件的路径和版本</span>
<span class="cm">            iproute2：iproute2是一套非常强大的网络管理软件，iproute2提供的功能有很多种，此目录中存放一些网络的基本配置值</span>
<span class="cm">            java：这个目录是由jpackage-utils软件提供的，这个目录是这个软件的主要配置目录，除此之外还有maven、jvm、jvm-common都是由jpackage-utils软件产生的，jpackage是一个专门为了提供java程序与函数库所存在的软件</span>
<span class="cm">            mgetty+sendfax：主要用于使用linux架构一台fax server，可以使用mgetty.config来配置需要有关传真接收和发送的操作</span>
<span class="cm">            php.d：主要存放的各软件(如dbase、ldap、mysql等)与php相关的配置文件</span>
<span class="cm">            reader.conf.d：存放smart card配置文件的目录，由程序pcsc-lite提供，这个程序的主配置文件是/etc/reader.conf</span>
<span class="cm">            dumpdates：存放dump命令的执行日期，dump命令可以对ext2/ext3文件系统进行检查备份</span>

<span class="cm">/home      默认存放用户的宿主目录(除了root用户)</span>
<span class="cm"> /home/~/.bashrc：提供bash环境中所需使用的别名</span>
<span class="cm"> /home/~/.bash_profile：提供bash环境所需的变量；一般先执.bashrc后，才会再执行.bash_profile</span>
<span class="cm"> /home/~/.bash_history：用户历史命令文件，记录用户曾经输入的所有命令；(默认为1000条，可以通过HISTSIZE变量更改)</span>
<span class="cm"> /home/~/.bash_logout：当用户注销的同时，系统会自动执.bash_logout文件，如果管理员需要记录用户注销的一些额外记录动作或其他信息，就可以利用这个机制去完成</span>

<span class="cm">/root     管理员root的宿主目录</span>

<span class="cm">/lib      需要共享的函数库与kernel模块，系统kernel启动所使用的函数库，或者当执行一些在/bin和/sbin中的命令时使用的函数库</span>

<span class="cm">/mnt      挂载点目录；一般的自动挂在/media目录(如磁盘分区，网络共享)</span>

<span class="cm">/media：移动存储设备默认挂载点；(如光盘)</span>

<span class="cm">/opt      常用于放置大型的应用软件；数据库文件</span>

<span class="cm">/proc    只存在于内存中的文件系统，保存操作系统的实时信息；内存信息，CPU信息，虚拟内存信息，电源信息；cpuinfo ,meminfo ,acpi,scsi,vmstat,uptime;每次启动操作系统都会自动创建一个新的/porc文件，来记录系统的实时信息；并不是存放在硬盘上，而是内存镜像中的；虚拟文件系统，此目录是kernel加载后，在内存里面建立的一个虚拟目录，有专属的文件系统，主要提供系统一些实时的信息，此目录下不能建立和删除文件；(某些文件可以修改)</span>
<span class="cm">    /proc主要作用可以整理为：</span>
<span class="cm">    --整理系统内部的信息</span>
<span class="cm">    --存放主机硬件信息</span>
<span class="cm">    --调整系统执行时的参数</span>
<span class="cm">    --检查及修改网络和主机的参数</span>
<span class="cm">    --检查及调整系统的内存和性能</span>
<span class="cm">    /proc下常用的信息文件有：</span>
<span class="cm">    /proc/cpuinfo：cpu的硬件信息，如类型、厂家、型号和性能等</span>
<span class="cm">    /proc/devices：记录所有在/dev目录中相关的设备文件分类方式</span>
<span class="cm">    /proc/filesystems：当前运行内核所配置的文件系统</span>
<span class="cm">    /proc/interrupts：可以查看每一个IRQ的编号对应到哪一个硬件备</span>
<span class="cm">    /proc/loadavg：系统&quot;平均负载&quot;，3个数据指出系统当前的工作负载</span>
<span class="cm">    /proc/dma：当前正在使用的DMA通道</span>
<span class="cm">    /proc/ioports：将目前系统上所有可看到的硬件对应到内存位置的配表的详细信息呈现出来</span>
<span class="cm">    /proc/kcore：系统上可以检测到的物理内存，主机内存多大，这个件就有多大</span>
<span class="cm">    /proc/kmsg：在系统尚未进入操作系统阶段，把加载kernel和initr的信息先记录到该文件中，后续会将日志信息写入/var/log/messag文件中</span>
<span class="cm">    /proc/meminfo：记录系统的内存信息</span>
<span class="cm">    /proc/modules：与lsmod命令查看到的模块信息完全一致</span>
<span class="cm">    /proc/mtrr：负责内存配置的机制</span>
<span class="cm">    /proc/iomem：主要用于储存配置后所有内存储存的明细信息</span>
<span class="cm">    /proc/partitions：这个文件可以实时呈现系统目前看到的分区</span>
<span class="cm">    /proc/数字目录：数字目录很多，它们代表所有目前正在系统中运行所有程序</span>
<span class="cm">    /proc/bus：有关该主机上现有总线的所有信息，如输入设备、PCI口、PCMCIA扩展卡及USB接口信息</span>
<span class="cm">    /proc/net目录：存放的都是一些网络相关的虚拟配置文件，都ASCII文件，可以查看(与ifconfig、arp、netstat等有关)</span>
<span class="cm">    /proc/scsi：保存系统上所有的scsi设备信息(包括sata和usb设备信息)</span>
<span class="cm">    /proc/sys目录：存放系统核心所使用的一些变量，根据不同性质的件而存放在不同的子目录中，可以通过/etc/sysctl.conf文件设置更改其默认值；变量时实时的变更，有很多设置很象是开关，设置后上生效</span>
<span class="cm">    /proc/tty：存放有关目前可用的正在使用的tty设备的信息</span>
<span class="cm">    /proc/self：存放到查看/proc的程序的进程目录的符号连接，当2进程查看proc时，这将会是不同的连接；主要便于程序得到它自己的程目录</span>
<span class="cm">    /proc/stat：系统的不同状态信息</span>
<span class="cm">    /proc/uptime：系统启动的时间长度</span>
<span class="cm">    /proc/version：系统核心版本</span>

<span class="cm">/sbin    存放特权级二进制文件（特权级可执行命令）只有root用户可以执行；较危险的命令保存其中；(多数管理命令默认只有管理员可以使用)</span>

<span class="cm">/usr：安装除操作系统本身外的一些应用程序或组件，一般可以认为linux系统上安装的应用程序默认都安装在此目录中</span>
<span class="cm">    /usr/bin：一般用户有机会使用到的程序，或者该软件默认就是要所有用户使用才会放在该目录中</span>
<span class="cm">    /usr/sbin：一些系统有可能会用到的系统命令，与/sbin比起来，是一些较次要的文件</span>
<span class="cm">    /usr/etc：自行安装或非系统主要的配置文件目录</span>
<span class="cm">    /usr/games：只要是电脑游戏相关的软件，就都安装到这个目录</span>
<span class="cm">    /usr/include：存放的文件都是一些系统中用户所会使用到的C语header文件，保存的都是&quot;.h&quot;的文件</span>
<span class="cm">    /usr/kerberos：kerberos是一种安全机制，让用户可以直接使用持kerberos机制系统上的部分资源</span>
<span class="cm">    /usr/lib：存放一些函数库、执行文件及连接文件，特别的是，存在这里面的文件都是不希望直接被用户或shell脚本所使用的文件，/usr/lib中有非常多的子目录，每一个软件都有其各自所需的函库</span>
<span class="cm">    /usr/libexec：这个目录下的文件及文件夹应该都可以放置/usr/lib下</span>
<span class="cm">    /usr/local：linux系统中安装的共享软件程序最好的方式是安装/usr/local下，按照linux标准目录结构，新建立的软件都应该放/usr/local下</span>
<span class="cm">        /usr/local/bin：存放软件执行文件的目录</span>
<span class="cm">        /usr/local/sbin：同样存放软件执行文件的目录，但此目录门针对系统所使用的文件</span>
<span class="cm">        /usr/local/lib：软件相关的函数库</span>
<span class="cm">        /usr/local/share：当文件性质不好归属时就会放在此，man册就放在这个目录下</span>
<span class="cm">        /usr/local/src：所安装软件的源代码放置在此</span>
<span class="cm">    /usr/share：此目录都是一些共享信息，最常被用到的就/usr/share/man这个目录，/usr/share里的信息时跨平台的</span>
<span class="cm">    /usr/share/doc：放置一些系统帮助文件的地方</span>
<span class="cm">    /usr/share/man：manpage的文件存放目录，也是使用man查看手册时查询的路径</span>
<span class="cm">    /usr/src：主要储存内核源代码的文件</span>
<span class="cm">    /usr/X11R6：存放一些X windows系统的相关文件</span>

<span class="cm">/var    动态文件或数据存放目录，默认日志文件都存放在这个目录下，一般建议把此目录单独划分一个分区</span>
<span class="cm">    /var/account：是linux系统下的审核机制(psacct)对应的目录</span>
<span class="cm">    /var/cache：该目录下的文件时所有程序所产生的缓存数据，也就是当应用程序启动时，会将数据留一份在这个目录中</span>
<span class="cm">    /var/empty：默认是sshd程序用到的这个目录，当建立ssh连接，ssh服务器必须使用该目录下的sshd子目录</span>
<span class="cm">    /var/ftp：ftp服务器软件一般默认会将匿名登陆的用户的宿主目录</span>
<span class="cm">    /var/gdm：gdm所使用的目录，里面存放一些系统当前所占用的console记录及通过gdm执行的X windows记录，只有通过gdm窗口的日志才会存放在此</span>
<span class="cm">    /var/lib：该目录下存放很多与应用程序名称同名的子目录，每个子目录下都是应用执行的状态信息</span>
<span class="cm">    /var/lock：每个服务一开始都会在这个目录下产生一个该服务的空文件，主要是避免服务启动冲突</span>
<span class="cm">    /var/log：常用目录，专门用来存放所有日志文件的目录，里面存放很多系统、软件、用户等相关的日志信息；里面有一些文件是比较常用的</span>
<span class="cm">        lastlog：记录用户最后一次登录的信息，使用lastlog命令读取</span>
<span class="cm">        message：记录系统的几乎所有信息，主要包括启动信息，syslogd服务记录的信息等</span>
<span class="cm">        wtmp：记录所有用户登陆及注销的信息，使用last命令读取</span>
<span class="cm">        secure：记录登录系统访问数据的文件，如ssh pop3 telnet ftp等都会记录在此文件中</span>
<span class="cm">        /var/log/httpd/access_log：httpd访问日志</span>
<span class="cm">        /var/log/httpd/error_log：httpd错误日志</span>
<span class="cm">        btmp：记录失败的用户登录</span>
<span class="cm">        utmp： 纪录当前登录的每个用户</span>
<span class="cm">        xferlog：ftp会话日志</span>
<span class="cm">        boot.log：记录开机或一些服务启动时所显示的启动和关闭信息</span>
<span class="cm">        /var/log/maillog或/var/log/mail/*：记录邮件访问或往来的用户信息</span>
<span class="cm">        cron： 记录crontab例行性服务的内容</span>
<span class="cm">        dmesg：开机引导日志信息</span>
<span class="cm">        sudolog：纪录使用sudo发出的命令</span>
<span class="cm">        sulog： 纪录使用su命令的使用</span>
<span class="cm">    /var/named：bind软件实现的DNS服务器的区域数据文件都存放在这个目录下</span>
<span class="cm">    /var/nis和/var/yp：都是NIS服务机制所使用的目录，nis主要记录所有网络中每一个client的连接信息；yp是linux的nis服务的日志文件存放的目录</span>
<span class="cm">    /var/run：此目录中的大部分文件都记载目前系统正在执行程序的PID值，每一个文件都是以个独立的PID记录；此目录下存放一个特殊文件utmp，此文件记录目前谁在使用系统，必须使用utmpdump命令才能看到其中的内容</span>
<span class="cm">    /var/spool：里面主要都是一些临时存放，随时会被用户所调用的数据；打印机、邮件、代理服务器等假脱机目录存放在该目录下</span>
<span class="cm">    /var/tmp：专门为了一些应用程序在安装或执行时，需要在重启后使用的某些文件时，能将该文件暂时存放在这个目录中，完成后再行删除</span>
<span class="cm">    /var/www：apache网页服务器的宿主目录</span>

<span class="cm">/lost+found:存放了一些系统出错的检查结果；异常断电情况，死机；默认目录是空的,一般会使用fsck进行文件修复，而这些被修复或救回的文件，就会被放在这个目录下</span>

<span class="cm">/misc：自动挂载服务目录，对应autofs服务</span>

<span class="cm">/srv：默认为空，主要用于存放一些软件的配置文件，某些软件可能会把配置文件默认存放在这个目录下，多数都是/etc目录下，此目录没有被具体的定义</span>

<span class="cm">/temp  临时文件存放点；此目录有特殊的权限位粘滞位：1777</span>

<span class="cm">/tftpboot：远程启动tftpserver的根目录，这个目录只有安装了tftp-server软件后才会产生</span>

<span class="cm">备注：</span>
<span class="cm">/sbin  /usr/sbin是root账户可以执行命令的存放路径</span>
<span class="cm">/bin  /usr/bin对于普通用户可以执行命令的存放路径</span>
<span class="cm">bin代表binnary ；sbin 代表super binnary</span>
<span class="cm">/usr目录的重要性是和windows系统上的windows目录的重要性是一样的，都是核心文件存放的位置</span>

<span class="cm">如果要做系统级备份的话，/etc ,/boot是必须要备份的目录</span>
<span class="cm">备份分为了系统备份和用户备份两种</span>
</pre></div>

<h3 id="_10">添加硬盘或分区流程<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1"># 分区指令fdisk--创建文件系统mkfs--挂载mount--写入配置文件/etc/fstab;</span>
dmesg <span class="p">|</span> grep sdb    <span class="c1"># 检测硬盘是否被识别</span>

<span class="c1"># fdisk指令操作和查询</span>
fdisk -l /dev/sdb   <span class="c1"># 查看硬盘的信息</span>
fdisk /dev/sdb <span class="c1"># 对硬盘进行分区操作</span>
: <span class="s">&lt;&lt; comment</span>
<span class="s"># 常用的分区命令：</span>
<span class="s">m help</span>
<span class="s">p print the partition table</span>
<span class="s">n add a new partition</span>
<span class="s">t change a partition&#39;s system id</span>
<span class="s">w write table to disk and exit</span>
<span class="s">q quit without saving changes</span>
<span class="s">默认的文件系统类型是ext4;id 83 ,system type linux</span>
<span class="s">id=82 /swap</span>
<span class="s">id=83 linux</span>
<span class="s">comment</span>

<span class="c1"># 格式化操作</span>
mkfs.ext4
mkfs -t ext4
<span class="c1">#windows操作系统当中的文件系统是NTFS,fat32。前者支持磁盘配额和文件压缩，后者不支持</span>

mount /dev/sdb7 /test/cisco <span class="c1"># 将/dev/sdb7分区挂载到目录/test/cisco下</span>

<span class="c1"># 写入启动自动挂载文件/etc/fatab。添加分区让系统启动时自动挂载：/etc/fstab文件</span>
: <span class="s">&lt;&lt; comment</span>
<span class="s">文件中的每行由六个部分组成：含义如下</span>
<span class="s">1，物理分区/卷标</span>
<span class="s">2，挂载点,</span>
<span class="s">3，文件系统,</span>
<span class="s">4，缺省设置,</span>
<span class="s">5，表示文件系统是否需要dump备份（dump是备份工具），一般设为1时表示需要，设为0时将被dump所忽略</span>
<span class="s">6，该数字用于决定在系统启动时进行磁盘检查的顺序，0不进行检查，1优先，2其次。对于根分区应设为1，其它分区设为2</span>

<span class="s">/dev/sdb1                     /cisco                ext4          defaults  1  2</span>
<span class="s">LABLE=network             /cisco              ext4          defaults  1  2</span>
<span class="s">comment</span>
e2lable /dev/sdb1   <span class="c1"># 查看分区的卷标</span>
e2lable /dev/sdb1 network   <span class="c1"># 设置分区的卷标</span>
</pre></div>

<h3 id="linux_3">linux系统引导流程解析<a class="headerlink" href="#linux_3" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>系统引导流程：
首先，<span class="nv">PC</span>，<span class="nv">server</span>，<span class="nv">any</span> <span class="nv">device</span> ,它们的第一步都是一样的
固件<span class="nv">firmware</span> <span class="ss">(</span><span class="nv">CMOS</span><span class="o">/</span><span class="nv">BIOS</span><span class="ss">)</span>  <span class="nv">post</span>加电自检
对于固件的理解，是介于软件和硬件之间的软件代码，但同时烧录到硬件当中；<span class="nv">CMOS</span>固化在硬件中，作为固件的平台，<span class="nv">BIOS</span>是管理<span class="nv">CMOS</span>的管理界面

接着，自举程序<span class="nv">bootloader</span> <span class="ss">(</span><span class="nv">GRUB</span><span class="ss">)</span>,载入内核
第一步的最后要读取硬盘中的<span class="nv">MBR</span>，包含了<span class="nv">BootLoader</span>,在<span class="nv">MBR</span>中还包含了分区表等信息

内核的工作，驱动硬件，启动初始进程<span class="nv">init</span><span class="c1">;在kernel中大部分的东东都是动程序；init启动后读取inittab文件，执行缺省默认的运行级别，从而继引导过程；在linux系统中，init是第一个存在的进程，它的PID恒为一，但也必须向一个更高级的功能负责：PID为零的内核调度器，从而获得cpu时间</span>

关键点：对于父子进程的关系。首先，父进程中断，子进程同样会中断；如果父进程中断后，子进程没有中断，这种关系形象称之为孤儿进程，系统发现后会将孤儿进程指向父进程<span class="nv">init</span><span class="c1">;如果父进程正常，而子进程中断的话，这样滴关系称之为僵尸进程；这两种进程在系统中不允许出现的</span>

备注：<span class="nv">linux</span>中的运行级别类似于<span class="nv">windows</span> 平台中的<span class="nv">F8</span>功能
单用户模式（级别<span class="mi">1</span>）类似<span class="nv">windos</span>平台中<span class="nv">F8</span>的安全模式，区别是没有图形界面，只有命令输入
运行级别<span class="mi">2</span> 和 <span class="mi">3</span>的区别就是<span class="mi">2</span>级别没有<span class="nv">NFS</span>功能，同时都是多用户模式
查看当前的运行级别：<span class="nv">runlevel</span>
运行级别的切换：<span class="nv">init</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span>  <span class="nv">S</span> 或者 <span class="nv">telinit0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span>

扩展：实际大家通过命令<span class="nv">ls</span> <span class="o">-</span><span class="nv">l</span> `<span class="nv">which</span> <span class="nv">telinit</span>`得知<span class="nv">telinit</span>名是<span class="nv">init</span>命令的一个软连接而已

<span class="nv">grep</span> <span class="o">-</span><span class="nv">v</span> <span class="s2">&quot;</span><span class="s">^#</span><span class="s2">&quot;</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">inittabl</span> #提取有效行，作为分析数据
文件格式分析：（字段组成结构如下所示：）
<span class="nv">id</span>:<span class="nv">runlevels</span>：<span class="nv">action</span>:<span class="nv">process</span>
<span class="nv">id</span> 标示符,一般都是两位字母或者数字
<span class="nv">runlevels</span>:指定运行级别，可以指定多个；例如::代表<span class="mi">0</span><span class="o">-</span><span class="mi">6</span>
<span class="nv">action</span>:指定运行状态
<span class="nv">process</span>:指定要运行的脚本或者命令

<span class="nv">action</span>取值：
<span class="nv">initdefault</span>表示系统缺省的启动运行级别
<span class="nv">sysinit</span>；系统启动时执行<span class="nv">process</span>中指定的命令
<span class="k">wait</span>:执行<span class="nv">process</span>中指定命令，并等到结束后在运行其他的命令
<span class="nv">one</span>:执行<span class="nv">process</span>中指定的命令，不需要等待结束
<span class="nv">ctrlaltdel</span>:按下组合键执行<span class="nv">process</span>指定的命令；<span class="ss">(</span>关机的操作<span class="ss">)</span>


实例<span class="mi">1</span>：
<span class="nv">id</span>:<span class="mi">5</span>:<span class="nv">initdefault</span>:
<span class="nv">id</span>:<span class="mi">3</span>:<span class="nv">initdefault</span>:
#<span class="nv">initdefault</span>表示系统缺省的启动运行级别

案例<span class="mi">2</span>：
<span class="nv">si</span>::<span class="nv">sysinit</span>:<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">sysinit</span>
#运行状态<span class="nv">sysinit</span>表示系统启动时执行<span class="nv">process</span>中指定的指令
#只要系统启动就会执行脚本<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">sysinit</span>（任何运行级别）
#脚本的主要作用：完成系统服务程序启动，设置系统时钟，加载字体，检查加载系统，生成系统启动信息日志，设置系统环境变量
我们可以将一些脚本或者命令写入<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">sysinit</span>中，重启后在任何启动级别中执行操作
##############

先后顺序：
<span class="mi">1</span>，<span class="nv">id</span>:<span class="mi">3</span>:<span class="nv">initdefault</span>：
<span class="mi">2</span>，<span class="nv">l3</span>:<span class="mi">3</span>:<span class="k">wait</span>:<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">rc</span>
<span class="mi">3</span>,<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">rc3</span>.<span class="nv">d</span>
分析：
判断默认的运行级别调用<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">rc</span>脚本，执行相关运行级别目录中的服务程序，完成相应运行级别的初始化配置；之后找到<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">rc3</span>.<span class="nv">d</span>脚本，完成系统后续的引导过程，其作用是分别存放对应于运行级别的服务程序脚本的符号链接，链接到<span class="nv">init</span>.<span class="nv">d</span>目录中的相应脚本
<span class="nv">ls</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">r3</span>.<span class="nv">d</span> 里面包含了两种文件很重要，一种大写<span class="nv">S</span>开头，另一种是大写的<span class="nv">K</span>开头
<span class="nv">sys19syslog</span>
<span class="nv">S</span>  <span class="nv">start</span>   <span class="nv">K</span>  <span class="nv">kill</span>  <span class="nv">number</span> 表示启动的顺序，数字越小优先启动；如果数字相同，那么就会按照创建的时间

<span class="nv">Firmware</span>
   <span class="o">|</span>
<span class="nv">BootLoader</span>
   <span class="o">|</span>
<span class="nv">Kernel</span>
   <span class="o">|</span>
 <span class="nv">init</span>
   <span class="o">|</span>
<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">inittab</span>
   <span class="o">|</span>
<span class="nv">initdefault</span>
   <span class="o">|</span>
<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">sysinit</span>
   <span class="o">|</span>
<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">rc</span>
   <span class="o">|</span>
<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">rcN</span>.<span class="nv">d</span>
   <span class="o">|</span>
<span class="nv">Login</span><span class="ss">(</span><span class="nv">username</span> ,<span class="nv">password</span><span class="ss">)</span>

启动系统首先固件的加电自检；典型为<span class="nv">PC</span>中<span class="nv">cmos</span><span class="o">/</span><span class="nv">bios</span>作用是在物层次面上检测所有的硬件是否正常工作；如果硬件正常的话，会读取硬盘的上存放物理数据的第一个位置<span class="nv">MBR</span>，<span class="nv">MBR</span>主要是存放自举程序<span class="nv">BootLoader</span>，在<span class="nv">linux</span>系统中我们大多数采用的是<span class="nv">GRUB</span>，<span class="nv">GRUB</span>的主要作用就是载入内核；载入内核后，两个作用，第一是在<span class="nv">linux</span>操作系统层面上是驱动硬件和启动<span class="nv">init</span>进程；然后读取<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">inittab</span>配置文件，配置文件会判断系统缺省的运行级别然后执行脚本<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">sysinit</span>加载基本的系统服务；接着
根据设置的缺省系统运行级别（<span class="nv">id</span>:<span class="mi">3</span>,<span class="mi">5</span>:<span class="nv">initdefault</span>:）执行<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">rc</span>脚本，此脚本会判断<span class="nv">initdefault</span>，然后启动对应的运行级别目录下面的程序<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">rcN</span>.<span class="nv">d</span>，最后出现登陆界面了，输入正确的用户名和密码即可登录系统继而管理服务器

<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">init</span>.<span class="nv">d</span>该目录下存放了各个运行级别的服务程序脚本；<span class="nv">ls</span> <span class="o">-</span><span class="nv">ld</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">init</span>.<span class="nv">d</span> <span class="c1">; ls -l /etc/rc.d/init.d;</span>
<span class="nv">ls</span> <span class="o">-</span><span class="nv">ld</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">init</span>.<span class="nv">d</span> 发现此文件是<span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">rc</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">init</span>.<span class="nv">d</span>的软连接
设置自启动程序：
<span class="nv">ls</span> <span class="o">-</span><span class="nv">s</span>
<span class="nv">chkconfig</span>
<span class="nv">ntsysv</span>

实例：
<span class="nv">chkconfig</span>
<span class="nv">chkconfig</span> <span class="o">--</span><span class="nv">list</span>
<span class="nv">chkconfig</span> <span class="o">--</span><span class="nv">list</span> <span class="nv">sshd</span>
<span class="nv">chkconfig</span> <span class="o">--</span><span class="nv">levels</span> <span class="mi">2345</span> <span class="nv">sshd</span> <span class="nv">on</span>

实例：
<span class="nv">ntsysv</span> <span class="o">--</span><span class="nv">level</span> <span class="mi">3</span>图形界面来选择自动启动的服务级别
扩展：
<span class="nv">dmesg</span> <span class="o">|</span> <span class="nv">grep</span> <span class="nv">eth0</span> 内核驱动硬件的过程中是否识别网卡信息；主要反馈的信息是在<span class="nv">kernel</span>中的驱动硬件过程中；在<span class="nv">linux</span>操作系统当中所有的日志文件都存放在<span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">log</span>目录中

<span class="nv">dmesg</span> <span class="o">|</span> <span class="nv">grep</span> <span class="nv">USB</span>
</pre></div>

<h3 id="grub">GRUB配置文件讲解：<a class="headerlink" href="#grub" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="err">配置文件位置：</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">grub</span><span class="p">.</span><span class="n">conf是个软连接文件</span>
<span class="err">原始文件</span><span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">grub</span><span class="o">/</span><span class="n">grub</span><span class="p">.</span><span class="n">conf</span>
<span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="ss">&quot;^#&quot;</span> <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">grub</span><span class="o">/</span><span class="n">grub</span><span class="p">.</span><span class="n">conf</span> <span class="o">|</span> <span class="k">more</span>
<span class="err">字段：</span>
<span class="n">default定义缺省启动系统</span><span class="p">,</span><span class="mi">0</span><span class="err">表示第一个，</span><span class="mi">1</span><span class="err">表示第二个，以此类推</span>
<span class="c1">-------------------------------------------------</span>
<span class="n">timeout定义了缺省等待时间</span><span class="err">；默认</span><span class="mi">5</span><span class="err">秒</span>
<span class="c1">-----------------------------------------------</span>
<span class="n">splashimage定义了GRUB启动时的界面图片</span>
<span class="c1">-----------------------------------------</span>
<span class="n">hiddenmenu隐藏菜单</span>
<span class="c1">--------------------------------------</span>
<span class="n">title定义了菜单项名称</span>
<span class="c1">----------------------------------------</span>
<span class="n">root作用是设置GRUB的根设备也就是内核所在的分区</span>
<span class="c1">---------------------------------------------</span>
<span class="n">kernel</span> <span class="err">定义了内核文件所在的位置</span>
<span class="c1">---------------------------------------------</span>
<span class="n">initrd命令加载镜像文件以及显示镜像文件的位置</span>
<span class="c1">--------------------------------------------</span>
<span class="err">以上的几个字段选项是重点，加强记忆和操作</span>


<span class="n">GRUB设置密码</span>


<span class="mi">1</span><span class="err">，使用</span><span class="n">GRUB自带的grub</span><span class="o">-</span><span class="n">md5</span><span class="o">-</span><span class="n">crypt命令</span>
<span class="o">#</span><span class="n">grub</span><span class="o">-</span><span class="n">md5</span><span class="o">-</span><span class="n">crypt</span>
<span class="n">passowrd</span><span class="p">:</span>
<span class="err">在图形界面我可以选择复制选项进行复制，在字符终端界面上使用鼠标右键复制加密字符</span>
<span class="err">编辑</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">grub</span><span class="p">.</span><span class="n">conf配置文件</span><span class="err">，在</span><span class="n">hiddenmenu字段下面插入关于插入位置没有严格的要求</span><span class="err">）</span>
<span class="n">password</span> <span class="c1">--md5 加密字符（-md5表示口令是md5加密的）</span>
<span class="err">在插入模式下插入加密的字符串；然后退出保持即可</span>


<span class="mi">2</span><span class="err">，第二中方式是在</span><span class="n">GRUB交互命令行界面使用md5crypt命令</span>
<span class="o">#</span><span class="n">grub</span>
<span class="n">grub</span><span class="o">&gt;</span><span class="n">md5crypt</span>
<span class="n">password</span><span class="p">:</span>
<span class="err">实现效果是一样的</span>

<span class="n">GRUB的系统修复</span><span class="err">：（手工修复）故意修改</span><span class="n">kernel指定的内核文件</span>
<span class="n">grub</span><span class="o">&gt;</span> <span class="n">cat</span> <span class="o">/</span><span class="n">grub</span><span class="o">/</span><span class="n">grub</span><span class="p">.</span><span class="n">conf</span>  <span class="err">为什么没有</span><span class="o">/</span><span class="n">boot原因就是grub存放在</span><span class="o">/</span><span class="n">boot分区</span>
<span class="n">grub</span><span class="o">&gt;</span> <span class="err">指定内核所在的分区</span> <span class="n">root</span> <span class="p">(</span><span class="n">hd0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">grub</span><span class="o">&gt;</span> <span class="err">指定内核文件所在的位置</span>
<span class="n">grub</span><span class="o">&gt;</span> <span class="err">指定镜像文件的位置</span>
<span class="n">grub</span><span class="o">&gt;</span> <span class="n">boot</span>
<span class="err">手工修复属于命令行操作；如果有人修改了</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">inittab中的默认启动级别的话</span><span class="err">，我们完全可以通过</span><span class="n">grub启动菜单来进行修复</span><span class="err">：在</span><span class="n">kernel行直接加入启动级别</span>

<span class="err">终极修复模式：光盘修复</span>
<span class="err">光盘引导，</span><span class="n">F5键</span><span class="err">，键入</span><span class="n">linux</span> <span class="n">rescue</span>
<span class="err">案例</span><span class="mi">1</span><span class="err">：</span>
<span class="err">尝试删除</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">inittab</span><span class="err">，之前先做好备份；</span><span class="n">cp</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">inittab</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">inittab</span><span class="p">.</span><span class="n">bak</span>
<span class="n">cp</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">inittab</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">inittab</span><span class="p">.</span><span class="n">back</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">inittab</span>

<span class="err">案例</span><span class="mi">2</span><span class="err">：如果忘记了管理员密码，同时也忘记了</span><span class="n">GRUB的保护密码的话</span><span class="err">，我们可以使用</span><span class="n">GRUB的系统修复或者使用光盘的引导修复来解决此问题</span>
</pre></div>

<h2 id="linux_">Linux_用户、组和权限<a class="headerlink" href="#linux_" title="Permanent link">&para;</a></h2>
<h3 id="linux_4">Linux用户和用户组<a class="headerlink" href="#linux_4" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="o">#</span> <span class="err">查看系统中有多少的用户数量</span>
<span class="n">wc</span> <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>
<span class="n">cut</span> <span class="o">-</span><span class="n">d</span> <span class="ss">&quot; : &quot;</span> <span class="o">-</span><span class="n">f</span> <span class="mi">1</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>

<span class="o">#</span> <span class="err">用户和组的文件</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="k">group</span>

<span class="o">#</span> <span class="err">影子口令：（真正口令文件路径）</span>
<span class="err">用户：</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shadow</span>
<span class="err">组：</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">gshadow</span>

<span class="o">#</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd中7段意义</span><span class="err">：用户名：密码：</span><span class="n">UID</span><span class="p">:</span><span class="n">GID</span><span class="err">：用户描述信息：家目录：默认</span><span class="n">SHELL</span>
<span class="n">account</span><span class="p">:</span> <span class="err">用户名</span>
<span class="n">password</span><span class="p">:</span> <span class="err">密码</span>
<span class="n">UID</span><span class="err">：用户</span><span class="n">ID</span><span class="err">，分为三类：</span><span class="n">root用户</span><span class="err">：</span><span class="mi">0</span><span class="err">，普通用户：</span><span class="mi">500</span><span class="o">-</span><span class="mi">60000</span><span class="err">，伪用户：</span><span class="mi">1</span><span class="o">-</span><span class="mi">499</span>
<span class="n">GID</span><span class="err">：组</span><span class="n">ID</span><span class="err">，每个用户至少属于一个组，每个组可以有多个用户，同一用户组的用户继承改组的权限</span>
<span class="err">用户描述信息</span><span class="p">:</span><span class="err">针对用户的简介</span>
<span class="n">HOME</span> <span class="n">DIR</span><span class="err">：家目录</span>
<span class="n">SHELL</span><span class="err">：用户的默认</span><span class="n">shell</span>

<span class="o">#</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">group中4段意义</span><span class="err">：组名：密码：</span><span class="n">GID</span><span class="p">:</span><span class="err">以此组为其附加组的用户列表</span>

<span class="o">#</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shadow中8段意义</span><span class="err">：</span>
<span class="err">字段</span><span class="mi">1</span><span class="err">：用户帐号的名称</span>
<span class="err">字段</span><span class="mi">2</span><span class="err">：加密的密码字串信息</span>
<span class="err">字段</span><span class="mi">3</span><span class="err">：上次修改密码的时间（</span><span class="mi">1970</span><span class="o">/</span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="err">距修改时间的天数）</span>
<span class="err">字段</span><span class="mi">4</span><span class="err">：密码的最短有效天数，默认值为</span><span class="mi">0</span>
<span class="err">字段</span><span class="mi">5</span><span class="err">：密码的最长有效天数，默认值为</span><span class="mi">99999</span>
<span class="err">字段</span><span class="mi">6</span><span class="err">：提前多少天警告用户口令将过期，默认值为</span><span class="mi">7</span>
<span class="err">字段</span><span class="mi">7</span><span class="err">：在密码过期之后多少天禁用此用户</span>
<span class="err">字段</span><span class="mi">8</span><span class="err">：帐号失效时间，默认值为</span> <span class="err">空</span>
<span class="err">字段</span><span class="mi">9</span><span class="err">：保留字段（未使用</span><span class="p">)</span>

<span class="o">#</span> <span class="err">伪用户：</span>
<span class="err">伪用户就是系统和程序操作时调用的用户，与系统和程序服务相关。例如：</span><span class="n">bin</span><span class="err">、</span><span class="n">daemon</span><span class="err">、</span><span class="n">shutdown</span><span class="err">、</span><span class="n">halt等</span><span class="err">，任何</span><span class="n">linux操作系统都默认</span>
<span class="err">有这些伪用户，是系统自动生成的，例如：</span><span class="n">mail</span><span class="err">、</span><span class="n">apache</span><span class="err">、</span><span class="n">ftp等</span><span class="err">，与</span><span class="n">linux系统的进程相关</span><span class="err">，而且此类的用户不需要登录或者是无法登录</span>
<span class="err">系统当中，同时也可以没有相应的宿主目录</span>

<span class="o">#</span> <span class="err">扩展知识点：</span>
<span class="err">关于建立用户设置密码的过程分析：密码先写入</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd文件的第二个字段</span><span class="err">，接着通过指令转到</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">shadow文件中</span><span class="err">，转化的命令是</span><span class="n">psconv</span><span class="err">，</span>
<span class="err">过程是自动完成，回写的命令是</span><span class="n">pwunconv</span><span class="err">，执行此命令后密码会在</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd中的第二个字段X中出现且是加密的</span><span class="err">，这也说明了密码位保留的原因</span>

<span class="err">登陆信息文件：</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">motd</span>  <span class="err">登录成功后会看到提示信息</span>
<span class="err">修改</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">issue文件的话</span><span class="err">，是在登录之前就可以看到；为了安全起见，防止看到操作系统的版本信息，可以修改</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">issue文件的内容或者直接删除即可</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">issue</span><span class="p">.</span><span class="n">net文件中的信息是作为telnet服务的提示信息</span>

<span class="n">issue</span> <span class="err">内的各代码意义表示如下所示：（管理人员可以自行添加）</span>
<span class="o">/</span><span class="n">l</span> <span class="err">显示第几个终端机接口</span>
<span class="o">/</span><span class="n">m</span> <span class="err">显示硬件的等级</span> <span class="p">(</span><span class="n">i386</span><span class="o">/</span><span class="n">i486</span><span class="o">/</span><span class="n">i586</span><span class="o">/</span><span class="n">i686</span><span class="p">...)</span>
<span class="o">/</span><span class="n">n</span> <span class="err">显示主机的网络名称</span>
<span class="o">/</span><span class="n">o</span> <span class="err">显示</span> <span class="k">domain</span> <span class="n">name</span>
<span class="o">/</span><span class="n">r</span> <span class="err">操作系统的版本</span> <span class="p">(</span><span class="err">相当于</span> <span class="n">uname</span> <span class="o">-</span><span class="n">r</span><span class="p">)</span>
<span class="o">/</span><span class="n">t</span> <span class="err">显示本地端时间的时间</span>
<span class="o">/</span><span class="n">s</span> <span class="err">操作系统的名称</span>
<span class="o">/</span><span class="n">v</span> <span class="err">操作系统的版本</span>
</pre></div>

<h3 id="r-w-x">权限：r, w, x<a class="headerlink" href="#r-w-x" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="o">#</span> <span class="err">文件权限：</span>
<span class="n">r</span><span class="c1">--4：可读</span>
<span class="n">w</span><span class="c1">--2：可写</span>
<span class="n">x</span><span class="c1">--1: 可执行，eXacutable</span>
<span class="o">#</span> <span class="err">目录权限：</span>
<span class="n">w</span><span class="p">:</span> <span class="err">可以在此目录创建文件</span>
<span class="n">r</span><span class="p">:</span> <span class="err">可以对此目录执行</span><span class="n">ls以列出内部的所有文件</span>
<span class="n">x</span><span class="p">:</span> <span class="err">可以使用</span><span class="n">cd切换进此目录</span><span class="err">，也可以使用</span><span class="n">ls</span> <span class="o">-</span><span class="n">l查看内部文件的详细信息</span>
<span class="o">#</span> <span class="err">权限三位一体：</span>
<span class="n">rwx</span><span class="p">:</span><span class="err">可读可学可执行</span>
<span class="n">r</span><span class="c1">--:只读</span>
<span class="n">r</span><span class="o">-</span><span class="n">x</span><span class="p">:</span><span class="err">读和执行</span>
<span class="c1">---：无权限</span>
<span class="o">#</span> <span class="err">八进制表示：</span>
<span class="mi">0</span> <span class="mi">000</span> <span class="c1">---：无权限</span>
<span class="mi">1</span> <span class="mi">001</span> <span class="c1">--x: 执行</span>
<span class="mi">2</span> <span class="mi">010</span> <span class="o">-</span><span class="n">w</span><span class="o">-</span><span class="p">:</span> <span class="err">写</span>
<span class="mi">3</span> <span class="mi">011</span> <span class="o">-</span><span class="n">wx</span><span class="p">:</span> <span class="err">写和执行</span>
<span class="mi">4</span> <span class="mi">100</span> <span class="n">r</span><span class="c1">--: 只读</span>
<span class="mi">5</span> <span class="mi">101</span> <span class="n">r</span><span class="o">-</span><span class="n">x</span><span class="p">:</span> <span class="err">读和执行</span>
<span class="mi">6</span> <span class="mi">110</span> <span class="n">rw</span><span class="o">-</span><span class="p">:</span> <span class="err">读写</span>
<span class="mi">7</span> <span class="mi">111</span> <span class="n">rwx</span><span class="p">:</span> <span class="err">读写执行</span>
<span class="o">#</span> <span class="err">例如：</span>
<span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="c1">-----: 640</span>
<span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="c1">--r--: 644</span>
<span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="c1">----: 660</span>
<span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="p">:</span> <span class="mi">755</span>
<span class="n">rwxrwxr</span><span class="o">-</span><span class="n">x</span><span class="p">:</span> <span class="mi">775</span>
</pre></div>

<h3 id="_11">三、管理命令<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="m">1</span>.用户管理命令：useradd, userdel, usermod, passwd, chsh, chfn, finger, id, chage
<span class="m">1</span><span class="o">)</span>.useradd  <span class="o">[</span>options<span class="o">]</span>  USERNAME
-u UID
-g GID（基本组）
-G GID,...  （附加组）
-c <span class="s2">&quot;COMMENT&quot;</span>
-d /path/to/directory
-s SHELL
-m -k
-M
-r: 添加系统用户
<span class="m">2</span><span class="o">)</span>.userdel <span class="o">[</span>option<span class="o">]</span> USERNAME
-r: 同时删除用户的家目录
<span class="m">3</span><span class="o">)</span>.id：查看用户的帐号属性信息
-u
-g
-G
-n
<span class="m">4</span><span class="o">)</span>.finger: 查看用户帐号信息
finger USERNAME
<span class="m">5</span><span class="o">)</span>.usermod：修改用户帐号属性
-u UID
-g GID
-a -G GID：不使用-a选项，会覆盖此前的附加组
-c
-d -m：
-s
-l
-L：锁定帐号
-U：解锁帐号
<span class="m">6</span><span class="o">)</span>.chsh: 修改用户的默认shell
<span class="m">7</span><span class="o">)</span>.chfn：修改注释信息
<span class="m">8</span><span class="o">)</span>.passwd：密码管理
passwd <span class="o">[</span>USERNAME<span class="o">]</span>
--stdin
-l
-u
-d: 删除用户密码
<span class="m">9</span><span class="o">)</span>.pwck：检查用户帐号完整性
<span class="m">2</span>.组管理命令：groupadd, groupdel, groupmod, gpasswd
<span class="m">1</span><span class="o">)</span>.groupadd：创建组
-g GID
-r：添加为系统组
<span class="m">2</span><span class="o">)</span>.groupmod
-g GID
-n GRPNAME
<span class="m">3</span><span class="o">)</span>.groupdel
<span class="m">4</span><span class="o">)</span>.gpasswd：为组设定密码
<span class="m">5</span><span class="o">)</span>.newgrp GRPNAME &lt;--&gt; <span class="nb">exit</span>
<span class="m">6</span><span class="o">)</span>.chage：更改密码使用时间
-d: 最近一次的修改时间
-E: 过期时间
-I：非活动时间
-m: 最短使用期限
-M: 最长使用期限
-W: 警告时间
<span class="m">3</span>.权限管理：chown, chgrp, chmod, <span class="nb">umask</span>
<span class="m">1</span><span class="o">)</span>.chown: 改变文件属主<span class="o">(</span>只有管理员可以使用此命令<span class="o">)</span>
格式：chown USERNAME file,..
chown USERNAME:GRPNAME file,..
chown USERNAME.GRPNAME file,..
-R: 修改目录及其内部文件的属主
--reference<span class="o">=</span>/path/to/somefile file,..
<span class="m">2</span><span class="o">)</span>.chgrp:改变文件属组
格式：chgrp GRPNAME file,..
-R：递归
--reference<span class="o">=</span>/path/to/somefile file,...改正和somefile文件一样的属组
<span class="m">3</span><span class="o">)</span>.chmod: 修改文件的权限
格式：chmod MODE file,..
-R:递归更改
--reference<span class="o">=</span>/path/to/somefile file,...改正和somefile文件一样的权限
<span class="m">4</span><span class="o">)</span>.修改某类用户或某些类用户权限：u,g,o,a
格式：chmod <span class="nv">用户类别</span><span class="o">=</span>MODE file,..
<span class="m">5</span><span class="o">)</span>.修改某类用户的某位或某些位权限：u,g,o,a
格式：chmod 用户类别+<span class="p">|</span>-MODE file,..
</pre></div>

<h3 id="_12">四、特殊权限<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>特殊权限也是一个三位的：s,s,t
<span class="m">1</span>.SUID: 运行某程序时，相应进程的属主是程序文件自身的属主，而不是动者
格式：chmod u+s FILE  ，chmod u-s FILE
注意：如果FILE本身原来就有执行权限，则SUID显示为s；否则显示S
<span class="m">2</span>.SGID: 运行某程序时，相应进程的属组是程序文件自身的属组，而不是动者所属的基本组
格式：chmod g+s FILE  ， chmod g-s FILE
注意：如果FILE本身原来就有执行权限，则SUID显示为s；否则显示S
<span class="m">3</span>.Sticky: 在一个公共目录，每个都可以创建文件，删除自己的文件，但能删除别人的文件
格式：chmod o+t DIR  ， chmod o-t DIR
注意：如果FILE本身原来就有执行权限，则SUID显示为t；否则显示T
五、umask：遮罩码
文件默认权限：666-umask
文件夹默认权限：777-umask
特殊权限默认为0
默认遮罩码：umask<span class="o">=</span><span class="m">0022</span>
更改遮罩码：umask <span class="m">0023</span>
注意：文件默认不能具有执行权限，如果算得的结果中有执行权限，则将权限加1
</pre></div>

<h3 id="linux_5">Linux进程管理<a class="headerlink" href="#linux_5" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>查看用户信息命令w,who<span class="p">;</span>
w命令显示的字符格式如下所示：
user，TTY,from,login, idle,jcpu,pcpu,what

load average:分别显示系统在过去的1,5,15分钟内的平均负载程序
user:登陆用户，
tty:登陆终端，是本地登陆还是远程登陆（pts/0,1,2,3）
from：显示用户从何处登陆系统，如果显示“:0”显示代表了该用户是从Xwindows下，打开文本模式窗口登陆的
idle:用户闲置的时间，这是一个计时器，一旦用户执行任何操作，该计时器便会被重置
jcpu：以终端代号来区分，该终端所有相关的进程执行时，所消耗的CPU时间会显示在这里
pcpu:CPU执行程序耗费的时间
what：用户正在执行的操作

进程的优先级（priority）：nice , renice
首先，执行程序的优先级,
格式：nice -n <span class="nb">command</span>
例如：nice --5 /etc/rc.d/init.d/vsftpd start
其次是改变正在运行中的进程的优先级
格式：renice n pid
例如：renice -20 pid
<span class="c1">#优先级的取值范围（-20,19）即使指定优先级为-30,最终的优先级还是-20，数值越小，优先级越大；因此-20的优先级是最大的</span>

nohup命令使进程在用户退出登录后仍旧继续执行，nohup命令执行后的数据和错误信息默认存储到文件nohup.out中
格式：nohup program <span class="p">&amp;</span>
实例：nohup find /test -name cisco* &gt; /tmp/find.cisco.20130508 <span class="p">&amp;</span>

进程的终止和挂起
ctrl+z, ctrl+c分别表示挂起和终止
查看后台或者挂起的命令jobs
进程的恢复：
fg恢复进程到前台继续运行
bg恢复进程到后台继续运行

<span class="c1">#计划任务</span>

计划任务是linux系统管理当中非常重要的一个环节，一定要理解深刻，灵活运用；涉及到的命令如下：
at#安排作业在某一时刻执行一次
batch#安排作业在系统负载不重时执行一次；#与at命令不同的是batch命令要检测系统的负载情况
cron#安排周期性运行的作业

一次性计划任务：at,batch
at的命令格式及参数
at 【-f 文件名】 时间
at -d or atrm 删除队列中的任务
at -l or atq 查看队列中的任务

指定时间的方式分为绝对计时方法和相对计时方法
hh:mm:today
hh:mm:tomorrow
hh:mm:星期
hh:mm:MM/DD/YY<span class="p">;</span>MMDDYY<span class="p">;</span>DD.MM.YY

now +n minutes
now +n hours
now +n days

ps -le <span class="p">|</span> grep atd
/etc/rc.d/init.d/atd start

实例：指定今天下午17:30执行某命令；此时为下午14:30,2013.5.8
多个书写方式：（仅供参考学习）
at <span class="m">5</span>:30pm
at <span class="m">17</span>:30
at <span class="m">17</span>:30 today
at now +3 hours
at now +180 minutes
at <span class="m">17</span>:30 <span class="m">05</span>.08.13
at <span class="m">17</span>:30 <span class="m">05</span>/08/13
使用ctrl+d提交任务
<span class="c1">#以上是绝对时间和相对时间的所有格式组合</span>
<span class="c1">#缺省情况下书写的计划任务都存放在/var/spool/目录中</span>
/var/spool/at

AT配置文件
配置文件的作用：限制那些用户可以使用AT命令
<span class="c1">#/etc/at.allow</span>
<span class="c1">#/etc/at.deny</span>
<span class="m">1</span>.如果/etc/at.allow文件存在，那么只有列在此文件中的用户才可以使用at命令

<span class="m">2</span>.若/etc/at.allow文件不存在，则检查/etc/at.deny文件是否存在；若/etc/at.deny文件存在，则在此文件中的用户都不能使用at命令

<span class="m">3</span>.如果两个文件都不存在，只有超级用户root可以使用at命令

<span class="m">4</span>.如果两个文件都存在而且均为空，则所有用户都可以使用at命令
<span class="c1">###################</span>

crontab指令
作用：用于生成cron进程所需要的crontab文件,保存的位置/var/spool/cron
cat /var/spool/cron/root
配置文件:/etc/crontab

指令用法：
crontab -l -r -e
-l 显示当前的crontab
-r 删除当前的crontab
-e 使用编辑器编辑当前的crontab文件

分，时，日，月，周   命令/脚本
原则：把知道的具体时间添上，不知道的都添上*
注意：并不是所有的计划任务一条规则就可以搞定的，
例如；要实现周一到周五的17:30发送关机广播信息，主要保存文件，然后17:45即刻关机
案例：
<span class="m">30</span> <span class="m">17</span> * * <span class="m">1</span>-5 /usr/bin/wall &lt; /etc/issue.mes
<span class="m">45</span> <span class="m">17</span> * * <span class="m">1</span>-5 /sbin/shutdown -h now
</pre></div>

<h3 id="linux5">linux上进程有5种状态<a class="headerlink" href="#linux5" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="m">1</span>. R 运行 runnable <span class="o">(</span>on run queue<span class="o">)</span><span class="c1">#运行(正在运行或在运行队列中等待)</span>
<span class="m">2</span>. S 中断 sleeping#中断<span class="o">(</span>休眠中, 受阻, 在等待某个条件的形成或接受到信号<span class="o">)</span>
<span class="m">3</span>. D 不可中断 uninterruptible sleep <span class="o">(</span>usually IO<span class="o">)</span><span class="c1">#不可中断(收到信号不唤醒和不可运行, 进程必须等待直到有中断发生)</span>
<span class="m">4</span>. Z 僵死 a defunct <span class="o">(</span>”zombie”<span class="o">)</span> process#僵死<span class="o">(</span>进程已终止, 但进程描述符存在, 直到父进程调用wait4<span class="o">()</span>系统调用后释放<span class="o">)</span>
<span class="m">5</span>. T 停止 traced or stopped#停止<span class="o">(</span>进程收到SIGSTOP, SIGSTP, SIGTIN, SIGTOU信号后停止运行运行<span class="o">)</span>
</pre></div>

<h2 id="vsftp">Vsftp<a class="headerlink" href="#vsftp" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="n">v3</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">3</span>
<span class="n">VSFTP配置vsftpd</span><span class="p">.</span><span class="n">conf文件详解</span>

<span class="n">vsftpd</span><span class="p">.</span><span class="n">conf的格式非常简单</span><span class="err">。每一行都是注释或指令。注释行以＃开头并被忽略。指令行的格式为：选项</span><span class="o">=</span><span class="err">值</span>
<span class="err">重要的是要注意在选项，</span><span class="o">=</span><span class="err">和值之间放置任何空格是错误的。每个设置都有一个默认编译，可以在配置文件中修改</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rc</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">vsftpd</span>
<span class="err">启动脚本</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pam</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">vsftpd</span>
<span class="n">PAM认证文件</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">vsftpd</span><span class="o">/</span><span class="n">ftpusers</span>
<span class="err">禁止使用</span><span class="n">Vsftpd的用户列表文件</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">vsftpd</span><span class="o">/</span><span class="n">user_list</span>
<span class="err">禁止或允许使用</span><span class="n">Vsftpd的用户列表文件</span>
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">ftp</span>
<span class="err">匿名用户主目录</span>

<span class="err">布尔选项列表，布尔选项可以设置为</span><span class="n">yes或no</span>

<span class="n">allow_anon_ssl</span>
<span class="err">仅在</span><span class="n">ssl_enable</span> <span class="err">处于活动状态时适用</span> <span class="err">。如果设置为</span><span class="n">YES</span><span class="err">，则允许匿名用户使用安全</span><span class="n">SSL连接</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">anon_mkdir_write_enable</span>
<span class="err">如果设置为</span><span class="n">YES</span><span class="err">，则允许匿名用户在特定条件下创建新目录。为此，</span> <span class="err">必须激活选项</span> <span class="n">write_enable</span><span class="err">，并且匿名</span><span class="n">ftp用户必须具有父目录的写权限</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">anon_other_write_enable</span>
<span class="err">如果设置为</span><span class="n">YES</span><span class="err">，则允许匿名用户执行除上载和创建目录之外的写入操作，例如删除和重命名。通常不建议这样做，但为了完整性而包括在内</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">anon_upload_enable</span>
<span class="err">如果设置为</span><span class="n">YES</span><span class="err">，则允许匿名用户在特定条件下上载文件。为此，</span> <span class="err">必须激活选项</span> <span class="n">write_enable</span><span class="err">，并且匿名</span><span class="n">ftp用户必须具有所需上载位置的写入权限</span><span class="err">。虚拟用户上传也需要此设置</span><span class="p">,</span><span class="err">默认情况下，虚拟用户使用匿名（即最大限制）权限进行处理</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">anon_world_readable_only</span>
<span class="err">启用后，将只允许匿名用户下载世界可读的文件。这是认识到</span><span class="n">ftp用户可能拥有文件</span><span class="err">，尤其是在上传的情况下</span>
<span class="err">默认值：是</span>

<span class="n">anonymous_enable</span>
<span class="err">控制是否允许匿名登录。如果启用，则用户名</span> <span class="n">ftp</span> <span class="err">和</span> <span class="n">anonymous</span> <span class="err">都将被识别为匿名登录</span>
<span class="err">默认值：</span><span class="n">YES</span>

<span class="n">ascii_download_enable</span>
<span class="err">启用后，</span><span class="n">ASCII模式数据传输将在下载时受到尊重</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">ascii_upload_enable</span>
<span class="err">启用后，上传时将遵循</span><span class="n">ASCII模式数据传输</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">async_abor_enable</span>
<span class="err">启用后，将启用称为“异步</span><span class="n">ABOR</span><span class="err">”的特殊</span><span class="n">FTP命令</span><span class="err">。只有不明智的</span><span class="n">FTP客户端才会使用此功能</span><span class="err">。此外，此功能难以处理，因此默认情况下禁用。遗憾的是，除非此功能可用，否则某些</span><span class="n">FTP客户端将在取消传输时挂起</span><span class="err">，因此您可能希望启用它</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">background</span>
<span class="err">启用后，</span><span class="n">vsftpd以</span><span class="err">“</span><span class="k">listen</span><span class="err">”模式启动，</span><span class="n">vsftpd将为侦听器进程提供背景</span><span class="err">。即控件将立即返回到启动</span><span class="n">vsftpd的shell</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">check_shell</span>
<span class="err">注意！此选项仅对</span><span class="n">vsftpd的非PAM构建有效</span><span class="err">。如果禁用，</span><span class="n">vsftpd将不会检查</span><span class="o">/</span> <span class="n">etc</span> <span class="o">/</span> <span class="n">shells是否有用于本地登录的用户shell</span>
<span class="err">默认值：是</span>

<span class="n">chmod_enable</span>
<span class="err">启用后，允许使用</span><span class="n">SITE</span> <span class="n">CHMOD命令</span><span class="err">。注意！这仅适用于本地用户。匿名用户永远不会使用</span><span class="n">SITE</span> <span class="n">CHMOD</span>
<span class="err">默认值：是</span>

<span class="n">chown_uploads</span>
<span class="err">如果启用，则所有匿名上载的文件都将更改为设置</span><span class="n">chown_username中指定的用户</span> <span class="err">。从管理（可能是安全性）的角度来看，这很有用</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">chroot_list_enable</span>
<span class="err">如果激活，您可以在登录时提供放置在其主目录中的</span><span class="n">chroot</span><span class="err">（）</span><span class="n">jail中的本地用户列表</span><span class="err">。如果</span><span class="n">chroot_local_user设置为YES</span><span class="err">，则含义略有不同。在这种情况下，列表将成为不被放置在</span><span class="n">chroot</span><span class="err">（）</span><span class="n">jail中的用户列表</span><span class="err">。默认情况下，包含此列表的文件是</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">vsftpd</span><span class="p">.</span><span class="n">chroot_list</span><span class="err">，但您可以使用</span><span class="n">chroot_list_file</span> <span class="err">设置覆盖它</span> 
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">chroot_local_user</span>
<span class="err">如果设置为</span><span class="n">YES</span><span class="err">，则登录后本地用户（默认情况下）将放置在其主目录中的</span><span class="n">chroot</span><span class="err">（）</span><span class="n">jail中</span><span class="err">。</span> <span class="err">警告：</span> <span class="err">此选项具有安全隐患，尤其是在用户具有上载权限或</span><span class="n">shell访问权限的情况下</span><span class="err">。只有在您知道自己在做什么时才启用。请注意，这些安全隐患不是</span><span class="n">vsftpd特定的</span><span class="err">。它们适用于所有提供将本地用户放入</span><span class="n">chroot</span><span class="err">（）</span><span class="n">jail的FTP守护进程</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">connect_from_port_20</span>
<span class="err">这可以控制</span><span class="n">PORT样式数据连接是否在服务器计算机上使用端口20</span><span class="err">（</span><span class="n">ftp</span><span class="o">-</span><span class="k">data</span><span class="err">）。出于安全原因，一些客户可能会坚持认为是这种情况。相反，禁用此选项可使</span><span class="n">vsftpd以较低的权限运行</span>
<span class="err">默认值：</span><span class="k">NO</span><span class="err">（但是示例配置文件启用它）</span>

<span class="n">debug_ssl</span>
<span class="err">如果为</span><span class="k">true</span><span class="err">，则将</span><span class="n">OpenSSL连接诊断转储到vsftpd日志文件</span><span class="err">。（在</span><span class="n">v2</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="err">中添加）</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">delete_failed_uploads</span>
<span class="err">如果为</span><span class="k">true</span><span class="err">，则删除任何失败的上载文件。（在</span><span class="n">v2</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="err">中添加）</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">deny_email_enable</span>
<span class="err">如果激活，您可以提供匿名密码电子邮件响应列表，这会导致登录被拒绝。默认情况下，包含此列表中的文件是</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">vsftpd</span><span class="p">.</span><span class="n">banned_emails</span><span class="err">，但你可以与覆盖这个</span> <span class="n">banned_email_file</span> <span class="err">设置</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">dirlist_enable</span>
<span class="err">如果设置为</span><span class="k">NO</span><span class="err">，则所有目录列表命令都将拒绝权限</span>
<span class="err">默认值：是</span>

<span class="n">dirmessage_enable</span>
<span class="err">如果启用，</span><span class="n">FTP服务器的用户首次进入新目录时可以显示消息</span><span class="err">。默认情况下，会扫描目录以查找文件</span><span class="p">.</span><span class="n">message</span><span class="err">，但可以使用配置设置</span><span class="n">message_file覆盖该目录</span> 
<span class="err">默认值：</span><span class="k">NO</span><span class="err">（但是示例配置文件启用它）</span>

<span class="n">download_enable</span>
<span class="err">如果设置为</span><span class="k">NO</span><span class="err">，则所有下载请求都将拒绝权限</span>
<span class="err">默认值：是</span>

<span class="n">dual_log_enable</span>
<span class="err">如果启用，则会并行生成两个日志文件，默认情况下为</span> <span class="o">/</span> <span class="n">var</span> <span class="o">/</span> <span class="n">log</span> <span class="o">/</span> <span class="n">xferlog</span> <span class="err">和</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">vsftpd</span><span class="p">.</span><span class="n">log</span><span class="err">。前者是一个</span><span class="n">wu</span><span class="o">-</span><span class="n">ftpd样式的传输日志</span><span class="err">，可以通过标准工具解析。后者是</span><span class="n">vsftpd自己的样式日志</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">force_dot_files</span>
<span class="err">如果激活，则以。开头的文件和目录。即使客户端未使用“</span><span class="n">a</span><span class="err">”标志，也将显示在目录列表中。此覆盖不包括“。”</span> <span class="err">和“</span><span class="p">..</span><span class="err">”条目</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">force_anon_data_ssl</span>
<span class="err">仅</span> <span class="err">在激活</span><span class="n">ssl_enable时适用</span> <span class="err">。如果激活，则强制所有匿名登录使用安全</span><span class="n">SSL连接</span><span class="err">，以便在数据连接上发送和接收数据</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">force_anon_logins_ssl</span>
<span class="err">仅</span> <span class="err">在激活</span><span class="n">ssl_enable时适用</span> <span class="err">。如果激活，则强制所有匿名登录使用安全</span><span class="n">SSL连接以发送密码</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">force_local_data_ssl</span>
<span class="err">仅</span> <span class="err">在激活</span><span class="n">ssl_enable时适用</span> <span class="err">。如果激活，则强制所有非匿名登录使用安全</span><span class="n">SSL连接</span><span class="err">，以便在数据连接上发送和接收数据</span>
<span class="err">默认值：是</span>

<span class="n">force_local_logins_ssl</span>
<span class="err">仅</span> <span class="err">在激活</span><span class="n">ssl_enable时适用</span> <span class="err">。如果激活，则强制所有非匿名登录使用安全</span><span class="n">SSL连接以发送密码</span>
<span class="err">默认值：是</span>

<span class="n">guest_enable</span>
<span class="err">如果启用，则所有非匿名登录都被归类为“访客”登录。</span><span class="n">guest</span> <span class="err">虚拟机登录将重新映射到</span><span class="n">guest_username</span> <span class="err">设置中指定的用户</span> 
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">hide_ids</span>
<span class="err">如果启用，目录列表中的所有用户和组信息将显示为“</span><span class="n">ftp</span><span class="err">”</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">implicit_ssl</span>
<span class="err">如果启用，则</span><span class="n">SSL握手是所有连接</span><span class="err">（</span><span class="n">FTPS协议</span><span class="err">）上的第一件事。要支持显式</span><span class="n">SSL和</span><span class="o">/</span><span class="err">或纯文本，还应运行单独的</span><span class="n">vsftpd侦听器进程</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="err">听</span>
<span class="err">如果启用，</span><span class="n">vsftpd将以独立模式运行</span><span class="err">。这意味着</span><span class="n">vsftpd不能从某种类型的inetd运行</span><span class="err">。相反，</span><span class="n">vsftpd可执行文件直接运行一次</span><span class="err">。然后，</span><span class="n">vsftpd将负责监听和处理传入的连接</span>
<span class="err">默认值：是</span>

<span class="n">listen_ipv6</span>
<span class="err">与</span><span class="n">listen参数一样</span><span class="err">，除了</span><span class="n">vsftpd将侦听IPv6套接字而不是IPv4套接字</span><span class="err">。此参数和</span><span class="n">listen参数是互斥的</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">local_enable</span>
<span class="err">控制是否允许本地登录。如果启用，则可以使用</span><span class="o">/</span> <span class="n">etc</span> <span class="o">/</span> <span class="n">passwd中的普通用户帐户</span><span class="err">（或</span><span class="n">PAM配置引用的任何位置</span><span class="err">）登录。必须启用此功能才能使任何非匿名登录工作，包括虚拟用户</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">lock_upload_files</span>
<span class="err">启用后，所有上载都会继续对上载文件进行写锁定。所有下载都继续下载文件上的共享读锁定。警告！在启用此功能之前，请注意恶意阅读器可能会使想要添加文件的作者感到饥饿</span>
<span class="err">默认值：是</span>

<span class="n">log_ftp_protocol</span>
<span class="err">启用后，将记录所有</span><span class="n">FTP请求和响应</span><span class="err">，前提是未启用</span><span class="n">xferlog_std_format选项</span><span class="err">。用于调试</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">ls_recurse_enable</span>
<span class="err">启用后，此设置将允许使用“</span><span class="n">ls</span> <span class="o">-</span><span class="n">R</span><span class="err">”。这是一个较小的安全风险，因为大型站点顶层的</span><span class="n">ls</span> <span class="o">-</span><span class="n">R可能会消耗大量资源</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">mdtm_write</span>
<span class="err">启用后，此设置将允许</span><span class="n">MDTM设置文件修改时间</span><span class="err">（根据通常的访问检查）</span>
<span class="err">默认值：是</span>

<span class="n">no_anon_password</span>
<span class="err">启用后，这会阻止</span><span class="n">vsftpd请求匿名密码</span> <span class="o">-</span> <span class="err">匿名用户将直接登录</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">no_log_lock</span>
<span class="err">启用后，这会阻止</span><span class="n">vsftpd在写入日志文件时进行文件锁定</span><span class="err">。通常不应启用此选项。它存在以解决操作系统错误，例如</span><span class="n">Solaris</span> <span class="o">/</span> <span class="n">Veritas文件系统组合</span><span class="err">，已经观察到有时会出现试图锁定日志文件的挂起</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">one_process_model</span>
<span class="err">如果您有</span><span class="n">Linux</span> <span class="mi">2</span><span class="p">.</span><span class="mi">4</span><span class="err">内核，则可以使用不同的安全模型，每个连接只使用一个进程。它是一种不太纯粹的安全模型，但会提高您的性能。除非您知道自己在做什么，并且您的站点支持大量同时连接的用户，否则您真的不想启用它</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">passwd_chroot_enable</span>
<span class="err">如果启用，则与</span> <span class="n">chroot_local_user一起</span> <span class="err">，然后可以基于每个用户指定</span><span class="n">chroot</span><span class="err">（）</span><span class="n">jail位置</span><span class="err">。每个用户的</span><span class="n">jail都是从</span><span class="o">/</span> <span class="n">etc</span> <span class="o">/</span> <span class="n">passwd中的主目录字符串派生的</span><span class="err">。主目录字符串中出现</span><span class="o">/</span><span class="p">.</span><span class="o">/</span><span class="err">表示</span><span class="n">jail位于路径中的特定位置</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">pasv_addr_resolve</span>
<span class="err">如果要在</span><span class="n">pasv_address</span> <span class="err">选项中使用主机名（而不是</span><span class="n">IP地址</span><span class="err">），请设置为</span><span class="n">YES</span> 
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">pasv_enable</span>
<span class="err">如果要禁用</span><span class="n">PASV获取数据连接的方法</span><span class="err">，请设置为</span><span class="k">NO</span>
<span class="err">默认值：是</span>

<span class="n">pasv_promiscuous</span>
<span class="err">如果要禁用</span><span class="n">PASV安全检查</span><span class="err">，则设置为</span><span class="n">YES</span><span class="err">，以确保数据连接源自与控制连接相同的</span><span class="n">IP地址</span><span class="err">。只有在你知道自己在做什么的情况下才能启用</span> <span class="err">对此的唯一合法用途是采用某种形式的安全隧道方案，或者可能是为了促进</span><span class="n">FXP支持</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">port_enable</span>
<span class="err">如果要禁止</span><span class="n">PORT方法获取数据连接</span><span class="err">，请设置为</span><span class="k">NO</span>
<span class="err">默认值：是</span>

<span class="n">port_promiscuous</span>
<span class="err">如果要禁用</span><span class="n">PORT安全检查</span><span class="err">，则设置为</span><span class="n">YES</span><span class="err">，以确保传出数据连接只能连接到客户端。只有在你知道自己在做什么的情况下才能启用</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">require_cert</span>
<span class="err">如果设置为</span><span class="n">yes</span><span class="err">，则需要所有</span><span class="n">SSL客户端连接来提供客户端证书</span><span class="err">。应用于此证书的验证程度由</span><span class="n">validate_cert控制</span> <span class="err">（在</span><span class="n">v2</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="err">中添加）</span>
<span class="err">默认值：</span><span class="k">NO</span>

<span class="n">require_ssl_reuse</span>
<span class="err">如果设置为</span><span class="n">yes</span><span class="err">，则需要所有</span><span class="n">SSL数据连接以展示SSL会话重用</span><span class="err">（这证明它们知道与控制通道相同的主密钥）。虽然这是一个安全的默认设置，但它可能会破坏许多</span><span class="n">FTP客户端</span><span class="err">，因此您可能希望禁用它。有关后果的讨论，请参阅</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">scarybeastsecurity</span><span class="p">.</span><span class="n">blogspot</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="mi">2009</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="n">vsftpd</span><span class="o">-</span><span class="mi">210</span><span class="o">-</span><span class="n">released</span><span class="p">.</span><span class="n">html</span> <span class="err">（在</span><span class="n">v2</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="err">中添加）</span>
<span class="err">默认值：是</span>

<span class="n">run_as_launching_user</span>
<span class="err">如果您希望</span><span class="n">vsftpd以启动vsftpd的用户身份运行</span><span class="err">，请设置为</span><span class="n">YES</span><span class="err">。在根访问不可用的情况下，这很有用。大规模警告！除非您完全知道自己在做什么，否则不要启用此选项，因为天真地使用此选项会产生大量安全问题。具体来说，当设置此选项时，</span><span class="n">vsftpd不会</span><span class="o">/</span><span class="err">不能使用</span><span class="n">chroot技术来限制文件访问</span><span class="err">（即使由</span><span class="n">root启动</span><span class="err">）。一个糟糕的替代品可能是使用</span> <span class="n">deny_file</span> <span class="err">设置如{</span><span class="cm">/*,*..*}，但这种可靠性无法与chroot相比，并且不应该依赖。如果使用此选项，则适用对其他选项的许多限制。例如，需要权限的选项（例如非匿名登录，上载所有权更改，从端口20连接和小于1024的侦听端口）预计不起作用。其他选项可能会受到影响</span>
<span class="cm">默认值：NO</span>

<span class="cm">secure_email_list_enable</span>
<span class="cm">如果您只想接受匿名登录的指定电子邮件密码列表，请设置为YES。这非常有用，可以在不需要虚拟用户的情况下限制对低安全性内容的访问。启用后，除非提供的密码列在email_password_file 设置指定的文件中，否则将阻止匿名登录 。文件格式是每行一个密码，没有额外的空格。默认文件名是/etc/vsftpd.email_passwords</span>
<span class="cm">默认值：NO</span>

<span class="cm">session_support</span>
<span class="cm">这可以控制vsftpd是否尝试维护登录会话。如果vsftpd维护会话，它将尝试更新utmp和wtmp。如果使用PAM进行身份验证，它也会打开一个pam_session，并且只有在注销时关闭它。如果您不需要会话日志记录，您可能希望禁用此功能，并且您希望为vsftpd提供更多机会以更少的进程和/或更少的权限运行。注 - utmp和wtmp支持仅在PAM启​​用的版本中提供</span>
<span class="cm">默认值：NO</span>

<span class="cm">setproctitle_enable</span>
<span class="cm">如果启用，vsftpd将尝试在系统进程列表中显示会话状态信息。换句话说，报告的进程名称将更改以反映vsftpd会话正在执行的操作（空闲，下载等）。出于安全考虑，您可能希望将其关闭</span>
<span class="cm">默认值：NO</span>

<span class="cm">ssl_enable</span>
<span class="cm">如果启用，并且vsftpd是针对OpenSSL编译的，则vsftpd将通过SSL支持安全连接。这适用于控制连接（包括登录）以及数据连接。您也需要一个支持SSL的客户端。注意！！请注意启用此选项。只有在需要时才启用它。vsftpd无法保证OpenSSL库的安全性。通过启用此选项，您声明您信任已安装的OpenSSL库的安全性</span>
<span class="cm">默认值：NO</span>

<span class="cm">ssl_request_cert</span>
<span class="cm">如果启用，vsftpd会要求（但不一定需要,见 require_cert）一个证书上的传入 SSL 连接。通常这 不应该造成任何麻烦，但IBM zOS似乎有问题。（v2.0.7中的新功能）</span>
<span class="cm">默认值：是</span>

<span class="cm">ssl_sslv2</span>
<span class="cm">仅 在激活ssl_enable时适用 。如果启用，此选项将允许SSL v2协议连接。TLS v1连接是首选</span>
<span class="cm">默认值：NO</span>

<span class="cm">ssl_sslv3</span>
<span class="cm">仅 在激活ssl_enable时适用 。如果启用，此选项将允许SSL v3协议连接。TLS v1连接是首选</span>
<span class="cm">默认值：NO</span>

<span class="cm">ssl_tlsv1</span>
<span class="cm">仅 在激活ssl_enable时适用 。如果启用，此选项将允许TLS v1协议连接。TLS v1连接是首选</span>
<span class="cm">默认值：是</span>

<span class="cm">strict_ssl_read_eof</span>
<span class="cm">如果启用，则需要通过SSL终止SSL数据上载，而不是套接字上的EOF。需要此选项以确保攻击者未使用伪造的TCP FIN过早终止上载。不幸的是，默认情况下它没有启用，因为很少有客户端能够正确使用它。（v2.0.7中的新功能）</span>
<span class="cm">默认值：NO</span>

<span class="cm">strict_ssl_write_shutdown</span>
<span class="cm">如果启用，则需要通过SSL终止SSL数据下载，而不是套接字上的EOF。默认情况下这是关闭的，因为我无法找到执行此操作的单个FTP客户端。这是次要的。它影响的是我们判断客户是否确认完全收到该文件的能力。即使没有此选项，客户端也能够检查下载的完整性。（v2.0.7中的新功能）</span>
<span class="cm">默认值：NO</span>

<span class="cm">syslog_enable</span>
<span class="cm">如果启用，则任何已转至/var/log/vsftpd.log的日志输出将转到系统日志。记录在FTPD工具下完成</span>
<span class="cm">默认值：NO</span>

<span class="cm">tcp_wrappers的</span>
<span class="cm">如果启用，并且vsftpd是使用tcp_wrappers支持编译的，则传入连接将通过tcp_wrappers访问控制提供。此外，还有一种基于每个IP的配置机制。如果tcp_wrappers设置VSFTPD_LOAD_CONF环境变量，则vsftpd会话将尝试加载此变量中指定的vsftpd配置文件</span>
<span class="cm">默认值：NO</span>

<span class="cm">text_userdb_names</span>
<span class="cm">默认情况下，数字ID显示在目录列表的用户和组字段中。您可以通过启用此参数来获取文本名称。出于性能原因，它默认是关闭的</span>
<span class="cm">默认值：NO</span>

<span class="cm">tilde_user_enable</span>
<span class="cm">如果启用，vsftpd将尝试解析路径名，例如~chris / pics，即代字号后跟用户名。请注意，vsftpd将始终解析路径名〜和〜/ something（在这种情况下，〜解析为初始登录目录）。请注意，只有 在_current_ chroot（）jail中找到文件/ etc / passwd时，〜用户路径才会解析 </span>
<span class="cm">默认值：NO</span>

<span class="cm">use_localtime</span>
<span class="cm">如果启用，vsftpd将显示当前时区中包含时间的目录列表。默认为显示GMT。MDTM FTP命令返回的时间也受此选项的影响</span>
<span class="cm">默认值：NO</span>

<span class="cm">use_sendfile</span>
<span class="cm">用于测试在平台上使用sendfile（）系统调用的相对好处的内部设置</span>
<span class="cm">默认值：是</span>

<span class="cm">userlist_deny</span>
<span class="cm">如果 激活userlist_enable，则检查此选项 。如果将此设置设置为NO，则将拒绝用户登录，除非它们明确列在userlist_file指定的文件中 。拒绝登录时，将在要求用户输入密码之前发出拒绝</span>
<span class="cm">默认值：是</span>

<span class="cm">userlist_enable</span>
<span class="cm">如果启用，vsftpd将从userlist_file给出的文件名加载用户名列表 。如果用户尝试使用此文件中的名称登录，则在要求输入密码之前，他们将被拒绝。这可能有助于防止传输明文密码。另请参见 userlist_deny</span>
<span class="cm">默认值：NO</span>

<span class="cm">validate_cert</span>
<span class="cm">如果设置为yes，则收到的所有SSL客户端证书都必须验证OK。自签名证书不构成OK验证。（v2.0.6中的新功能）</span>
<span class="cm">默认值：NO</span>

<span class="cm">virtual_use_local_privs</span>
<span class="cm">如果启用，虚拟用户将使用与本地用户相同的权限。默认情况下，虚拟用户将使用与匿名用户相同的权限，这往往更具限制性（特别是在写访问方面）</span>
<span class="cm">默认值：NO</span>

<span class="cm">WRITE_ENABLE</span>
<span class="cm">这可以控制是否允许任何更改文件系统的FTP命令。用户对ftp服务器的写权限。这些命令是：STOR，DELE，RNFR，RNTO，MKD，RMD，APPE和SITE</span>
<span class="cm">默认值：NO</span>

<span class="cm">xferlog_enable</span>
<span class="cm">如果启用，将保留日志文件，详细说明上载和下载。默认情况下，此文件将放在/var/log/vsftpd.log中，但可以使用配置设置vsftpd_log_file覆盖此位置 </span>
<span class="cm">默认值：NO（但是示例配置文件启用它）</span>

<span class="cm">xferlog_std_format</span>
<span class="cm">如果启用，传输日志文件将以标准xferlog格式写入，如wu-ftpd所使用。这很有用，因为您可以重用现有的传输统计信息生成器 但是，默认格式更具可读性。此样式的日志文件的缺省位置是/ var / log / xferlog，但您可以使用xferlog_file设置进行 更改</span>
<span class="cm">默认值：NO</span>

<span class="cm">数字选项</span>
<span class="cm">以下是数字选项列表。必须将数字选项设置为非负整数。支持八进制数，以方便umask选项。要指定八进制数，请使用0作为数字的第一个数字</span>
<span class="cm">accept_timeout</span>
<span class="cm">远程客户端与PASV样式数据连接建立连接的超时（以秒为单位）</span>
<span class="cm">默认值：60</span>

<span class="cm">anon_max_rate</span>
<span class="cm">匿名客户端允许的最大数据传输速率（以字节/秒为单位）</span>
<span class="cm">默认值：0（无限制）</span>

<span class="cm">anon_umask</span>
<span class="cm">为匿名用户设置用于文件创建的umask的值。注意！如果要指定八进制值，请记住“0”前缀，否则该值将被视为基数为10的整数！</span>
<span class="cm">默认值：077</span>

<span class="cm">chown_upload_mode</span>
<span class="cm">要强制进行chown（）ed匿名上传的文件模式。（在v2.0.6中添加）</span>
<span class="cm">默认值：0600</span>

<span class="cm">connect_timeout</span>
<span class="cm">远程客户端响应我们的PORT样式数据连接的超时（以秒为单位）</span>
<span class="cm">默认值：60</span>

<span class="cm">data_connection_timeout</span>
<span class="cm">超时（以秒为单位），大致是允许数据传输停止而没有进度的最长时间。如果超时触发，则启动远程客户端</span>
<span class="cm">默认值：300</span>

<span class="cm">delay_failed_login</span>
<span class="cm">报告登录失败之前暂停的秒数</span>
<span class="cm">默认值：1</span>

<span class="cm">delay_successful_login</span>
<span class="cm">允许成功登录之前暂停的秒数</span>
<span class="cm">默认值：0</span>

<span class="cm">file_open_mode</span>
<span class="cm">用于创建上载文件的权限。Umasks应用于此值之上。如果您希望上传的文件可执行，您可能希望更改为0777</span>
<span class="cm">默认值：0666</span>

<span class="cm">ftp_data_port</span>
<span class="cm">PORT样式连接源自的端口（只要 启用名称不佳的 connect_from_port_20）</span>
<span class="cm">默认值：20</span>

<span class="cm">idle_session_timeout</span>
<span class="cm">超时（以秒为单位），即远程客户端在FTP命令之间可能花费的最长时间。如果超时触发，则启动远程客户端</span>
<span class="cm">默认值：300</span>

<span class="cm">listen_port</span>
<span class="cm">如果vsftpd处于独立模式，则它将侦听传入FTP连接的端口</span>
<span class="cm">默认值：21</span>

<span class="cm">local_max_rate</span>
<span class="cm">本地身份验证用户允许的最大数据传输速率（以字节/秒为单位）</span>
<span class="cm">默认值：0（无限制）</span>

<span class="cm">local_umask</span>
<span class="cm">为本地用户设置用于文件创建的umask的值。注意！如果要指定八进制值，请记住“0”前缀，否则该值将被视为基数为10的整数！</span>
<span class="cm">默认值：077</span>

<span class="cm">max_clients</span>
<span class="cm">如果vsftpd处于独立模式，则这是可以连接的最大客户端数。连接的任何其他客户端都将收到错误消息</span>
<span class="cm">默认值：0（无限制）</span>

<span class="cm">max_login_fails</span>
<span class="cm">在这么多登录失败之后，会话被终止</span>
<span class="cm">默认值：3</span>

<span class="cm">max_per_ip</span>
<span class="cm">如果vsftpd处于独立模式，则这是可以从同一源Internet地址连接的最大客户端数。如果客户端超过此限制，将收到错误消息</span>
<span class="cm">默认值：0（无限制）</span>

<span class="cm">pasv_max_port</span>
<span class="cm">为PASV样式数据连接分配的最大端口。可用于指定窄端口范围以协助防火墙</span>
<span class="cm">默认值：0（使用任何端口）</span>

<span class="cm">pasv_min_port</span>
<span class="cm">为PASV样式数据连接分配的最小端口。可用于指定窄端口范围以协助防火墙</span>
<span class="cm">默认值：0（使用任何端口）</span>

<span class="cm">trans_chunk_size</span>
<span class="cm">您可能不想更改此设置，但尝试将其设置为类似8192的设备，以获得更平滑的带宽限制器</span>
<span class="cm">默认值：0（让vsftpd选择合理的设置）</span>

<span class="cm">STRING OPTIONS</span>
<span class="cm">以下是字符串选项列表</span>
<span class="cm">anon_root</span>
<span class="cm">此选项表示vsftpd在匿名登录后尝试更改的目录。失败被默默地忽略了</span>
<span class="cm">默认值:(无）</span>

<span class="cm">banned_email_file</span>
<span class="cm">此选项是包含不允许的匿名电子邮件密码列表的文件的名称。如果 启用了选项deny_email_enable，则会查询此文件 </span>
<span class="cm">默认值：/etc/vsftpd.banned_emails</span>

<span class="cm">banner_file</span>
<span class="cm">此选项是包含要在有人连接到服务器时显示的文本的文件的名称。如果设置，它将覆盖ftpd_banner 选项提供的标题字符串 </span>
<span class="cm">默认值:(无）</span>

<span class="cm">ca_certs_file</span>
<span class="cm">此选项是用于加载证书颁发机构证书的文件的名称，用于验证客户端证书。遗憾的是，由于vsftpd使用受限制的文件系统空间（chroot），因此未使用默认的SSL CA证书路径。（在v2.0.6中添加）</span>
<span class="cm">默认值:(无）</span>

<span class="cm">chown_username</span>
<span class="cm">这是获得匿名上传文件所有权的用户的名称。仅当设置了另一个选项chown_uploads时，此选项才有意义 </span>
<span class="cm">默认值：root</span>

<span class="cm">chroot_list_file</span>
<span class="cm">该选项是包含本地用户列表的文件的名称，该列表将放置在其主目录中的chroot（）jail中。仅当 启用了选项chroot_list_enable时，此选项才有意义 。如果 启用了选项 chroot_local_user，则列表文件将成为未放置在chroot（）jail中的用户列表</span>
<span class="cm">默认值：/etc/vsftpd.chroot_list</span>
<span class="cm">chroot_list文件，&quot;/etc/vsftpd.chroot_list&quot;文件中包含的用户，在登录后将不能切换到自己目录以外的其他目录，由FTP服务器自动</span>
<span class="cm">地&quot;chrooted&quot;到用户自己的home目录下。这将使得chroot_list文件中的用户不能随意转到其他用户的FTP home目录下，从而有利于FTP服</span>
<span class="cm">务器的安全管理和隐私保护</span>

<span class="cm">cmds_allowed</span>
<span class="cm">此选项指定允许的FTP命令的逗号分隔列表（登录后.USER，PASS和QUIT以及其他始终允许登录前）。其他命令被拒绝。这是一种真正锁定FTP服务器的强大方法。示例：cmds_allowed = PASV，RETR，QUIT</span>
<span class="cm">默认值:(无）</span>

<span class="cm">cmds_denied</span>
<span class="cm">此选项指定以逗号分隔的拒绝FTP命令列表（登录后。始终允许登录前使用USER，PASS，QUIT等）。如果此命令和cmds_allowed上都出现命令， 则拒绝优先。（在v2.1.0中添加）</span>
<span class="cm">默认值:(无）</span>

<span class="cm">deny_file</span>
<span class="cm">此选项可用于设置文件名（和目录名等）的模式，这些模式不应以任何方式访问。受影响的项目不会被隐藏，但任何对它们做任何事情的尝试（下载，更改到目录，影响目录中的内容等）都将被拒绝。此选项非常简单，不应用于严格的访问控制 - 应优先使用文件系统的权限。但是，此选项在某些虚拟用户设置中可能很有用。特别要注意的是，如果文件名可以通过各种名称访问（可能是由于符号链接或硬链接），那么必须注意拒绝访问所有名称。如果项目的名称包含hide_file给出的字符串，或者它们与hide_file指定的正则表达式匹配，则将拒绝访问项目。注意vsftpd正则表达式匹配代码是一个简单的实现，它是完整正则表达式功能的子集。因此，您需要仔细而详尽地测试此选项的任何应用程序。并且由于其更高的可靠性，建议您对任何重要的安全策略使用文件系统权限。支持的正则表达式语法是任意数量的* ,? 和unnested {，}运算符。仅在路径的最后一个组件上支持正则表达式匹配，例如a / b /？支持，但/？/ c不支持。示例：deny_file = {*。mp3，*。mov，.private} 并且由于其更高的可靠性，建议您对任何重要的安全策略使用文件系统权限。支持的正则表达式语法是任意数量的* ,? 和unnested {，}运算符。仅在路径的最后一个组件上支持正则表达式匹配，例如a / b /？支持，但/？/ c不支持。示例：deny_file = {*。mp3，*。mov，.private} 并且由于其更高的可靠性，建议您对任何重要的安全策略使用文件系统权限。支持的正则表达式语法是任意数量的* ,? 和unnested {，}运算符。仅在路径的最后一个组件上支持正则表达式匹配，例如a / b /？支持，但/？/ c不支持。示例：deny_file = {*。mp3，*。mov，.private}</span>
<span class="cm">默认值:(无）</span>

<span class="cm">dsa_cert_file</span>
<span class="cm">此选项指定用于SSL加密连接的DSA证书的位置</span>
<span class="cm">默认值:(无 - RSA证书就足够了）</span>

<span class="cm">dsa_private_key_file</span>
<span class="cm">此选项指定用于SSL加密连接的DSA私钥的位置。如果未设置此选项，则预期私钥与证书位于同一文件中</span>
<span class="cm">默认值:(无）</span>

<span class="cm">email_password_file</span>
<span class="cm">此选项可用于提供secure_email_list_enable 设置使用的备用文件 </span>
<span class="cm">默认值：/etc/vsftpd.email_passwords</span>

<span class="cm">ftp_username</span>
<span class="cm">这是我们用于处理匿名FTP的用户的名称。该用户的主目录是匿名FTP区域的根目录</span>
<span class="cm">默认值：ftp</span>

<span class="cm">ftpd_banner</span>
<span class="cm">此字符串选项允许您在首次进入连接时覆盖vsftpd显示的问候语横幅</span>
<span class="cm">默认值:(无 - 显示默认的vsftpd横幅）</span>

<span class="cm">guest_username</span>
<span class="cm">有关 访客登录的描述，请参阅布尔值设置 guest_enable。此设置是访客用户映射到的真实用户名</span>
<span class="cm">默认值：ftp</span>

<span class="cm">hide_file</span>
<span class="cm">此选项可用于设置文件名（和目录名称等）的模式，这些模式应该从目录列表中隐藏。尽管被隐藏，但是知道实际使用的名称的客户可以完全访问文件/目录等。如果项目的名称包含hide_file给出的字符串，或者它们与hide_file指定的正则表达式匹配，则将隐藏这些项目。请注意，vsftpd的正则表达式匹配代码是一个简单的实现，它是完整正则表达式功能的子集。有关 具体支持的正则表达式语法的详细信息，请参阅 deny_file。示例：hide_file = {*。mp3，.hidden，hide *，h？}</span>
<span class="cm">默认值:(无）</span>

<span class="cm">listen_address</span>
<span class="cm">如果vsftpd处于独立模式，则此设置可能会覆盖（所有本地接口的）默认侦听地址。提供数字IP地址</span>
<span class="cm">默认值:(无）</span>

<span class="cm">listen_address6</span>
<span class="cm">与listen_address类似，但指定IPv6侦听器的默认侦听地址（如果设置了listen_ipv6，则使用该地址）。格式是标准IPv6地址格式</span>
<span class="cm">默认值:(无）</span>

<span class="cm">local_root</span>
<span class="cm">此选项表示vsftpd在本地（即非匿名）登录后尝试更改的目录。失败被默默地忽略了</span>
<span class="cm">默认值:(无）</span>

<span class="cm">message_file</span>
<span class="cm">此选项是输入新目录时我们查找的文件的名称。内容显示给远程用户。仅当 启用了选项dirmessage_enable时，此选项才有意义 </span>
<span class="cm">默认值：.message</span>

<span class="cm">nopriv_user</span>
<span class="cm">这是vsftpd在完全没有特权的情况下使用的用户名。请注意，这应该是专用用户，而不是任何人。在大多数机器上，用户没有倾向于使用很多重要的东西</span>
<span class="cm">默认值：没人</span>

<span class="cm">pam_service_name</span>
<span class="cm">此字符串是vsftpd将使用的PAM服务的名称</span>
<span class="cm">默认值：ftp</span>

<span class="cm">pasv_address设置</span>
<span class="cm">使用此选项可覆盖vsftpd将响应PASV命令而通告的IP地址。提供数字IP地址，除非 启用了pasv_addr_resolve，在这种情况下，您可以提供在启动时为您解析DNS的主机名</span>
<span class="cm">默认值:(无 - 地址取自传入的连接套接字）</span>

<span class="cm">rsa_cert_file</span>
<span class="cm">此选项指定用于SSL加密连接的RSA证书的位置</span>
<span class="cm">默认值：/usr/share/ssl/certs/vsftpd.pem</span>

<span class="cm">rsa_private_key_file</span>
<span class="cm">此选项指定用于SSL加密连接的RSA私钥的位置。如果未设置此选项，则预期私钥与证书位于同一文件中</span>
<span class="cm">默认值:(无）</span>

<span class="cm">secure_chroot_dir</span>
<span class="cm">此选项应该是空目录的名称。此外，ftp用户不应该写入该目录。此目录有时用作安全chroot（）jail，vsftpd不需要文件系统访问</span>
<span class="cm">默认值：/ usr / share / empty</span>

<span class="cm">的ssl_ciphers</span>
<span class="cm">此选项可用于选择vsftpd允许加密SSL连接的SSL密码。有关 更多详细信息，请参见 密码手册页。请注意，限制密码可能是一种有用的安全预防措施，因为它可以防止恶意远程方强制使用已发现问题的密码</span>
<span class="cm">默认值：DES-CBC3-SHA</span>

<span class="cm">user_config_dir</span>
<span class="cm">这个功能强大的选项允许基于每个用户覆盖手册页中指定的任何配置选项。用法很简单，最好用一个例子来说明。如果将 user_config_dir 设置为 / etc / vsftpd_user_conf 然后以用户“chris”身份登录，则vsftpd将 在会话期间应用文件 / etc / vsftpd_user_conf / chris中的设置。此文件的格式详见本手册页！请注意，并非所有设置都对每个用户有效。例如，许多设置仅在用户会话启动之前。不会影响每个用户的任何行为的设置示例包括listen_address，banner_file，max_per_ip，max_clients，xferlog_file等</span>
<span class="cm">默认值:(无）</span>

<span class="cm">user_sub_token</span>
<span class="cm">此选项与虚拟用户结合使用非常有用。它用于根据模板为每个虚拟用户自动生成主目录。例如，如果通过guest_username指定的真实用户的主目录 是 / home / virtual / $ USER，并且 user_sub_token 设置为 $ USER，那么当虚拟用户fred登录时，他将结束通常是在目录 / home / virtual / fred中。如果local_root 包含 user_sub_token，则此选项也会 生效</span>
<span class="cm">默认值:(无）</span>

<span class="cm">userlist_file</span>
<span class="cm">此选项是userlist_enable 选项处于活动状态时加载的文件的名称 </span>
<span class="cm">默认值：/etc/vsftpd.user_list</span>

<span class="cm">vsftpd_log_file</span>
<span class="cm">此选项是我们编写vsftpd样式日志文件的文件的名称。仅当 设置了选项xferlog_enable并且未设置xferlog_std_format时， 才会写入此日志 。或者，如果已设置选项dual_log_enable，则会写入 。另一个复杂因素 - 如果您设置了 syslog_enable，则不会写入此文件，而是将输出发送到系统日志</span>
<span class="cm">默认值：/var/log/vsftpd.log</span>

<span class="cm">xferlog_file</span>
<span class="cm">此选项是我们编写wu-ftpd样式传输日志的文件的名称。仅当 设置了 xferlog_enable选项以及xferlog_std_format时才会写入传输日志 。或者，如果已设置选项dual_log_enable，则会写入 </span>
<span class="cm">默认值：/var/log/xferlog</span>
</pre></div>

<h2 id="bind-dns">Bind-DNS<a class="headerlink" href="#bind-dns" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="c1"># DNS-bind安装和配置</span>
https://ftp.isc.org/
http://www.isc.org/downloads/
wget https://www.isc.org/downloads/file/bind-9-10-6-p1/?version<span class="o">=</span>tar-gz
https://www.isc.org/downloads/file/bind-9-10-6-p1/?version<span class="o">=</span>win-32-bit
https://www.isc.org/downloads/file/bind-9-10-6-p1/?version<span class="o">=</span>win-64-bit
tar -zxvf
./configure --with-openssl --enable-threads --with-libxml2
make <span class="o">&amp;&amp;</span> make install
touch /etc/named.conf
named -V
named -g

解决bind9 dumping master file tmp-xxxx open permission denied问题，解决方法如下：
对于Redhat Linux，只要在slave那台的dns主机上修改/etc/sysconfig/named加上ENABLE_ZONE_WRITE<span class="o">=</span>yes，重启named即可
对于Ubuntu系统，修改/etc/apparmor.d/usr.sbin.named，查找/etc/bind/** r，修改成/etc/bind/** rw，然后重启apparmor：/etc/init.d/apparmor rstart或者reload配置：cat /etc/apparmor.d/usr.sbin.named <span class="p">|</span> sudo apparmor_parser -r
</pre></div>

<h2 id="email">Email<a class="headerlink" href="#email" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="c1"># PostFix Dovecot邮件服务器和后台管理</span>
<span class="c1"># 官方postfix安装和配置</span>
PGP key下载地址：https://repo.dovecot.org/DOVECOT-REPO-GPG

<span class="c1">## debian安装和配置</span>
<span class="c1"># Jessie (8.0)安装</span>
<span class="c1"># 创建/etc/apt/trusted.gpg.d/dovecot.gpg</span>
curl https://repo.dovecot.org/DOVECOT-REPO-GPG <span class="p">|</span> gpg --import
gpg --export ED409DA1 &gt; /etc/apt/trusted.gpg.d/dovecot.gpg
<span class="c1"># 创建/etc/apt/sources.list.d/dovecot.list 想要使用https，确保安装apt-transport-https</span>
deb https://repo.dovecot.org/ce-2.3-latest/debian/jessie jessie main

<span class="c1"># Stretch (9.0)安装</span>
<span class="c1"># 创建/etc/apt/trusted.gpg.d/dovecot.gpg</span>
curl https://repo.dovecot.org/DOVECOT-REPO-GPG <span class="p">|</span> gpg --import
gpg --export ED409DA1 &gt; /etc/apt/trusted.gpg.d/dovecot.gpg
<span class="c1"># 创建/etc/apt/sources.list.d/dovecot.list 想要使用https，确保安装apt-transport-https</span>
deb https://repo.dovecot.org/ce-2.3-latest/debian/stretch stretch main

<span class="c1"># 安装需要的包名</span>
dovecot-core dovecot-dbg dovecot-dev dovecot-gssapi dovecot-imapd dovecot-imaptest dovecot-ldap dovecot-lmtpd dovecot-lua dovecot-lucene dovecot-managesieved dovecot-mysql dovecot-pgsql dovecot-pigeonhole-dbg <span class="se">\</span>
dovecot-pop3d dovecot-sieve-dev dovecot-sieve dovecot-solr dovecot-sqlite dovecot-submissiond

<span class="c1">##  CentOS 6&amp;7安装和配置</span>
<span class="c1"># 创建/etc/yum.repos.d/dovecot.repo</span>
<span class="o">[</span>dovecot-2.3-latest<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>Dovecot <span class="m">2</span>.3 CentOS <span class="nv">$releasever</span> - <span class="nv">$basearch</span>
<span class="nv">baseurl</span><span class="o">=</span>http://repo.dovecot.org/ce-2.3-latest/centos/<span class="nv">$releasever</span>/RPMS/<span class="nv">$basearch</span>
<span class="nv">gpgkey</span><span class="o">=</span>https://repo.dovecot.org/DOVECOT-REPO-GPG
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
<span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>

<span class="c1"># 新安装需要的包名</span>
dovecot dovecot-debuginfo dovecot-devel dovecot-imaptest dovecot-imaptest-debuginfo dovecot-lua dovecot-mysql dovecot-pgsql dovecot-pigeonhole dovecot-pigeonhole-debuginfo dovecot-pigeonhole-devel

<span class="c1">##  Ubuntu安装和配置</span>
<span class="c1">#  Trusty (14.04 LTS)安装</span>
<span class="c1"># 创建/etc/apt/trusted.gpg.d/dovecot.gpg</span>
curl https://repo.dovecot.org/DOVECOT-REPO-GPG <span class="p">|</span> gpg --import
gpg --export ED409DA1 &gt; /etc/apt/trusted.gpg.d/dovecot.gpg
<span class="c1"># 创建/etc/apt/sources.list.d/dovecot.list 想要使用https，确保安装apt-transport-https</span>
deb https://repo.dovecot.org/ce-2.3-latest/ubuntu/trusty trusty main

<span class="c1"># Xenial (16.04 LTS)安装</span>
Create /etc/apt/trusted.gpg.d/dovecot.gpg
curl https://repo.dovecot.org/DOVECOT-REPO-GPG <span class="p">|</span> gpg --import
gpg --export ED409DA1 &gt; /etc/apt/trusted.gpg.d/dovecot.gpg
Create /etc/apt/sources.list.d/dovecot.list. If you want to use
https, make sure you have installed apt-transport-https
deb https://repo.dovecot.org/ce-2.3-latest/ubuntu/xenial xenial main

<span class="c1"># 新安装需要的包名</span>
dovecot-core dovecot-dbg dovecot-dev dovecot-gssapi dovecot-imapd dovecot-imaptest dovecot-ldap dovecot-lmtpd dovecot-lua dovecot-lucene dovecot-managesieved dovecot-mysql dovecot-pgsql dovecot-pigeonhole-dbg <span class="se">\</span>
dovecot-pop3d dovecot-sieve-dev dovecot-sieve dovecot-solr dovecot-sqlite dovecot-submissiond

<span class="c1">##  source tarballs文件编译安装</span>
<span class="c1"># 下载地址：https://dovecot.org/download.html</span>
https://dovecot.org/releases/2.3/dovecot-2.3.0.tar.gz
tar -zxvf dovecot-2.3.0
./configure
make <span class="o">&amp;&amp;</span> make install
<span class="c1"># 自定义安装位置和库的路径</span>
<span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">&quot;-I/opt/openssl/include&quot;</span> <span class="nv">LDFLAGS</span><span class="o">=</span><span class="s2">&quot;-L/opt/openssl/lib&quot;</span> ./configure

<span class="c1"># 从git克隆编译安装</span>
git clone https://github.com/dovecot/core.git dovecot
<span class="c1"># 接着进入目录运行./autogen.sh生成配置脚本和其他需要的文件</span>
<span class="c1"># 需要提前安装的包</span>
autoconf automake libtool pkg-config gettext
pandoc <span class="o">(</span>不是必须安装，除非要使用: <span class="nv">PANDOC</span><span class="o">=</span><span class="nb">false</span> ./configure<span class="o">)</span>
GNU make

<span class="c1"># 建议添加--enable-maintainer-mode参数到configure脚本</span>
./autogen.sh
./configure --enable-maintainer-mode
make <span class="o">&amp;&amp;</span> make install

<span class="c1">## 其他`</span>
非官方补丁地址：https://dovecot.org/patches/
额外工具地址：https://dovecot.org/tools/
GitHub仓库地址：https://github.com/dovecot/
</pre></div>

<h2 id="optional-configure-options">Optional Configure Options<a class="headerlink" href="#optional-configure-options" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="o">--</span><span class="nv">help</span><span class="o">=</span><span class="nv">short</span>
<span class="nv">just</span> <span class="nv">lists</span> <span class="nv">the</span> <span class="nv">options</span> <span class="nv">added</span> <span class="nv">by</span> <span class="nv">the</span> <span class="nv">particular</span> <span class="nv">package</span> <span class="ss">(</span><span class="o">=</span> <span class="nv">Dovecot</span><span class="ss">)</span>
<span class="nv">Options</span> <span class="nv">are</span> <span class="nv">usually</span> <span class="nv">listed</span> <span class="nv">as</span> <span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">something</span> <span class="nv">or</span> <span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">something</span>. <span class="k">If</span> <span class="nv">you</span> <span class="nv">want</span> <span class="nv">to</span> <span class="nv">disable</span> <span class="nv">them</span>, <span class="k">do</span> <span class="nv">it</span> <span class="nv">as</span> <span class="o">--</span><span class="nv">without</span><span class="o">-</span><span class="nv">something</span> <span class="nv">or</span> <span class="o">--</span><span class="nv">disable</span><span class="o">-</span><span class="nv">something</span>. <span class="nv">There</span> <span class="nv">are</span> <span class="nv">many</span> <span class="nv">default</span> <span class="nv">options</span> <span class="nv">that</span> <span class="nv">come</span> <span class="nv">from</span> <span class="nv">autoconf</span>, <span class="nv">automake</span> <span class="nv">or</span> <span class="nv">libtool</span>. <span class="nv">They</span> <span class="nv">are</span> <span class="nv">explained</span> <span class="nv">elsewhere</span>

<span class="nv">Here</span> <span class="nv">is</span> <span class="nv">a</span> <span class="nv">list</span> <span class="nv">of</span> <span class="nv">options</span> <span class="nv">that</span> <span class="nv">Dovecot</span> <span class="nv">adds</span>. <span class="nv">You</span> <span class="nv">should</span> <span class="nv">not</span> <span class="nv">usually</span> <span class="nv">have</span> <span class="nv">to</span> <span class="nv">change</span> <span class="nv">these</span>, <span class="nv">but</span> <span class="nv">they</span> <span class="nv">are</span> <span class="nv">described</span> <span class="nv">here</span> <span class="nv">just</span> <span class="k">for</span> <span class="nv">completeness</span>:

<span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">devel</span><span class="o">-</span><span class="nv">checks</span>
<span class="nv">Enables</span> <span class="nv">some</span> <span class="nv">extra</span> <span class="nv">sanity</span> <span class="nv">checks</span>. <span class="nv">This</span> <span class="nv">is</span> <span class="nv">mainly</span> <span class="nv">useful</span> <span class="k">for</span> <span class="nv">developers</span>. <span class="nv">It</span> <span class="nv">does</span> <span class="nv">quite</span> <span class="nv">a</span> <span class="nv">lot</span> <span class="nv">of</span> <span class="nv">unnecessary</span> <span class="nv">work</span> <span class="nv">but</span> <span class="nv">should</span> <span class="nv">catch</span> <span class="nv">some</span> <span class="nv">programming</span> <span class="nv">mistakes</span> <span class="nv">more</span> <span class="nv">quickly</span>
<span class="o">--</span><span class="nv">enable</span><span class="o">-</span><span class="nv">asserts</span>
<span class="nv">Enable</span> <span class="nv">assertion</span> <span class="nv">checks</span>, <span class="nv">enabled</span> <span class="nv">by</span> <span class="nv">default</span>. <span class="nv">Disabling</span> <span class="nv">them</span> <span class="nv">may</span> <span class="nv">slightly</span> <span class="nv">save</span> <span class="nv">some</span> <span class="nv">CPU</span>, <span class="nv">but</span> <span class="k">if</span> <span class="nv">there</span> <span class="nv">are</span> <span class="nv">bugs</span> <span class="nv">they</span> <span class="nv">can</span> <span class="nv">cause</span> <span class="nv">more</span> <span class="nv">problems</span> <span class="nv">since</span> <span class="nv">they</span> <span class="nv">are</span> <span class="nv">not</span> <span class="nv">detected</span> <span class="nv">as</span> <span class="nv">early</span>
<span class="o">--</span><span class="nv">without</span><span class="o">-</span><span class="nv">shared</span><span class="o">-</span><span class="nv">libs</span>
<span class="nv">Link</span> <span class="nv">Dovecot</span> <span class="nv">binaries</span> <span class="nv">with</span> <span class="nv">static</span> <span class="nv">libraries</span> <span class="nv">instead</span> <span class="nv">of</span> <span class="nv">dynamic</span> <span class="nv">libraries</span>
<span class="o">--</span><span class="nv">disable</span><span class="o">-</span><span class="nv">largefile</span>
<span class="nv">Specifies</span> <span class="k">if</span> <span class="nv">we</span> <span class="nv">use</span> <span class="mi">32</span><span class="nv">bit</span> <span class="nv">or</span> <span class="mi">64</span><span class="nv">bit</span> <span class="nv">file</span> <span class="nv">offsets</span> <span class="nv">in</span> <span class="mi">32</span><span class="nv">bit</span> <span class="nv">CPUs</span>. <span class="mi">64</span><span class="nv">bit</span> <span class="nv">is</span> <span class="nv">the</span> <span class="nv">default</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">system</span> <span class="nv">supports</span> <span class="nv">it</span> <span class="ss">(</span><span class="nv">Linux</span> <span class="nv">and</span> <span class="nv">Solaris</span> <span class="k">do</span><span class="ss">)</span>. <span class="nv">Dropping</span> <span class="nv">this</span> <span class="nv">to</span> <span class="mi">32</span><span class="nv">bit</span> <span class="nv">may</span> <span class="nv">save</span> <span class="nv">some</span> <span class="nv">memory</span>, <span class="nv">but</span> <span class="nv">it</span> <span class="nv">prevents</span> <span class="nv">accessing</span> <span class="nv">any</span> <span class="nv">file</span> <span class="nv">larger</span> <span class="nv">than</span> <span class="mi">2</span> <span class="nv">GB</span>
<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">mem</span><span class="o">-</span><span class="nv">align</span><span class="o">=</span><span class="nv">BYTES</span>
<span class="nv">Specifies</span> <span class="nv">memory</span> <span class="nv">alignment</span> <span class="nv">used</span> <span class="k">for</span> <span class="nv">memory</span> <span class="nv">allocations</span>. <span class="nv">It</span> <span class="nv">is</span> <span class="nv">needed</span> <span class="nv">with</span> <span class="nv">many</span> <span class="nv">non</span><span class="o">-</span><span class="nv">x86</span> <span class="nv">systems</span> <span class="nv">and</span> <span class="nv">it</span> <span class="nv">should</span> <span class="nv">speed</span> <span class="nv">up</span> <span class="nv">x86</span> <span class="nv">systems</span> <span class="nv">too</span>. <span class="nv">Default</span> <span class="nv">is</span> <span class="mi">8</span>, <span class="nv">to</span> <span class="nv">make</span> <span class="nv">sure</span> <span class="mi">64</span><span class="nv">bit</span> <span class="nv">memory</span> <span class="nv">accessing</span> <span class="nv">works</span>
<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">ioloop</span><span class="o">=</span><span class="nv">IOLOOP</span>
<span class="nv">Specifies</span> <span class="nv">what</span> <span class="nv">I</span><span class="o">/</span><span class="nv">O</span> <span class="k">loop</span> <span class="nv">method</span> <span class="nv">to</span> <span class="nv">use</span>. <span class="nv">Possibilities</span> <span class="nv">are</span> <span class="nv">select</span>, <span class="nv">poll</span>, <span class="nv">epoll</span> <span class="nv">and</span> <span class="nv">kqueue</span>. <span class="nv">The</span> <span class="nv">default</span> <span class="nv">is</span> <span class="nv">to</span> <span class="nv">use</span> <span class="nv">the</span> <span class="nv">best</span> <span class="nv">method</span> <span class="nv">available</span> <span class="nv">on</span> <span class="nv">your</span> <span class="nv">system</span>

<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">notify</span><span class="o">=</span><span class="nv">NOTIFY</span>
<span class="nv">Specifies</span> <span class="nv">what</span> <span class="nv">file</span> <span class="nv">system</span> <span class="nv">notification</span> <span class="nv">method</span> <span class="nv">to</span> <span class="nv">use</span>. <span class="nv">Possibilities</span> <span class="nv">are</span> <span class="nv">dnotify</span>, <span class="nv">inotify</span> <span class="ss">(</span><span class="nv">both</span> <span class="nv">on</span> <span class="nv">Linux</span><span class="ss">)</span>, <span class="nv">kqueue</span> <span class="ss">(</span><span class="nv">FreeBSD</span><span class="ss">)</span> <span class="nv">and</span> <span class="nv">none</span>. <span class="nv">The</span> <span class="nv">default</span> <span class="nv">is</span> <span class="nv">to</span> <span class="nv">use</span> <span class="nv">the</span> <span class="nv">best</span> <span class="nv">method</span> <span class="nv">available</span> <span class="nv">on</span> <span class="nv">your</span> <span class="nv">system</span>. <span class="nv">See</span> <span class="nv">Notify</span> <span class="nv">method</span> <span class="nv">above</span> <span class="k">for</span> <span class="nv">more</span> <span class="nv">information</span>

<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">storages</span><span class="o">=</span><span class="nv">FORMATS</span>
<span class="nv">Specifies</span> <span class="nv">what</span> <span class="nv">mailbox</span> <span class="nv">formats</span> <span class="nv">to</span> <span class="nv">support</span>. <span class="nv">Note</span>: <span class="nv">Independent</span> <span class="nv">of</span> <span class="nv">this</span> <span class="nv">option</span>, <span class="nv">the</span> <span class="nv">formats</span> <span class="nv">raw</span> <span class="nv">and</span> <span class="nv">shared</span> <span class="nv">will</span> <span class="nv">be</span> <span class="nv">always</span> <span class="nv">built</span>

<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">solr</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">Solr</span> <span class="nv">full</span> <span class="nv">text</span> <span class="nv">search</span> <span class="nv">support</span>
<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">zlib</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">zlib</span> <span class="nv">compression</span> <span class="nv">support</span> <span class="ss">(</span><span class="nv">default</span> <span class="k">if</span> <span class="nv">detected</span><span class="ss">)</span>
<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">bzlib</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">bzip2</span> <span class="nv">compression</span> <span class="nv">support</span> <span class="ss">(</span><span class="nv">default</span> <span class="k">if</span> <span class="nv">detected</span><span class="ss">)</span>
<span class="nv">SQL</span> <span class="nv">Driver</span> <span class="nv">Options</span>
<span class="nv">SQL</span> <span class="nv">drivers</span> <span class="nv">are</span> <span class="nv">typically</span> <span class="nv">used</span> <span class="nv">only</span> <span class="k">for</span> <span class="nv">authentication</span>, <span class="nv">but</span> <span class="nv">they</span> <span class="nv">may</span> <span class="nv">be</span> <span class="nv">used</span> <span class="nv">as</span> <span class="nv">a</span> <span class="nv">lib</span><span class="o">-</span><span class="nv">dict</span> <span class="nv">backend</span> <span class="nv">too</span>, <span class="nv">which</span> <span class="nv">can</span> <span class="nv">be</span> <span class="nv">used</span> <span class="nv">by</span> <span class="nv">plugins</span> <span class="k">for</span> <span class="nv">different</span> <span class="nv">purposes</span>

<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">sql</span><span class="o">-</span><span class="nv">drivers</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">specified</span> <span class="nv">SQL</span> <span class="nv">drivers</span>. <span class="nv">Defaults</span> <span class="nv">to</span> <span class="nv">all</span> <span class="nv">that</span> <span class="nv">were</span> <span class="nv">found</span> <span class="nv">with</span> <span class="nv">autodetection</span>
<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">pgsql</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">PostgreSQL</span> <span class="nv">support</span> <span class="ss">(</span><span class="nv">requires</span> <span class="nv">pgsql</span><span class="o">-</span><span class="nv">devel</span>, <span class="nv">libpq</span><span class="o">-</span><span class="nv">dev</span> <span class="nv">or</span> <span class="nv">similar</span> <span class="nv">package</span><span class="ss">)</span>
<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">mysql</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">MySQL</span> <span class="nv">support</span> <span class="ss">(</span><span class="nv">requires</span> <span class="nv">mysql</span><span class="o">-</span><span class="nv">devel</span>, <span class="nv">libmysqlclient15</span><span class="o">-</span><span class="nv">dev</span> <span class="nv">or</span> <span class="nv">similar</span> <span class="nv">package</span><span class="ss">)</span>
<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">sqlite</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">SQLite3</span> <span class="nv">driver</span> <span class="nv">support</span> <span class="ss">(</span><span class="nv">requires</span> <span class="nv">sqlite</span><span class="o">-</span><span class="nv">devel</span>, <span class="nv">libsqlite3</span><span class="o">-</span><span class="nv">dev</span> <span class="nv">or</span> <span class="nv">similar</span> <span class="nv">package</span><span class="ss">)</span>
<span class="nv">Authentication</span> <span class="nv">Backend</span> <span class="nv">Options</span>
<span class="nv">The</span> <span class="nv">basic</span> <span class="nv">backends</span> <span class="nv">are</span> <span class="nv">built</span> <span class="k">if</span> <span class="nv">the</span> <span class="nv">system</span> <span class="nv">is</span> <span class="nv">detected</span> <span class="nv">to</span> <span class="nv">support</span> <span class="nv">them</span>:

<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">shadow</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">shadow</span> <span class="nv">password</span> <span class="nv">support</span>

<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">pam</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">PAM</span> <span class="nv">support</span>

<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">nss</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">NSS</span> <span class="nv">support</span>

<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">sia</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">Tru64</span> <span class="nv">SIA</span> <span class="nv">support</span>
<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">bsdauth</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">BSD</span> <span class="nv">authentication</span> <span class="nv">support</span> <span class="ss">(</span><span class="k">if</span> <span class="nv">supported</span> <span class="nv">by</span> <span class="nv">your</span> <span class="nv">OS</span><span class="ss">)</span>

<span class="nv">Some</span> <span class="nv">backends</span> <span class="nv">require</span> <span class="nv">extra</span> <span class="nv">libraries</span> <span class="nv">and</span> <span class="nv">are</span> <span class="nv">not</span> <span class="nv">necessarily</span> <span class="nv">wanted</span>, <span class="nv">so</span> <span class="nv">they</span> <span class="nv">are</span> <span class="nv">built</span> <span class="nv">only</span> <span class="k">if</span> <span class="nv">specifically</span> <span class="nv">enabled</span>:

<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">sql</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">generic</span> <span class="nv">SQL</span> <span class="nv">support</span> <span class="ss">(</span><span class="nv">drivers</span> <span class="nv">are</span> <span class="nv">enabled</span> <span class="nv">separately</span><span class="ss">)</span>
<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">ldap</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">LDAP</span> <span class="nv">support</span> <span class="ss">(</span><span class="nv">requires</span> <span class="nv">openldap</span><span class="o">-</span><span class="nv">devel</span>, <span class="nv">libldap2</span><span class="o">-</span><span class="nv">dev</span> <span class="nv">or</span> <span class="nv">similar</span> <span class="nv">package</span><span class="ss">)</span>
<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">gssapi</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">GSSAPI</span> <span class="nv">authentication</span> <span class="nv">support</span> <span class="ss">(</span><span class="nv">requires</span> <span class="nv">krb5</span><span class="o">-</span><span class="nv">devel</span>, <span class="nv">libkrb5</span><span class="o">-</span><span class="nv">dev</span> <span class="nv">or</span> <span class="nv">similar</span> <span class="nv">package</span><span class="ss">)</span>
<span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">vpopmail</span>
<span class="nv">Build</span> <span class="nv">with</span> <span class="nv">vpopmail</span> <span class="nv">support</span> <span class="ss">(</span><span class="nv">requires</span> <span class="nv">vpopmail</span> <span class="nv">sources</span> <span class="nv">or</span> <span class="nv">a</span> <span class="nv">devel</span> <span class="nv">package</span><span class="ss">)</span>
<span class="nv">It</span> <span class="nv">is</span> <span class="nv">also</span> <span class="nv">possible</span> <span class="nv">to</span> <span class="nv">build</span> <span class="nv">these</span> <span class="nv">as</span> <span class="nv">plugins</span> <span class="nv">by</span> <span class="nv">giving</span> <span class="nv">e</span>.<span class="nv">g</span>. <span class="o">--</span><span class="nv">with</span><span class="o">-</span><span class="nv">sql</span><span class="o">=</span><span class="nv">plugin</span>

<span class="nv">Dynamic</span> <span class="nv">IMAP</span> <span class="nv">and</span> <span class="nv">POP3</span> <span class="nv">Modules</span>
<span class="nv">The</span> <span class="nv">mail_plugins</span> <span class="nv">setting</span> <span class="nv">lists</span> <span class="nv">all</span> <span class="nv">plugins</span> <span class="nv">that</span> <span class="nv">Dovecot</span> <span class="nv">is</span> <span class="nv">supposed</span> <span class="nv">to</span> <span class="nv">load</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">mail_plugin_dir</span> <span class="nv">directory</span> <span class="nv">at</span> <span class="nv">program</span> <span class="nv">start</span>. <span class="nv">These</span> <span class="nv">plugins</span> <span class="nv">can</span> <span class="k">do</span> <span class="nv">anything</span> <span class="nv">they</span> <span class="nv">want</span>. <span class="nv">They</span> <span class="nv">are</span> <span class="nv">only</span> <span class="nv">expected</span> <span class="nv">to</span> <span class="nv">contain</span> <span class="nv">the</span> <span class="o">&lt;</span><span class="nv">plugin</span> <span class="nv">name</span><span class="o">&gt;</span><span class="nv">_init</span> <span class="nv">and</span> <span class="o">&lt;</span><span class="nv">plugin</span> <span class="nv">name</span><span class="o">&gt;</span><span class="nv">_deinit</span> <span class="nv">functions</span> <span class="nv">which</span> <span class="nv">are</span> <span class="nv">called</span> <span class="nv">at</span> <span class="nv">startup</span> <span class="nv">and</span> <span class="nv">at</span> <span class="k">exit</span>

<span class="o">*</span> <span class="nv">The</span> <span class="nv">plugin</span> <span class="nv">filename</span> <span class="nv">is</span> <span class="nv">prefixed</span> <span class="nv">with</span> <span class="nv">a</span> <span class="nv">number</span> <span class="nv">which</span> <span class="nv">specifies</span> <span class="nv">the</span> <span class="nv">order</span> <span class="nv">in</span> <span class="nv">which</span> <span class="nv">the</span> <span class="nv">plugins</span> <span class="nv">are</span> <span class="nv">loaded</span>. <span class="nv">This</span> <span class="nv">is</span> <span class="nv">important</span> <span class="k">if</span> <span class="nv">one</span> <span class="nv">plugin</span> <span class="nv">depends</span> <span class="nv">on</span> <span class="nv">another</span>
</pre></div>

<h2 id="email_1">email安装过程相关问题和配置<a class="headerlink" href="#email_1" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="c1"># 出现Maildir权限问题解决方法</span>
<span class="c1"># 检查selinux状态并关闭</span>
<span class="c1"># 方法一：/usr/sbin/sestatus -v</span>
<span class="c1"># 方法二：</span>
getenforce <span class="m">0</span> <span class="c1">#  设置selinux为permissive模式()临时关闭，不用重启，重启后失效</span>
<span class="c1"># 永久生效方法：</span>
vi /etc/selinux/config
<span class="nv">SELINUX</span><span class="o">=</span><span class="nv">enforcing更改为SELINUX</span><span class="o">=</span>disabled

<span class="c1"># 建立防火墙规则</span>
vi /usr/local/sbin/startmailf
<span class="c1">#!/bin/bash</span>
<span class="c1">#create:</span>
<span class="c1">#Creater:</span>
iptables -I INPUT -p tcp --dport <span class="m">110</span> -j ACCEPT     <span class="c1">#允许邮件收信110端口，POP3的IP入口</span>
iptables -I INPUT -p udp --dport <span class="m">110</span> -j ACCEPT     <span class="c1">#允许邮件收信110端口，POP3的带数据包入口</span>
iptables -I INPUT -p tcp --dport <span class="m">25</span> -j ACCEPT      <span class="c1">#允许邮件发信25端口，IP入口</span>
iptables -I INPUT -p udp --dport <span class="m">25</span> -j ACCEPT      <span class="c1">#允许邮件发信25端口，带数据包入口</span>
iptables -I INPUT -p udp --dport <span class="m">143</span> -j ACCEPT     <span class="c1">#允许邮件收信143端口，IMAP的IP入口</span>
iptables -I INPUT -p tcp --dport <span class="m">143</span> -j ACCEPT     <span class="c1">#允许邮件收信143端口，IMAP的带数据包入口</span>
iptables -I INPUT -p udp --dport <span class="m">22</span> -j ACCEPT      <span class="c1">#开放PUTTY和WINSCP 22号端口，方便管理员进入</span>
iptables -I INPUT -p tcp --dport <span class="m">22</span> -j ACCEPT      <span class="c1">#开放PUTTY和WINSCP 22号端口，方便管理员进入</span>
iptables -I INPUT -p tcp --dport <span class="m">53</span> -j ACCEPT      <span class="c1">#开放DNS查询端口，这样能解析到邮件服务器</span>
iptables -I INPUT -p udp --dport <span class="m">53</span> -j ACCEPT      <span class="c1">#开放DNS查询端口，这样能解析到邮件服务器</span>
service network restart                            <span class="c1">#重启网络</span>
service postfix restart                            <span class="c1">#重启postfix</span>
service dovecot restart                            <span class="c1">#重启dovecot</span>
service saslauthd restart                          <span class="c1">#重启ASAL授权</span>
<span class="c1">#也可以再加456，1925，587等邮件SSL/TLS端口，80网页管理端口，根据你的邮件服务器而定</span>

<span class="c1"># 将防火墙规则开机自启动</span>
vi /etc/rc.local
<span class="c1">#!/bin/sh</span>
<span class="c1">#</span>
<span class="c1"># This script will be executed *after* all the other init scripts</span>
<span class="c1"># You can put your own initialization stuff in here if you don&#39;t</span>
<span class="c1"># want to do the full Sys V style init stuff</span>
touch /var/lock/subsys/local
sh /usr/local/sbin/startmailf  <span class="c1">#把创建的防火墙规则加在这一行</span>

<span class="c1"># CentOS系统一般都自带sendmail的，如果不需要，可以使用以下命令删除</span>
rpm -e sendmail

<span class="c1"># 检查默认邮件传输代理(MTA)</span>
* alternatives --display mta
<span class="c1"># 默认是sendmail，更改MTA为postfix</span>
/usr/sbin/alternatives --set mta /usr/sbin/sendmail.postfix
<span class="c1"># 配置Postfix</span>
* Postfix配置文件主要是两个master.cf和main.cf，这里我们只需要配置main.cf，即/etc/postfix/main.cf
<span class="c1"># 更改以下内容</span>
<span class="nv">myhostname</span> <span class="o">=</span> mail.1a-centosserver.com
<span class="nv">mydomain</span> <span class="o">=</span> 1a-centosserver.com
<span class="nv">myorigin</span> <span class="o">=</span> <span class="nv">$mydomain</span>
<span class="nv">inet_interfaces</span> <span class="o">=</span> all
<span class="nv">mydestination</span> <span class="o">=</span> <span class="nv">$myhostname</span>, localhost.<span class="nv">$mydomain</span>, localhost, <span class="nv">$mydomain</span>
<span class="nv">mynetworks</span> <span class="o">=</span> <span class="m">192</span>.168.13.0/24, <span class="m">127</span>.0.0.0/8
<span class="nv">relay_domains</span> <span class="o">=</span>
<span class="nv">home_mailbox</span> <span class="o">=</span> Maildir/

<span class="c1"># 配置文件解释：</span>
mydomain:
mydomain参数是指email服务器的域名，请确保为正式域名（如centos.bz）
myhostname:
myhostname参数是指系统的主机名称（如我的服务器主机名称是mail.centos.bz）
myorigin:
myorigin参数指定本地发送邮件中来源和传递显示的域名。在我们的例子中，mydomain是centos.bz，也是我的域名
对于下面的一行，我们的邮件地址是user@centos.bz而不是user@mail.centos.bz
<span class="nv">myorigin</span> <span class="o">=</span> <span class="nv">$mydomain</span>
mynetworks:
mynetworks参数指定受信任SMTP的列表，具体的说，受信任的SMTP客户端允许通过Postfix传递邮件
mydestination:
mydestination参数指定哪些邮件地址允许在本地发送邮件。这是一组被信任的允许通过服务器发送或传递邮件的IP地址。用户试图通过发送从此处未列出的IP地址的原始服务器的邮件将被拒绝
inet_interfaces:
inet_interfaces参数设置网络接口以便Postfix能接收到邮件
relay_domains:
该参数是系统传递邮件的目的域名列表。如果留空，我们保证了我们的邮件服务器不对不信任的网络开放
home_mailbox:
该参数设置邮箱路径与用户目录有关，也可以指定要使用的邮箱风格

<span class="c1"># 测试Postfix SMTP连接</span>
service postfix status
检测默认smtp端口25是否已经监听
netstat -an <span class="p">|</span> grep <span class="m">25</span>
设置postfix开机启动
chkconfig postfix on
开始测试postfix是否工作正常
telnet localhost <span class="m">25</span>
所有邮件发送到/home/user/Maildir/new

<span class="c1"># 邮件别名设置</span>
配置文件位置：/etc/alises里，格式：
<span class="o">[</span>Format<span class="o">]</span>
Receiving Account or other aliaes:recipient A,recipient B,....
例一:root:root,james <span class="c1"># 表示root用户的邮件对于用户james和root都可以接收到</span>
例二：class2017:james,anna,mark <span class="c1">#设置群邮件，表示设置了群邮件名class2017，当发送一封邮件到class2017@qq.com时，用户james、anna、mark都可以收到邮件</span>
使用“newaliases”命令激活邮件别名功能
当编辑/etc/aliases文件后，必须执行newaliases命令更新别名数据库
POP/IMAP设置
为了使用户可以在本地机器下载邮件，必须在邮件服务器安装并设置POP或IMAP，docecot是适用在Linux邮件系统POP/IMAP邮件服务器之一，支持maildir和mbox格式
</pre></div>

<h2 id="dovecot">安装和配置dovecot<a class="headerlink" href="#dovecot" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>* 首先检测dovecot软件包是否已经安装
rpm -qa dovecot
用yum命令安装：yum -y install dovecot
Dovecot配置文件在/etc/dovecot.conf，需要改动的地方如下

vim /etc/dovecot.conf
<span class="c1"># Protocols we want to be serving: imap imaps pop3 pop3s</span>
<span class="c1"># If you only want to use dovecot-auth, you can set this to &quot;none&quot;</span>
<span class="nv">protocols</span> <span class="o">=</span> imap imaps pop3 pop3s
删除protocols行前面的“#”来激活imap imaps pop3和pop3s服务

启动dovecot:
service dovecot start <span class="c1">#centos6.x</span>
systemctl start dovecot <span class="c1">#centos7.x</span>
chkconfig dovecot on <span class="c1">#centos6.x</span>
systemctl <span class="nb">enable</span> dovecot  <span class="c1">#centos7.x</span>
使用telnet命令检测110（pop3）和143（imap）端口
telnet <span class="m">127</span>.0.0.1 <span class="m">110</span>
telnet <span class="m">127</span>.0.0.1 <span class="m">143</span>
ps -ef <span class="p">|</span> grep dovecot <span class="c1"># 显示dovecot守护进程</span>

<span class="c1"># 配置使用Dovecot SASL进行SMTP验证</span>

<span class="c1"># 1、编辑 /etc/dovecot.conf，确保auth default区域有如下设置值：</span>
auth default <span class="o">{</span>
  socket listen <span class="o">{</span>
    client <span class="o">{</span>
  <span class="nv">path</span> <span class="o">=</span> /var/spool/postfix/private/auth
  <span class="nv">mode</span> <span class="o">=</span> <span class="m">0660</span>
  <span class="nv">user</span> <span class="o">=</span> postfix
  <span class="nv">group</span> <span class="o">=</span> postfix
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="nv">mechanisms</span> <span class="o">=</span> plain login
<span class="o">}</span>

<span class="c1"># 2、编辑/etc/postfix/main.cf，增加如下代码启用sasl认证</span>
<span class="nv">smtpd_sasl_type</span> <span class="o">=</span> dovecot
<span class="nv">smtpd_sasl_path</span> <span class="o">=</span> private/auth
<span class="nv">smtpd_sasl_auth_enable</span> <span class="o">=</span> yes
<span class="nv">smtpd_recipient_restrictions</span> <span class="o">=</span>  permit_mynetworks,
    permit_sasl_authenticated, reject_unauth_destination
<span class="nv">broken_sasl_auth_clients</span> <span class="o">=</span> yes

<span class="c1"># 3、重启服务</span>
service postfix restart
service dovecot restart
<span class="c1"># 现在你可以使用邮件客户端代理软件和系统用户及密码来连接我们的Dovecot服务器了</span>

<span class="c1"># **详细配置文档说明**</span>

* /etc/postfix/目录有两个主配置文件main.cf和master.cf，我们主要设置main.cf，master.cf基本保持默认就行
postfix有100多个参数，但我们可以根据自己的要求去改少量的参数，其它保持默认就可

修改任何文件之前必须把原文件备份
cp /etc/postfix/main.cf /etc/postfix/main.cf.bak

vi /etc/postfix/main.cf
<span class="nv">alias_database</span> <span class="o">=</span> hash:/etc/aliases       <span class="c1">#用户别名数据文件，默认，可根据自己的要求可改成SQL,LDAP,VIRTUAL</span>
<span class="nv">alias_maps</span> <span class="o">=</span> hash:/etc/aliases           <span class="c1">#用户别名配置文件，默认，可根据自己的要求可改成SQL,LDAP,VIRTUAL</span>
<span class="nv">broken_sasl_auth_clients</span> <span class="o">=</span> yes           <span class="c1">#设定 SASL 支持非标准 E-mail Client 的认证动作，自己添加</span>
<span class="nv">command_directory</span> <span class="o">=</span> /usr/sbin            <span class="c1">#命令目录      默认</span>
<span class="nv">config_directory</span> <span class="o">=</span> /etc/postfix          <span class="c1">#配置文件目录 默认</span>
<span class="nv">daemon_directory</span> <span class="o">=</span> /usr/libexec/postfix  <span class="c1">#守护进程目录 默认</span>
<span class="nv">data_directory</span> <span class="o">=</span> /var/lib/postfix        <span class="c1">#数据目录  默认</span>
<span class="nv">debug_peer_level</span> <span class="o">=</span> <span class="m">2</span>                     <span class="c1">#排错管理级别 默认</span>
<span class="nv">home_mailbox</span> <span class="o">=</span> Maildir/                  <span class="c1">#主目录存储格式，你也可以设成另外的格式mbox，</span>
<span class="nv">html_directory</span> <span class="o">=</span> no                      <span class="c1">#是否支持网页格式管理</span>
<span class="nv">inet_interfaces</span> <span class="o">=</span> all                    <span class="c1">#参数指定postfix系统监听的网络接口</span>
<span class="nv">inet_protocols</span> <span class="o">=</span> all                     <span class="c1">#只支持IPv4协议，还是IPv4 IPv6都支持,还是主机，ip</span>
<span class="nv">mail_owner</span> <span class="o">=</span> postfix                     <span class="c1">#邮件及邮件队列的所有者</span>
<span class="c1">#mail_spool_directory = /vbox            #指定UNIX风格的邮箱保存的目录。默认设置取决于系统类型</span>
<span class="nv">mailq_path</span> <span class="o">=</span> /usr/bin/mailq.postfix      <span class="c1">#指定查看邮件队列命令MAILQ的路径</span>
<span class="nv">manpage_directory</span> <span class="o">=</span> /usr/share/man       <span class="c1">#Postfix的在线手册页的位置</span>
<span class="nv">mydestination</span> <span class="o">=</span> <span class="nv">$myhostname</span>,... <span class="c1">#参数指定postfix接收邮件时收件人的域名，即您的postfix系统要接收到哪个域名的邮件</span>
<span class="nv">mydomain</span> <span class="o">=</span> davistest.com         <span class="c1">#参数指定您的域名，默认情况下，postfix将myhostname的第一部分删除而作为mydomain的值</span>
<span class="nv">myhostname</span> <span class="o">=</span> mail.davistest.com  <span class="c1">#参数指定运行postfix邮件系统的主机的主机名，默认情况下，其值被设定为本地机器名</span>
<span class="nv">mynetworks</span> <span class="o">=</span> <span class="m">192</span>.168.1.0/24 <span class="c1">#参数指定你所在的网络的网络地址，postfix系统根据其值来区别用户是远程的还是本地的</span>
<span class="nv">myorigin</span> <span class="o">=</span> <span class="nv">$mydomain</span>                     <span class="c1">#参数用来指明发件人所在的域名</span>
<span class="nv">newaliases_path</span> <span class="o">=</span> /usr/bin/newaliases.postfix <span class="c1">#刷新别名命令newaliases路径</span>
<span class="nv">queue_directory</span> <span class="o">=</span> /var/spool/postfix      <span class="c1">#指定队列的位置</span>
<span class="nv">readme_directory</span> <span class="o">=</span> /usr/share/doc/postfix-2.6.6/README_FILES <span class="c1">#帮助文档位置</span>
<span class="nv">sample_directory</span> <span class="o">=</span> /usr/share/doc/postfix-2.6.6/samples   <span class="c1">#模板文件位置</span>
<span class="nv">sendmail_path</span> <span class="o">=</span> /usr/sbin/sendmail.postfix <span class="c1">#发送邮件命令的位置</span>
<span class="nv">setgid_group</span> <span class="o">=</span> postdrop  <span class="c1">#这个组是提交邮件和对列管理命令</span>
<span class="nv">message_size_limit</span> <span class="o">=</span> <span class="m">10240000</span>  <span class="c1">#限制发送人单个邮件的大小，单位是Byte</span>
<span class="nv">smtpd_recipient_restrictions</span> <span class="o">=</span> permit_mynetworks,
permit_sasl_authenticated,reject_unauth_destination  <span class="c1">#信件收件的限制</span>
<span class="nv">smtpd_sasl_security_options</span> <span class="o">=</span> noanonymous  <span class="c1">#拒绝匿名登入</span>
<span class="nv">smtpd_sasl_auth_enable</span> <span class="o">=</span> yes    <span class="c1">#Postfix SMTP server支援SASL验证</span>
<span class="nv">smtpd_sasl_path</span> <span class="o">=</span> private/auth  <span class="c1">#postfix与dovecot通讯程序文件路径</span>
<span class="nv">smtpd_sasl_type</span> <span class="o">=</span> dovecot       <span class="c1">#指定sasl验证程序</span>
<span class="nv">unknown_local_recipient_reject_code</span> <span class="o">=</span> <span class="m">550</span>
<span class="c1">#拒绝不存在的本地帐户／「不明使用者」(unknown user)</span>
<span class="c1">#如果收信地址的人名部份，在任何对照表、别名表、系统帐户都查不出来，</span>
<span class="c1">#这个人会被视为「不明使用者」(unknown user)，系统会拒收</span>
<span class="c1">#如果希望蒐集这类信件，使用下列设定，并指定集中收集的信箱</span>
<span class="c1">#以上的mydestination一定要有本机主机名，要不然会收不到信</span>

<span class="c1"># postfix也自带很多反垃圾设置，可根据实际情况以及自己的需要进行调整</span>
<span class="nv">smtpd_helo_required</span> <span class="o">=</span> yes <span class="c1">#握手要求</span>
<span class="nv">smtpd_delay_reject</span> <span class="o">=</span> yes  <span class="c1">#中继要求</span>
<span class="nv">smtpd_client_restrictions</span> <span class="o">=</span>
check_client_access hash:/etc/postfix/client_access <span class="c1">#客户端访问控制列表</span>
<span class="nv">smtpd_helo_restrictions</span><span class="o">=</span>
reject_invalid_hostname,check_helo_access hash:/usr/local/etc/postfix/helo_access#主机和握手控制列表
<span class="nv">smtpd_sender_restrictions</span> <span class="o">=</span>                 <span class="c1">#客户端发送人控制列表</span>
 reject_non_fqdn_sender,                    <span class="c1">#拒收没有注册域名的发送者</span>
 reject_unknown_sender_domain,              <span class="c1">#拒收不知发件人域的发送者</span>
 check_sender_access hash:/usr/local/etc/postfix/sender_access  <span class="c1">#发件人控制列表</span>
<span class="nv">smtpd_recipient_restrictions</span><span class="o">=</span>               <span class="c1">#收件控制</span>
 permit_mynetworks,                         <span class="c1">#允许我的网络定义的客户端收信</span>
 permit_sasl_authenticated,                 <span class="c1">#允许simple authenticated security layer 授权的客户端</span>
 reject_non_fqdn_hostname,                  <span class="c1">#拒收没有注册的主机</span>
 reject_non_fqdn_sender,                    <span class="c1">#拒收没有注册的发送人</span>
 reject_non_fqdn_recipient,                 <span class="c1">#拒收没注册的接收者</span>
 reject_unauth_destination,                 <span class="c1">#拒收没授权的目的主机</span>
 reject_invalid_hostname,                   <span class="c1">#拒收不可用的主机</span>
 <span class="c1">#还有很多</span>
 <span class="nv">smtpd_data_restrictions</span> <span class="o">=</span> reject_unauth_pipelining         <span class="c1">#拒绝没有授权的通道</span>
    <span class="nv">header_checks</span> <span class="o">=</span> regexp:/postfix/head_checks      <span class="c1">#绝对路径邮件头（主题，附件名等）控制列表</span>
    <span class="nv">body_checks</span> <span class="o">=</span> regexp:/etc/postfix/body_checks    <span class="c1">##绝对路径邮件内容控制列表</span>
创建刚才指定的文件就不一一写出来了，照这个方法就行了
 touch /usr/local/etc/postfix/head_checks
 touch /usr/local/etc/postfix/body_checks
 postmap /usr/local/etc/postfix/head_checks
 postmap /usr/local/etc/postfix/body_checks

还是例举一下吧，要不然想了解的都不知文档怎么写
假如/etc/postfix/mail.cf 下有如下反垃圾设置：
<span class="nv">smtpd_client_restrictions</span> <span class="o">=</span> check_client_access hash:/etc/postfix/access_client
<span class="nv">smtpd_helo_restrictions</span> <span class="o">=</span> check_client_access hash:/etc/postfix/helo_client
<span class="nv">smtpd_sender_restrictions</span> <span class="o">=</span> check_client_access hash:/etc/postfix/sender_client
<span class="nv">smtpd_recipient_restrictions</span> <span class="o">=</span> check_client_access hash:/etc/postfix/recipient_client
<span class="nv">header_checks</span> <span class="o">=</span> regexp:/etc/postfix/header_check
<span class="nv">body_checks</span> <span class="o">=</span> regexp:/etc/postfix/body_check

那么我们在access_client/helo_client/sender_client/recipient_client 文件的语法如下：
列表分三项，第一项是规则内容，第二项是对满足规则时所采取的行动，第三项是返回给客户端的信息
客户端域名/ip   <span class="m">550</span>/REJECT/OK.. 你不可以通过我们的服务器发邮件！access_client
客户端域名/ip   <span class="m">550</span>/REJECT/OK.. 禁止davis通过本服务器发送邮件  sender_client
客户端域名/ip   <span class="m">550</span>/REJECT/OK.. 服务器拒收来自davis的邮件.     recipient_client
客户端IP/域名   <span class="m">550</span>/REJECT/OK.. 服务器拒绝你的连接.             helo_client
不详说了，知道它是怎么工作的就行了，现在有很多软件,比如Mailscanner..功能强大，易管理
 配完之后，你可以用postconf -n main.cf去查看没有注释的内容
 我们用pam去调用连接系统用户为邮件用户验证saslauthd,当然也可以用LDAP,MYSQL等，或SYRUS的shadow.后面我们会讲到
<span class="c1"># Directory in which to place saslauthd&#39;s listening socket, pid file, and so</span>
<span class="c1"># on.  This directory must already exist</span>
<span class="nv">SOCKETDIR</span><span class="o">=</span>/var/run/saslauthd
<span class="c1"># Mechanism to use when checking passwords.  Run &quot;saslauthd -v&quot; to get a list</span>
<span class="c1"># of which mechanism your installation was compiled with the ablity to use</span>
<span class="nv">MECH</span><span class="o">=</span>pam                                                                         <span class="c1">#这行MECH设成pam</span>
<span class="c1"># Options sent to the saslauthd. If the MECH is other than &quot;pam&quot; uncomment the next line</span>
<span class="c1"># DAEMONOPTS=--user saslauth</span>
<span class="c1"># Additional flags to pass to saslauthd on the command line.  See saslauthd(8)</span>
<span class="c1"># for the list of accepted flags</span>
<span class="nv">FLAGS</span><span class="o">=</span>
我们用的是dovecot给客户端验证收信，所以我们先确定pam下的dovecot授权如下
Vi /etc/pam.d/dovecot
<span class="c1">#%PAM-1.0</span>
auth       required     pam_nologin.so
auth       include      password-auth
account    include      password-auth
session    include      password-auth
接着配置dovecot的收信

<span class="nv">protocols</span> <span class="o">=</span> imap pop3 lmtp               <span class="c1">#开放IMAP POP3 等协议 路径/etc/dovecot/dovecot.conf</span>
<span class="nv">auth_mechanisms</span> <span class="o">=</span> plain login            <span class="c1">#授权机制，如果我们用POSTADMIN网页管理，也可用什么MD5等等</span>
                                             <span class="c1">#路径/etc/dovecot/conf.d/10-auth.conf</span>
<span class="nv">disable_plaintext_auth</span> <span class="o">=</span> no              <span class="c1">#允许用明文认证登陆，路径/etc/dovecot/conf.d/10-auth.conf</span>
<span class="nv">listen</span> <span class="o">=</span> *                               <span class="c1">#我们只监听IPV4端口。路径/etc/dovecot/dovecot.conf</span>
<span class="nv">mail_location</span> <span class="o">=</span> maildir:/vbox/%u/Maildir <span class="c1">#邮件目录，%u表示用户名。路径/etc/dovecot/conf.d/10-mail.conf</span>
<span class="nv">mbox_write_locks</span> <span class="o">=</span> fcntl                 <span class="c1">#邮箱锁的方法。路径/etc/dovecot/conf.d/10-mail.conf</span>
passdb <span class="o">{</span>                                 <span class="c1">#帐户授权</span>
<span class="nv">args</span> <span class="o">=</span> dovecot                           <span class="c1">#就是/etc/pam.d/下的dovecot文件</span>
<span class="nv">driver</span> <span class="o">=</span> pam                             <span class="c1">#帐户授权数据提供商</span>
<span class="o">}</span>                                        <span class="c1"># 路径/etc/dovecot/conf.d/auth-system.conf.ext</span>
service auth <span class="o">{</span>                           <span class="c1">#服务授权</span>
unix_listener /var/spool/postfix/private/auth <span class="o">{</span>  <span class="c1">#UNIX监听的授权文件</span>
  <span class="nv">group</span> <span class="o">=</span> postfix                        <span class="c1">#指定监听授权文件的属组为POSTFIX</span>
  <span class="nv">mode</span> <span class="o">=</span> <span class="m">0666</span>                            <span class="c1">#指定监听授权文件组权限为666</span>
  <span class="nv">user</span> <span class="o">=</span> postfix                         <span class="c1">#指定监听授权文件的属主为postfix</span>
  <span class="o">}</span>                                      <span class="c1">#路径 /etc/dovecot/conf.d/auth-system.conf.ext</span>
<span class="o">}</span>
userdb <span class="o">{</span>                                 <span class="c1">#用户数据</span>
<span class="nv">driver</span> <span class="o">=</span> passwd                          <span class="c1">#共用系统密码驱动</span>
<span class="o">}</span>

<span class="c1"># 建立邮件存放目录邮件备份目录</span>
mkdir /vbox                              <span class="c1">#建立邮件MAILDIR目录</span>
chmod <span class="m">755</span> /vbox                          <span class="c1">#给权限</span>
mkdir /backup                            <span class="c1">#删除用户的备份目录</span>
chmod <span class="m">755</span> /backup                        <span class="c1">#备份目录权限</span>
mkdir /etc/postfix/Mail_Group            <span class="c1">#邮件组软链目录，以后做管理面版脚本要用</span>

<span class="c1"># 启动服务</span>
service postfix start
service dovecot start
service saslauthd start
<span class="c1"># 设置服务开机自动启动</span>
chkconfig postfix on
chkconfig dovecot on
chkconfig saslauthd on
<span class="c1">##  脚本编写</span>
<span class="c1"># 管理员控制面版</span>
vi /usr/local/sbin/main
<span class="c1">#!/bin/bash</span>
<span class="c1">#create: 15-Nov-2014</span>
<span class="c1">#Creater: Davis Dai</span>
<span class="nb">echo</span> <span class="s2">&quot;1 新建邮件帐号&quot;</span>            <span class="c1">#在屏幕上输出菜单</span>
<span class="nb">echo</span> <span class="s2">&quot;2 查看邮件帐号&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;3 删除邮件帐号&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;4 新建邮件组&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;5 删除邮件组&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;6 查看邮件组&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;7 添加用户到组&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;8 从组里删除用户&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;0 退出邮件管理&quot;</span>
<span class="nv">order</span><span class="o">=</span><span class="s2">&quot;&quot;</span>                          <span class="c1">#设参数为你要先择的菜单</span>
<span class="nb">echo</span> <span class="s2">&quot;请选择任务代码：&quot;</span>
<span class="nb">read</span> order
<span class="nb">echo</span> <span class="nv">$order</span> &gt;/tmp/order.txt
<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$order</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>         <span class="c1">#设条件根据你的选择跳到相应的管理模块</span>
    mailacounts<span class="p">;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$order</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;2&quot;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
    viewusers<span class="p">;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$order</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;3&quot;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
    dusers<span class="p">;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$order</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;4&quot;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
    groupacounts<span class="p">;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$order</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;5&quot;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
    dgroup<span class="p">;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$order</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;6&quot;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
  viewgroup<span class="p">;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$order</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;7&quot;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
    AMFG<span class="p">;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$order</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;8&quot;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
    RMFG<span class="p">;</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$order</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;0&quot;</span> <span class="o">]</span><span class="p">;</span><span class="k">then</span>
   <span class="nb">exit</span> <span class="m">0</span><span class="p">;</span>
<span class="k">else</span>                                           <span class="c1">#如果你的选择不是以上菜单，提示错误并返回控制面版</span>
    <span class="nb">echo</span> <span class="s2">&quot;任务代码错误，请重新输入！&quot;</span>
    main
<span class="k">fi</span>

<span class="c1"># 新建邮件模块</span>
vi /usr/local/sbin/mailacounts
<span class="nv">home</span><span class="o">=</span><span class="s2">&quot;/vbox/&quot;</span>                                           <span class="c1">#没置目录参数</span>
<span class="nv">useraccount</span><span class="o">=</span><span class="s2">&quot;&quot;</span>                                          <span class="c1">#设置用户参数</span>
<span class="nb">echo</span> <span class="s2">&quot;请给新用户名字：&quot;</span>
<span class="nb">read</span> useraccount
<span class="nb">echo</span> <span class="nv">$useraccount</span> &gt; /tmp/user.txt                       <span class="c1">#给用户参数赋值</span>
<span class="nv">userpass</span><span class="o">=</span><span class="s2">&quot;&quot;</span>                                             <span class="c1">#设置密码参数</span>
<span class="nb">echo</span> <span class="s2">&quot;请输入用户密码：&quot;</span>
<span class="nb">read</span> userpass
<span class="nb">echo</span> <span class="nv">$userpass</span> &gt; /tmp/pass.txt                          <span class="c1">#给密码参数赋值</span>
useradd -d <span class="nv">$home</span>/<span class="nv">$useraccount</span> <span class="nv">$useraccount</span>              <span class="c1">#添加用户并指定邮件主目录</span>
<span class="nb">echo</span> <span class="nv">$userpass</span> <span class="p">|</span>passwd --stdin <span class="nv">$useraccount</span>             <span class="c1">#设置邮箱密码</span>
mkdir -p <span class="nv">$home</span>/<span class="nv">$useraccount</span>/Maildir/<span class="o">{</span>cur,new,tmp<span class="o">}</span>       <span class="c1">#建邮件目录和文件</span>
mkdir -p <span class="nv">$home</span>/<span class="nv">$useraccount</span>/Maildir/.Drafts/<span class="o">{</span>cur,new,tmp<span class="o">}</span>
mkdir -p <span class="nv">$home</span>/<span class="nv">$useraccount</span>/Maildir/.Sent/<span class="o">{</span>cur,new,tmp<span class="o">}</span>
mkdir -p <span class="nv">$home</span>/<span class="nv">$useraccount</span>/Maildir/.Trash/<span class="o">{</span>cur,new,tmp<span class="o">}</span>
chown -R <span class="nv">$useraccount</span> <span class="nv">$home</span>/<span class="nv">$useraccount</span>/*    <span class="c1">#设置属主－R是做个递归，也就是说文件夹下所以有子文件夹和文件</span>
chmod <span class="m">700</span> -R <span class="nv">$home</span>/<span class="nv">$useraccount</span>/*                       <span class="c1">#设置属主有完全权限，其它人没任何权限</span>
main                                                    <span class="c1">#回到管理员控制面版</span>

<span class="c1"># 新建邮件组模块</span>
vim /usr/local/sbin/groupacounts
<span class="c1">#/bin/bash</span>
<span class="c1">#Create: 14-Nov-2014</span>
<span class="c1">#Creater: Davis Dai</span>
ls /etc/postfix/Mail_Group/                          <span class="c1">#显示现有组</span>
<span class="nv">home</span><span class="o">=</span><span class="s2">&quot;/vbox/&quot;</span>                                        <span class="c1">#没置目录参数</span>
<span class="nv">groupaccount</span><span class="o">=</span><span class="s2">&quot;&quot;</span>                                      <span class="c1">#设置邮件组参数</span>
<span class="nb">echo</span> <span class="s2">&quot;请输入新邮件组名：&quot;</span>
<span class="nb">read</span> groupaccount
<span class="nb">echo</span> <span class="nv">$groupaccount</span> &gt; /tmp/group.txt                  <span class="c1">#给组邮箱参数赋值</span>
<span class="nv">grouppass</span><span class="o">=</span><span class="s2">&quot;&quot;</span>                                         <span class="c1">#设置密码参数</span>
<span class="nb">echo</span> <span class="s2">&quot;请输入新邮件组密码：&quot;</span>
<span class="nb">read</span> grouppass
<span class="nb">echo</span> <span class="nv">$grouppass</span> &gt; /tmp/pass.txt                      <span class="c1">#给密码参数赋值</span>
useradd -d <span class="nv">$home</span>/<span class="nv">$groupaccount</span> <span class="nv">$groupaccount</span>         <span class="c1">#添加组邮箱并指定邮件主目录</span>
<span class="nb">echo</span> <span class="nv">$grouppass</span> <span class="p">|</span>passwd --stdin <span class="nv">$groupaccount</span>        <span class="c1">#设置组邮箱密码</span>
mkdir -p <span class="nv">$home</span>/<span class="nv">$groupraccount</span>/Maildir/<span class="o">{</span>cur,new,tmp<span class="o">}</span>  <span class="c1">#建组邮件目录和文件</span>
mkdir -p <span class="nv">$home</span>/<span class="nv">$groupaccount</span>/Maildir/.Drafts/<span class="o">{</span>cur,new,tmp<span class="o">}</span>
mkdir -p <span class="nv">$home</span>/<span class="nv">$groupaccount</span>/Maildir/.Sent/<span class="o">{</span>cur,new,tmp<span class="o">}</span>
mkdir -p <span class="nv">$home</span>/<span class="nv">$groupaccount</span>/Maildir/.Trash/<span class="o">{</span>cur,new,tmp<span class="o">}</span>
chown -R <span class="nv">$groupaccount</span> <span class="nv">$home</span>/<span class="nv">$groupaccount</span>/*    <span class="c1">#设置属主权限－R是做个递归，也就是说文件夹下所以有子文件夹和文件</span>
chmod <span class="m">700</span> -R <span class="nv">$home</span>/<span class="nv">$groupaccount</span>/*                   <span class="c1">#设置属主有完全权限，其它人没任何权限</span>
touch <span class="nv">$home</span>/<span class="nv">$groupaccount</span>/.forward                   <span class="c1">#建组邮件名单表</span>
chown root <span class="nv">$home</span>/<span class="nv">$groupaccount</span>/.forward              <span class="c1">#设置权限给名单表</span>
chmod <span class="m">755</span> <span class="nv">$home</span>/<span class="nv">$groupaccount</span>/.forward
ln -s <span class="nv">$home</span>/<span class="nv">$groupaccount</span>/.forward /etc/postfix/Mail_Group/<span class="nv">$groupaccount</span> <span class="c1">#做一个软连结，便于查找</span>
main                                                 <span class="c1">#回到管理员控制面版</span>

<span class="c1"># 添加邮箱到指定邮箱组模块</span>
vim /usr/local/sbin/AMFG
<span class="c1">#!/bin/bash</span>
<span class="c1">#Create Date: 15-Nov-2014</span>
<span class="c1">#Creater: Davis Dai</span>
ls /etc/postfix/Mail_Group
<span class="nv">Groupname</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;请输入你要加入的组全称：&quot;</span>
<span class="nb">read</span> Groupname
<span class="nb">echo</span> <span class="nv">$Groupname</span> &gt;/tmp/Groupname.txt
cat -n /vbox/<span class="nv">$Groupname</span>/.forward
<span class="nv">usermail</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;请输入你要加组的用户邮件地址：&quot;</span>
<span class="nb">read</span> usermail
<span class="nb">echo</span> <span class="nv">$usermail</span> &gt;/tmp/usermail.txt
<span class="nb">echo</span> <span class="nv">$usermail</span> &gt;&gt; /vbox/<span class="nv">$Groupname</span>/.forward
main

<span class="c1"># 删除邮箱帐号模块</span>
vim /usr/local/sbin/dusers
<span class="c1">#!/bin/bash</span>
<span class="c1">#create: 15-Nov-2014</span>
<span class="c1">#Creater: Davis Dai</span>
ls /vbox/
<span class="nv">deluser</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;请键入你要删除的用户：&quot;</span>
<span class="nb">read</span> deluser
<span class="nb">echo</span> <span class="nv">$deluser</span> &gt; /tmp/deluser.txt
cp -R -u -i /vbox/<span class="nv">$deluser</span> /backup/
userdel <span class="nv">$deluser</span>
rm -rf /vbox/<span class="nv">$deluser</span>
main
删除邮箱组模块

vim /usr/local/sbin/dgroup
<span class="c1">#!/bin/bash</span>
<span class="c1">#create: 15-Nov-2014</span>
<span class="c1">#Creater: Davis Dai</span>
ls /etc/postfix/Mail_Group/
<span class="nv">degroup</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;请键入你要删除的邮件组：&quot;</span>
<span class="nb">read</span> degroup
<span class="nb">echo</span> <span class="nv">$degroup</span> &gt; /tmp/degroup.txt
cp -R -u -i /vbox/<span class="nv">$degroup</span> /backup/
userdel <span class="nv">$degroup</span>
rm -rf /vbox/<span class="nv">$degroup</span>
main

<span class="c1"># 查找邮箱用户模块</span>
vim /usr/local/sbin/viewusers
<span class="c1">#!/bin/bash</span>
<span class="c1">#create: 15-Nov-2014</span>
<span class="c1">#Creater: Davis Dai</span>
ls /vbox/ &gt;/tmp/userview.txt
cat -n /tmp/userview.txt
<span class="nv">svuser</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;请输入你要查找的用户名：&quot;</span>
<span class="nb">read</span> svuser
<span class="nb">echo</span> <span class="nv">$svuser</span> &gt; /tmp/svuser.txt
<span class="k">if</span> grep -q <span class="nv">$svuser</span> /tmp/userview.txt<span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;用户</span><span class="nv">$svuser已经存在</span><span class="s2">!&quot;</span><span class="p">;</span>
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">&quot;用户</span><span class="nv">$svuser不存在</span><span class="s2">!&quot;</span><span class="p">;</span>
<span class="k">fi</span>
grep -n <span class="nv">$svuser</span> /tmp/userview.txt
main

<span class="c1"># 查找用户组模块</span>
vim /usr/local/sbin/viewgroup
<span class="c1">#!/bin/bash</span>
<span class="c1">#create: 15-Nov-2014</span>
<span class="c1">#Creater: Davis Dai</span>
ls /etc/postfix/Mail_Group/ &gt;/tmp/groupview.txt
cat -n /tmp/groupview.txt
<span class="nv">svgroup</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;请输入你要查找的邮件组：&quot;</span>
<span class="nb">read</span> svgroup
<span class="nb">echo</span> <span class="nv">$svuser</span> &gt; /tmp/svgroup.txt
<span class="k">if</span> grep -q <span class="nv">$svgroup</span> /tmp/groupview.txt<span class="p">;</span> <span class="k">then</span>
     <span class="nb">echo</span> <span class="s2">&quot;邮件组</span><span class="nv">$svgroup已经存在</span><span class="s2">!&quot;</span><span class="p">;</span>
<span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;邮件组</span><span class="nv">$group不存在</span><span class="s2">!&quot;</span><span class="p">;</span>
<span class="k">fi</span>
grep -n <span class="nv">$svgroup</span> /tmp/groupview.txt
main

<span class="c1"># 从邮箱组里删除用户模块</span>
vi /usr/local/sbin/RMFG
<span class="c1">#!/bin/bash</span>
<span class="c1">#create: 15-Nov-2014</span>
<span class="c1">#Creater: Davis Dai</span>
ls /etc/postfix/Mail_Group &gt;/tmp/groupview.txt
cat -n /tmp/groupview.txt
<span class="nv">sgroup</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;请键入你要删除的用户属组名称：&quot;</span>
<span class="nb">read</span> sgroup
<span class="nb">echo</span> <span class="nv">$scgoup</span> &gt;/tmp/sgroup.txt
cat -n /vbox/<span class="nv">$sgroup</span>/.forward
<span class="nv">rguser</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span> <span class="s2">&quot;请键入你要删除的用户编号：&quot;</span>
<span class="nb">read</span> rguser
<span class="nb">echo</span> <span class="nv">$rguser</span> &gt;/tmp/rguser.txt
sed -i <span class="s1">&#39;&#39;</span><span class="nv">$rguser</span><span class="s1">&#39;d&#39;</span> /vbox/<span class="nv">$sgroup</span>/.forward <span class="c1">#按编号删除</span>
<span class="c1">#sed -i “/$rguser/d” /vbox/$sgroup/.forward #按地址删除</span>
main
</pre></div>

<h2 id="_13">管理员手册<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="c1"># 进入服务器，输入邮件管理命令main,管理所有的任务</span>
<span class="o">[</span>root@mail sbin<span class="o">]</span><span class="c1"># main</span>
<span class="m">1</span> 新建邮件帐号
<span class="m">2</span> 查看邮件帐号
<span class="m">3</span> 删除邮件帐号
<span class="m">4</span> 新建邮件组
<span class="m">5</span> 删除邮件组
<span class="m">6</span> 查看邮件组
<span class="m">7</span> 添加用户到组
<span class="m">8</span> 从组里删除用户
<span class="m">0</span> 退出邮件管理
请选择任务代码：

<span class="c1"># 新建邮件帐号</span>
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># main</span>
<span class="m">1</span> 新建邮件帐号
<span class="m">2</span> 查看邮件帐号
<span class="m">3</span> 删除邮件帐号
<span class="m">4</span> 新建邮件组
<span class="m">5</span> 删除邮件组
<span class="m">6</span> 查看邮件组
<span class="m">7</span> 添加用户到组
<span class="m">8</span> 从组里删除用户
<span class="m">0</span> 退出邮件管理
请选择任务代码：
<span class="m">1</span>
请给新用户名字：
john
请输入用户密码：
<span class="m">123456</span>
Changing password <span class="k">for</span> user john
passwd: all authentication tokens updated successfully

<span class="c1"># 客户端测试</span>
只测试收发信，其它组呀，安全等都可以自行设置
</pre></div>

<div class="codehilite"><pre><span></span><span class="err">#</span><span class="w"> </span><span class="n">PostfixAdmin网页管理界面</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">依赖包的安装</span><span class="w"></span>
<span class="n">yum</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="err">－</span><span class="n">y</span><span class="w"> </span><span class="n">mysql</span><span class="o">-</span><span class="n">server</span><span class="w"> </span><span class="n">php</span><span class="w"> </span><span class="n">php</span><span class="o">-</span><span class="n">mysql</span><span class="w"> </span><span class="n">php</span><span class="o">-</span><span class="n">imap</span><span class="w"> </span><span class="n">php</span><span class="o">-</span><span class="n">mbstring</span><span class="w"></span>

<span class="err">#</span><span class="w"> </span><span class="o">[</span><span class="n">PostfixAdmin软件源码包下载网址</span><span class="o">]</span><span class="p">(</span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">sourceforge</span><span class="p">.</span><span class="n">net</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">postfixadmin</span><span class="o">/</span><span class="n">files</span><span class="o">/</span><span class="n">postfixadmin</span><span class="o">/</span><span class="p">)</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">下载解压后添加权限</span><span class="w"></span>
<span class="n">tar</span><span class="w"> </span><span class="o">-</span><span class="n">xzvf</span><span class="w"> </span><span class="n">postfixadmin</span><span class="o">-</span><span class="mf">2.92</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span><span class="w"></span>
<span class="n">chmod</span><span class="w"> </span><span class="mi">777</span><span class="w"> </span><span class="o">/</span><span class="n">postfixadmin</span><span class="o">/</span><span class="w"> </span><span class="o">-</span><span class="n">R</span><span class="w"></span>
<span class="err">#</span><span class="w"> </span><span class="n">修改PostfixAdmin网页主配置文件</span><span class="w"></span>
<span class="w"> </span><span class="n">vim</span><span class="w"> </span><span class="o">/</span><span class="n">postfixadmin</span><span class="o">/</span><span class="n">config</span><span class="p">.</span><span class="n">inc</span><span class="p">.</span><span class="n">php</span><span class="w"></span>
<span class="w"> </span><span class="err">$</span><span class="n">CONF</span><span class="o">[</span><span class="n">&#39;configured&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="err">$</span><span class="n">CONF</span><span class="o">[</span><span class="n">&#39;postfix_admin_url&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/postfixadmin&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="err">$</span><span class="n">CONF</span><span class="o">[</span><span class="n">&#39;database_type&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;mysqli&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="err">$</span><span class="n">CONF</span><span class="o">[</span><span class="n">&#39;database_host&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;localhost&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="err">$</span><span class="n">CONF</span><span class="o">[</span><span class="n">&#39;database_user&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;vmail&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="err">$</span><span class="n">CONF</span><span class="o">[</span><span class="n">&#39;database_password&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;vmail&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="err">$</span><span class="n">CONF</span><span class="o">[</span><span class="n">&#39;database_name&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;vmail&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="err">$</span><span class="n">CONF</span><span class="o">[</span><span class="n">&#39;domain_path&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;YES&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="err">$</span><span class="n">CONF</span><span class="o">[</span><span class="n">&#39;domain_in_mailbox&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="err">$</span><span class="n">CONF</span><span class="o">[</span><span class="n">&#39;encrypt&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;dovecot:CRAM-MD5&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="err">$</span><span class="n">CONF</span><span class="o">[</span><span class="n">&#39;emailcheck_resolve_domain</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;NO&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w"> </span><span class="err">$</span><span class="n">CONF</span><span class="o">[</span><span class="n">&#39;dovecotpw&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;/usr/bin/doveadm pw&quot;</span><span class="p">;</span><span class="w"></span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="c1"># 新建PostfixAdmin数据库,启动MySql服务</span>
service mysqld start

进入MySql命令工具，默认的MySql用户root的密码是空的
mysql -u root -p

mysql&gt; CREATE DATABASE vmail<span class="p">;</span>
mysql&gt; GRANT ALL PRIVILEGES ON vmail.* TO <span class="s1">&#39;vmail&#39;</span>@<span class="s1">&#39;localhost&#39;</span> IDENTIFIED BY <span class="s1">&#39;vmail&#39;</span><span class="p">;</span>
mysql&gt; flush privileges<span class="p">;</span>
mysql&gt; <span class="se">\q</span>
touch /postfixadmin/DATABASE_MYSQL.TXT
mysql -uvmail -p vmail &lt; /postfixadmin/DATABASE_MYSQL.TXT
如果显示ACCESS DENIY, mysql -u vmail -p vmail
mysql&gt; <span class="nb">set</span> <span class="nv">password</span> <span class="o">=</span> password <span class="o">(</span><span class="s1">&#39;newpassword&#39;</span><span class="o">)</span>


配置PostfixAdmin网页管理应用

安装网页程序apache, 默认是已安装的，所以这你可以省了，你可以先查看一下，是否有安装，再决定
rpm -qa<span class="p">|</span>grep httpd      <span class="c1">#查看是否安装</span>
yum install httpd -y    <span class="c1">#安装</span>
新建网页索引文件
vim /etc/httpd/conf.d/postfixadmin.conf
Alias /postfixadmin /postfixadmin
启动Apache服务
service httpd start
POSTFIX的虚拟用户MYSQL设置和sasl设置

建立邮件目录和管理用户

useradd -u <span class="m">1000</span> -d /vmail -s /sbin/nologin vmail
mkdir /vmail
chmod <span class="m">770</span> /vmail/
chown vmail:vmail /vmail/
vim /etc/postfix/main.cf  加入如下设置

<span class="c1">######################Virtual Settings##########################</span>
<span class="nv">virtual_mailbox_domains</span> <span class="o">=</span> proxy:mysql:/etc/postfix/mysql_virtual_domains_maps.cf
<span class="nv">virtual_alias_maps</span> <span class="o">=</span> proxy:mysql:/etc/postfix/mysql_virtual_alias_maps.cf
<span class="nv">virtual_mailbox_maps</span> <span class="o">=</span> proxy:mysql:/etc/postfix/mysql_virtual_mailbox_maps.cf
<span class="nv">virtual_mailbox_base</span> <span class="o">=</span> /vmail
<span class="nv">virtual_minimum_uid</span> <span class="o">=</span> <span class="m">1000</span>
<span class="nv">virtual_uid_maps</span> <span class="o">=</span> static:1000
<span class="nv">virtual_gid_maps</span> <span class="o">=</span> static:1000
<span class="nv">virtual_transport</span> <span class="o">=</span> dovecot
<span class="c1">#####################SASL Settings###############################</span>
<span class="nv">smtpd_sasl_type</span> <span class="o">=</span> dovecot
<span class="nv">smtpd_sasl_path</span> <span class="o">=</span> private/auth
<span class="nv">smtpd_sasl_auth_enable</span> <span class="o">=</span> yes
<span class="nv">smtpd_sasl_security_options</span> <span class="o">=</span> noanonymous
<span class="nv">broken_sasl_auth_clients</span> <span class="o">=</span> yes
<span class="nv">smtpd_recipient_restrictions</span> <span class="o">=</span> permit_mynetworks,
                             permit_sasl_authenticated,
                             reject_non_fqdn_hostname,
                             reject_non_fqdn_sender,
                             reject_non_fqdn_recipient,
                             reject_unknown_sender_domain,
                             reject_unknown_recipient_domain,
                             reject_unauth_pipelining,
                             reject_unauth_destination,
                             reject_invalid_hostname
<span class="c1">###################Mail Quota Settings###############################</span>
<span class="nv">message_size_limit</span> <span class="o">=</span> <span class="m">204800000</span>
<span class="nv">maximal_queue_lifetime</span> <span class="o">=</span> 1d
<span class="nv">bounce_queue_lifetime</span> <span class="o">=</span> 1d
vim /etc/postfix/master.cf  最后行加入，flages 前一定要有两个空格哦
dovecot unix -  n  n  -  -  pipe
  <span class="nv">flags</span><span class="o">=</span>DRhu <span class="nv">user</span><span class="o">=</span>vmail:vmail <span class="nv">argv</span><span class="o">=</span>/usr/libexec/dovecot/deliver -d <span class="si">${</span><span class="nv">recipient</span><span class="si">}</span>
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># vim /etc/postfix/mysql_virtual_domains_maps.cf</span>
<span class="nv">user</span> <span class="o">=</span> vmail
<span class="nv">password</span> <span class="o">=</span> vmail
<span class="nv">hosts</span> <span class="o">=</span> localhost
<span class="nv">dbname</span> <span class="o">=</span>vmail
<span class="nv">table</span> <span class="o">=</span> domain
<span class="nv">select_field</span> <span class="o">=</span> domain
<span class="nv">where_field</span> <span class="o">=</span> domain
<span class="nv">additional_conditions</span> <span class="o">=</span> and <span class="nv">backupmx</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> and <span class="nv">active</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># vim /etc/postfix/mysql_virtual_alias_maps.cf</span>
<span class="nv">user</span> <span class="o">=</span> vmail
<span class="nv">password</span> <span class="o">=</span> vmail
<span class="nv">hosts</span> <span class="o">=</span> localhost
<span class="nv">dbname</span> <span class="o">=</span> vmail
<span class="nv">table</span> <span class="o">=</span> <span class="nb">alias</span>
<span class="nv">select_field</span> <span class="o">=</span> goto
<span class="nv">where_field</span> <span class="o">=</span> address
<span class="nv">additonal_conditions</span> <span class="o">=</span> and <span class="nv">active</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># vim /etc/postfix/mysql_virtual_mailbox_maps.cf</span>
<span class="nv">user</span> <span class="o">=</span> vmail
<span class="nv">password</span> <span class="o">=</span> vmail
<span class="nv">hosts</span> <span class="o">=</span>localhost
<span class="nv">dbname</span> <span class="o">=</span> vmail
<span class="nv">table</span> <span class="o">=</span> mailbox
<span class="nv">select_field</span> <span class="o">=</span> CONCAT<span class="o">(</span>domain,<span class="s1">&#39;/&#39;</span>,maildir<span class="o">)</span>
<span class="nv">where_field</span> <span class="o">=</span>username
<span class="nv">additional_conditions</span> <span class="o">=</span> and <span class="nv">active</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
vim /etc/postfix/mysql_virtual_mailbox_limit_maps.cf
<span class="nv">user</span> <span class="o">=</span> vmail
password vmail
<span class="nv">hosts</span> <span class="o">=</span> localhost
<span class="nv">dbname</span><span class="o">=</span> vmail
<span class="nv">table</span> <span class="o">=</span> mailbox
<span class="nv">select_field</span> <span class="o">=</span> quota
<span class="nv">where_field</span> <span class="o">=</span> username
<span class="nv">additional_conditions</span> <span class="o">=</span> and <span class="nv">active</span> <span class="o">=</span><span class="s1">&#39;1&#39;</span>
DOVECOT收信和SMTPD认证

<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># vim /etc/dovecot/dovecot.conf 修改如下选项</span>
<span class="nv">protocols</span> <span class="o">=</span> imap pop3 lmtp
<span class="nv">listen</span> <span class="o">=</span> *
<span class="nv">base_dir</span> <span class="o">=</span> /var/run/dovecot/
<span class="c1">#first_valid_uid = 89</span>
<span class="c1">#last_valid_uid = 89</span>
<span class="c1">#maildir_copy_with_hardlinks = yes</span>
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># vim /etc/dovecot/conf.d/10-auth.conf  修改如下选项</span>
<span class="nv">disable_plaintext_auth</span> <span class="o">=</span> no
<span class="nv">auth_mechanisms</span> <span class="o">=</span> plain login cram-md5
!include auth-sql.conf.ext
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># vim /etc/dovecot/conf.d/10-master.conf   修改如下选项</span>
unix_listener /var/spool/postfix/private/auth <span class="o">{</span>
  <span class="nv">mode</span> <span class="o">=</span> <span class="m">0666</span>
  <span class="nv">user</span> <span class="o">=</span> vmail
  <span class="nv">group</span> <span class="o">=</span> vmail
<span class="o">}</span>
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># vim /etc/dovecot/conf.d/10-mail.conf 修改如下选项</span>
<span class="nv">mail_location</span> <span class="o">=</span> maildir:/vmail/%u/Maildir
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># vim /etc/dovecot/conf.d/15-lda.conf  修改如下选项</span>
protocol lda <span class="o">{</span>
  <span class="nv">postmaster_address</span> <span class="o">=</span> postmaster@dggd.com
  <span class="nv">sendmail_path</span> <span class="o">=</span> /usr/lib/sendmail
  <span class="nv">auth_socket_path</span> <span class="o">=</span> /var/run/dovecot/auth-master
<span class="o">}</span>
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># vim /etc/dovecot/conf.d/20-pop3.conf  修改如下选项</span>
<span class="nv">pop3_uidl_format</span> <span class="o">=</span> %08Xu%08Xv
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># vim /etc/dovecot/conf.d/auth-sql.conf.ext  修改如下选项</span>
passdb <span class="o">{</span>
  <span class="nv">driver</span> <span class="o">=</span> sql
  <span class="nv">args</span> <span class="o">=</span> /etc/dovecot/dovecot-sql.conf.ext
<span class="o">}</span>
userdb <span class="o">{</span>
  <span class="nv">driver</span> <span class="o">=</span> sql
  <span class="nv">args</span> <span class="o">=</span> /etc/dovecot/dovecot-sql.conf.ext
<span class="o">}</span>
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># vim /etc/dovecot/dovecot-sql.conf.ext</span>
<span class="nv">driver</span> <span class="o">=</span> mysql
<span class="nv">connect</span> <span class="o">=</span> <span class="nv">host</span><span class="o">=</span>localhost <span class="nv">dbname</span><span class="o">=</span>vmail <span class="nv">user</span><span class="o">=</span>vmail <span class="nv">password</span><span class="o">=</span>vmail
<span class="nv">default_pass_scheme</span> <span class="o">=</span> PLAIN-MD5
<span class="nv">password_query</span> <span class="o">=</span> SELECT username as user, password, <span class="s1">&#39;/vmail/%d/%n&#39;</span> as userdb_home, <span class="s1">&#39;maildir:/vmail/%d/%n/Maildir&#39;</span> as userdb_mail, <span class="m">1000</span> as userdb_uid, <span class="m">1000</span> as userdb_gid FROM mailbox WHERE <span class="nv">username</span> <span class="o">=</span> <span class="s1">&#39;%u&#39;</span> AND <span class="nv">active</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
<span class="nv">user_query</span> <span class="o">=</span> SELECT <span class="s1">&#39;/vmail/%d/%n&#39;</span> as home, <span class="s1">&#39;maildir:/vmail/%d/%n/Maildir&#39;</span> as mail, <span class="m">1000</span> AS uid, <span class="m">1000</span> AS gid, concat<span class="o">(</span><span class="s1">&#39;dirsize:storage=&#39;</span>, quota<span class="o">)</span> AS quota FROM mailbox WHERE <span class="nv">username</span> <span class="o">=</span> <span class="s1">&#39;%u&#39;</span> AND <span class="nv">active</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
改文件权限
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># chmod 600 /etc/dovecot/* -R</span>
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># chown vmail /etc/dovecot/* -R</span>
<span class="o">[</span>root@mail ~<span class="o">]</span><span class="c1"># chomd 777 /var/run/dovecot/auth-master</span>
打开PostfixAdmin管理界面 http://localhost/postfixadmin/setup.php 填写安装密码
复制产生出来的安装密码写入到主配置文件/postfixadmin/config.inc.php的<span class="nv">$CONF</span><span class="o">[</span><span class="s1">&#39;setup_password&#39;</span><span class="o">]</span> <span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span> 然后设置超级管理员和密码
接着成功的登陆PostfixAdmin管理你的邮件帐户
RoundCube网页访问客户端
下载解压改名，放入网页引导路径

下载
wget http://sourceforge.net/projects/roundcubemail/files/roundcubemail/1.0.3/roundcubemail-1.0.3.tar.gz/download
解压
tar -zxvf roundcubemail-1.0.3.tar.gz
放入网页引导路径
cp roundcubemail-1.0.3 /var/www/html/ -R
改名
mv /var/www/html/roundcubemail-1.0.3 /var/www/html/usermail
Apache添加php模块

vim /etc/httpd/conf/httpd.conf 添加下面两行
  AddType application/x-httpd-php .php
  PHPIniDir <span class="s2">&quot;/etc/php.ini&quot;</span>
添加PHP模块时间区域

vim /etc/php.ini 添加下面一行
   date.timezone <span class="o">=</span> Asia/Shanghai
修改权限
chmod <span class="m">777</span> /var/www/html/usermail/temp
chmod <span class="m">777</span> /var/www/html/usermail/logs
chmod <span class="m">777</span> /var/www/html/usermail/config -R
chmod <span class="m">777</span> /var/lib/php/session -R
配置CONFIG文件与postfixadmin连接同一个数据库

启用CONFIG文件
cp /var/www/html/usermail/config/config.inc.php.sample  /var/www/html/usermail/config/config.inc.php
改写MYSQL数据查询与POSTFIXADMIN一样
vim /var/www/html/usermail/config/config.inc.php 修改下面一行
  <span class="nv">$config</span><span class="o">[</span><span class="s1">&#39;db_dsnw&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;mysql://vmail:vmail@localhost/vmail&#39;</span><span class="p">;</span>
  <span class="nv">$config</span><span class="o">[</span><span class="s1">&#39;enable_installer&#39;</span><span class="o">]</span> <span class="o">=</span> true<span class="p">;</span>
安装PHP-DOM
yum install php53-dom
yum -y install php-dom
网页配置
 <span class="m">1</span>: http://域名或IP/usermail/installer 打开IE，点击NEXT<span class="o">(</span>下一步<span class="o">)</span>
 <span class="m">2</span>: Create config，设置你的配置文件，显示/服务器名/网络/数据库连接<span class="o">(</span>与postfixadmin相同数据<span class="o">)</span>..等等。自己揣摸
 <span class="m">3</span>: TEST CONFIG
  出现如下NOT OK.数据库没有初始化
    Check DB config
    DSN <span class="o">(</span>write<span class="o">)</span>:  OK
    DB Schema:  NOT OK<span class="o">(</span>Database not initialized<span class="o">)</span>
 点击 Initialize Database, 初始化数据，它会返回结果OK
    Check DB config
    DSN <span class="o">(</span>write<span class="o">)</span>:  OK
    DB Schema:  OK
    DB Write:  OK
    DB Time:  OK
  输入POSTFIXADMIN建的邮件地址测试SMTP和IMAP.会返回结果OK

  完成了，http://域名或IP/usermail

***
***
***
&lt;h1 <span class="nv">style</span><span class="o">=</span><span class="s2">&quot;text-align:center&quot;</span>&gt;OPENWEBMAIL网页邮件架设&lt;/h1&gt;

<span class="c1"># 安装前提：yum –y install perl-suidperl perl-Compress-Zlib perl-Text-Iconv或yum install -y perl*</span>

如果PERL-TEST-ICOV 安装失败，请参照如下去下载:
wget http://openwebmail.org/openwebmail/download/redhat/rpm/packages/centos5/perl-Text-Iconv/i386/perl-Text-Iconv-1.7-2.el5.i386.rpm

安装：rpm -ivh perl-Text-Iconv-1.7-2.el5.i386.rpm
检查是否安装成功： rpm –qa <span class="p">|</span>grep perl-

安装APACHE: Yum –y install httpd
进入YUM源目录：cd /etc/yum.repos.d
下载Yum源：wpget http://openwebmail.org/openwebmail/download/redhat/rpm/release/openwebmail.repo
在线安装：Yum –y install openwebmail
离线安装：http://openwebmail.org/openwebmail/download/release/openwebmail-2.53.tar.gz

<span class="c1"># 修改配置文件：</span>
vim /var/www/cgi-bin/openwebmail/etc/default/dbm.conf
vim /var/www/cgi-bin/openwebmail/etc/dbm.conf
dbm_ext                 .pag
dbmopen_ext             none
dbmopen_haslock         yes
smtpserver                  <span class="m">192</span>.168.222.41
<span class="nb">cd</span> /var/www/cgi-bin/openwebmail/
./openwebmail-tool.pl –-init

<span class="c1"># 测试</span>
IE访问：http://mail.davis.dg/cgi-bin/openwebmail/openwebmail.pl

<span class="c1"># POSTFIX邮件恢复</span>
例如：恢复“DNS”邮件目录
从邮件服务器backup目录/restore/davis_dai找到要恢复的
<span class="nb">cd</span> /restore/davis_dai/Maildir

drwx—— <span class="m">5</span> davis_dai <span class="m">2000</span> <span class="m">4</span>.0K Nov <span class="m">14</span> <span class="m">14</span>:36 .Boss

drwx—— <span class="m">5</span> davis_dai <span class="m">2000</span> <span class="m">4</span>.0K Oct <span class="m">8</span> <span class="m">2012</span> .Deleted Items

drwx—— <span class="m">5</span> davis_dai <span class="m">2000</span> <span class="m">4</span>.0K May <span class="m">6</span> <span class="m">09</span>:12 .Deleted Messages

drwx—— <span class="m">5</span> davis_dai users <span class="m">4</span>.0K Nov <span class="m">14</span> <span class="m">14</span>:36 .DNS

cp -a .DNS /home/davis_dai/Maildir

Fix the permission chown davis_dai /home/davis_dai/Maildir/.DNS -R

sendmail安装
ftp://ftp.sendmail.org/pub/sendmail/sendmail.8.15.2.tar.gz
</pre></div>

<h2 id="shell">shell脚本笔记<a class="headerlink" href="#shell" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><span class="c1"># 删除0字节文件</span>
find -type f -size <span class="m">0</span> -exec rm -rf <span class="o">{}</span> <span class="se">\;</span>

<span class="c1"># 查看进程</span>
按内存从大到小排列
ps -e  -o <span class="s2">&quot;%C  : %p : %z : %a&quot;</span><span class="p">|</span>sort -k5 -nr

<span class="c1"># 按cpu利用率从大到小排列</span>
ps -e  -o <span class="s2">&quot;%C  : %p : %z : %a&quot;</span><span class="p">|</span>sort  -nr

<span class="c1"># 打印cache里的URL</span>
grep -r -a  jpg /data/cache/* <span class="p">|</span> strings <span class="p">|</span> grep <span class="s2">&quot;http:&quot;</span> <span class="p">|</span> awk -F<span class="s1">&#39;http:&#39;</span> <span class="s1">&#39;{print &quot;http:&quot;$2;}&#39;</span>

<span class="c1"># 查看http的并发请求数及其TCP连接状态：</span>
netstat -n <span class="p">|</span> awk <span class="s1">&#39;/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}&#39;</span>

<span class="c1"># sed在这个文里Root的一行，匹配Root一行，将no替换成yes</span>
sed -i <span class="s1">&#39;/Root/s/no/yes/&#39;</span> /etc/ssh/sshd_config

<span class="c1"># 如何杀掉mysql进程：</span>
ps aux<span class="p">|</span>grep mysql<span class="p">|</span>grep -v grep<span class="p">|</span>awk <span class="s1">&#39;{print $2}&#39;</span><span class="p">|</span>xargs <span class="nb">kill</span> -9
<span class="o">(</span>从中了解到awk的用途<span class="o">)</span>
pgrep mysql <span class="p">|</span>xargs <span class="nb">kill</span> -9

killall -TERM mysqld
<span class="nb">kill</span> -9 <span class="sb">`</span>cat /usr/local/apache2/logs/httpd.pid<span class="sb">`</span>
试试查杀进程PID

<span class="c1"># 显示运行3级别开启的服务:</span>
ls /etc/rc3.d/S* <span class="p">|</span>cut -c <span class="m">15</span>-
<span class="o">(</span>从中了解到cut的用途，截取数据<span class="o">)</span>

<span class="c1"># 如何在编写SHELL显示多个信息，用EOF</span>
cat <span class="s">&lt;&lt;EOF   ##开始</span>
<span class="s">+--------------------------------------------------------------+</span>
<span class="s">|         === Welcome to Tunoff services ===                   |</span>
<span class="s">+--------------------------------------------------------------+</span>
<span class="s">EOF</span>
<span class="c1">##结束</span>

<span class="c1"># for 的巧用(如给mysql建软链接)</span>
<span class="nb">cd</span> /usr/local/mysql/bin
<span class="k">for</span> i in *
<span class="k">do</span> ln /usr/local/mysql/bin/<span class="nv">$i</span> /usr/bin/<span class="nv">$i</span>
<span class="k">done</span>

<span class="c1"># 取IP地址：</span>
ifconfig eth0<span class="p">|</span>sed -n <span class="s1">&#39;2p&#39;</span><span class="p">|</span>awk <span class="s1">&#39;{print $2}&#39;</span><span class="p">|</span>cut -c <span class="m">6</span>-30
或者:
ifconfig eth0 <span class="p">|</span>grep <span class="s2">&quot;inet addr:&quot;</span> <span class="p">|</span>awk <span class="s1">&#39;{print $2}&#39;</span><span class="p">|</span>cut -c <span class="m">6</span>-
或者
ifconfig  <span class="p">|</span> grep <span class="s1">&#39;inet addr:&#39;</span><span class="p">|</span> grep -v <span class="s1">&#39;127.0.0.1&#39;</span> <span class="p">|</span> cut -d: -f2 <span class="p">|</span> awk <span class="s1">&#39;{ print $1}&#39;</span>
或者：
ifconfig eth0 <span class="p">|</span> sed -n <span class="s1">&#39;/inet /{s/.*addr://;s/ .*//;p}&#39;</span>
Perl实现获取IP的方法:
ifconfig -a <span class="p">|</span> perl -ne <span class="s1">&#39;if ( m/^\s*inet (?:addr:)?([\d.]+).*?cast/ ) { print qq($1\n); exit 0; }&#39;</span>

<span class="c1"># 内存的大小:</span>
free -m <span class="p">|</span>grep <span class="s2">&quot;Mem&quot;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span>

<span class="c1"># 查看连接某服务端口最多的的IP地址</span>
netstat -an -t <span class="p">|</span> grep <span class="s2">&quot;:80&quot;</span> <span class="p">|</span> grep ESTABLISHED <span class="p">|</span> awk <span class="s1">&#39;{printf &quot;%s %s\n&quot;,$5,$6}&#39;</span> <span class="p">|</span> sort

<span class="c1"># 查看Apache的并发请求数及其TCP连接状态：</span>
netstat -n <span class="p">|</span> awk <span class="s1">&#39;/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}&#39;</span>

<span class="c1"># 因为同事要统计一下服务器下面所有的jpg的文件的大小,写了个shell给他来统计.原来用xargs实现,但他一次处理一部分,搞的有多个总和....,下面的命令就能解决啦</span>
find / -name *.jpg -exec wc -c <span class="o">{}</span> <span class="se">\;</span><span class="p">|</span>awk <span class="s1">&#39;{print $1}&#39;</span><span class="p">|</span>awk <span class="s1">&#39;{a+=$1}END{print a}&#39;</span>
CPU的数量（多核算多个CPU，
cat /proc/cpuinfo <span class="p">|</span>grep -c processor
）越多，系统负载越低，每秒能处理的请求数也越多

<span class="c1"># CPU负载</span>
cat /proc/loadavg
检查前三个输出值是否超过了系统逻辑CPU的4倍

mpstat <span class="m">1</span> <span class="m">1</span>
检查%idle是否过低<span class="o">(</span>比如小于5%<span class="o">)</span>

<span class="c1"># 内存空间 # free</span>
检查free值是否过低  也可以用
cat /proc/meminfo

<span class="c1"># swap空间  # free</span>
检查swap used值是否过高  如果swap used值过高，进一步检查swap动作是否频繁：
vmstat <span class="m">1</span> <span class="m">5</span>
观察si和so值是否较大

<span class="c1"># 磁盘空间  # df -h</span>
检查是否有分区使用率<span class="o">(</span>Use%<span class="o">)</span>过高<span class="o">(</span>比如超过90%<span class="o">)</span>  如发现某个分区空间接近用尽，可以进入该分区的挂载点，用以下命令找出占用空间最多的文件或目录：
du -cks * <span class="p">|</span> sort -rn <span class="p">|</span> head -n <span class="m">10</span>

<span class="c1"># 磁盘I/O负载  # iostat -x 1 2</span>
检查I/O使用率<span class="o">(</span>%util<span class="o">)</span>是否超过100%

<span class="c1"># 网络负载  # sar -n DEV</span>
检查网络流量<span class="o">(</span>rxbyt/s, txbyt/s<span class="o">)</span>是否过高

<span class="c1"># 网络错误  # netstat -i</span>
检查是否有网络错误<span class="o">(</span>drop fifo colls carrier<span class="o">)</span>  也可以用命令：
cat /proc/net/dev

<span class="c1"># 网络连接数目</span>
netstat -an <span class="p">|</span> grep -E “^<span class="o">(</span>tcp<span class="o">)</span>” <span class="p">|</span> cut -c <span class="m">68</span>- <span class="p">|</span> sort <span class="p">|</span> uniq -c <span class="p">|</span> sort -n

<span class="c1"># 进程总数  # ps aux | wc -l</span>
检查进程个数是否正常 <span class="o">(</span>比如超过250<span class="o">)</span>

<span class="c1"># 可运行进程数目</span>
列给出的是可运行进程的数目，检查其是否超过系统逻辑CPU的4倍

<span class="c1"># 用户</span>
who <span class="p">|</span> wc -l
检查登录用户是否过多 <span class="o">(</span>比如超过50个<span class="o">)</span>
也可以用命令：uptime

<span class="c1"># 系统日志</span>
cat /var/log/rflogview/*errors
检查是否有异常错误记录  也可以搜寻一些异常关键字，例如：
grep -i error /var/log/messages
grep -i fail /var/log/messages
egrep -i <span class="s1">&#39;error|warn&#39;</span> /var/log/messages 查看系统异常

<span class="c1"># 打开文件数目</span>
lsof <span class="p">|</span> wc -l
检查打开文件总数是否过多

<span class="c1"># 杀掉80端口相关的进程</span>
lsof -i :80<span class="p">|</span>grep -v <span class="s2">&quot;PID&quot;</span><span class="p">|</span>awk <span class="s1">&#39;{print &quot;kill -9&quot;,$2}&#39;</span><span class="p">|</span>sh

<span class="c1"># 清除僵死进程</span>
ps -eal <span class="p">|</span> awk <span class="s1">&#39;{ if ($2 == &quot;Z&quot;) {print $4}}&#39;</span> <span class="p">|</span> <span class="nb">kill</span> -9

<span class="c1"># tcpdump 抓包 ，用来防止80端口被人攻击时可以分析数据</span>
tcpdump -c <span class="m">10000</span> -i eth0 -n dst port <span class="m">80</span> &gt; /root/pkts

<span class="c1"># 然后检查IP的重复数 并从小到大排序 注意 &quot;-t\ +0&quot;  中间是两个空格</span>
less pkts <span class="p">|</span> awk <span class="o">{</span><span class="s1">&#39;printf $3&quot;\n&quot;&#39;</span><span class="o">}</span> <span class="p">|</span> cut -d. -f <span class="m">1</span>-4 <span class="p">|</span> sort <span class="p">|</span> uniq -c <span class="p">|</span> awk <span class="o">{</span><span class="s1">&#39;printf $1&quot; &quot;$2&quot;\n&quot;&#39;</span><span class="o">}</span> <span class="p">|</span> sort -n -t<span class="se">\ </span>+0

<span class="c1"># 查看有多少个活动的php-cgi进程</span>
netstat -anp <span class="p">|</span> grep php-cgi <span class="p">|</span> grep ^tcp <span class="p">|</span> wc -l

<span class="c1"># 利用iptables对应简单攻击</span>
netstat -an <span class="p">|</span> grep -v LISTEN <span class="p">|</span> awk ‘<span class="o">{</span>print <span class="nv">$5</span><span class="o">}</span>’ <span class="p">|</span>grep -v <span class="m">127</span>.0.0.1<span class="p">|</span>grep -v 本机ip<span class="p">|</span>sed  “s/::ffff://g”<span class="p">|</span>awk ‘BEGIN <span class="o">{</span> <span class="nv">FS</span><span class="o">=</span>”:” <span class="o">}</span> <span class="o">{</span> Num<span class="o">[</span><span class="nv">$1</span><span class="o">]</span>++ <span class="o">}</span> END <span class="o">{</span> <span class="k">for</span><span class="o">(</span>i in Num<span class="o">)</span> <span class="k">if</span><span class="o">(</span>Num&gt;8<span class="o">)</span> <span class="o">{</span> print i<span class="o">}</span> <span class="o">}</span>’ <span class="p">|</span>grep ‘<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span><span class="se">\{</span><span class="m">1</span>,3<span class="se">\}\.</span><span class="o">[</span><span class="m">0</span>-9<span class="o">]</span><span class="se">\{</span><span class="m">1</span>,3<span class="se">\}\.</span><span class="o">[</span><span class="m">0</span>-9<span class="o">]</span><span class="se">\{</span><span class="m">1</span>,3<span class="se">\}\.</span><span class="o">[</span><span class="m">0</span>-9<span class="o">]</span><span class="se">\{</span><span class="m">1</span>,3<span class="se">\}</span>’<span class="p">|</span>  xargs -i<span class="o">[]</span> iptables -I INPUT -s <span class="o">[]</span> -j DROP
Num&gt;8部分设定值为阀值，这条句子会自动将netstat -an 中查到的来自同一ip的超过一定量的连接的列入禁止范围。   基中本机ip改成你的服务器的ip地址

<span class="c1"># 怎样知道某个进程在哪个CPU上运行？</span>
ps -eo pid,args,psr

<span class="c1"># 查看硬件制造商</span>
dmidecode -s system-product-name

<span class="c1"># perl如何编译成字节码，这样在处理复杂项目的时候会更快一点？</span>
perlcc -B -o webseek webseek.pl

<span class="c1"># 统计var目录下文件以M为大小,以列表形式列出来</span>
find /var -type f <span class="p">|</span> xargs ls -s <span class="p">|</span> sort -rn <span class="p">|</span> awk <span class="s1">&#39;{size=$1/1024; printf(&quot;%dMb %s\n&quot;, size,$2);}&#39;</span> <span class="p">|</span> head

<span class="c1"># 查找var目录下文件大于100M的文件，并统计文件的个数</span>
find /var -size +100M -type f <span class="p">|</span> tee file_list <span class="p">|</span> wc -l

<span class="c1"># sed 查找并替换内容</span>
sed -i <span class="s2">&quot;s/varnish/LTCache/g&quot;</span> <span class="sb">`</span>grep <span class="s2">&quot;Via&quot;</span> -rl /usr/local/src/varnish-2.0.4<span class="sb">`</span>
sed -i <span class="s2">&quot;s/X-Varnish/X-LTCache/g&quot;</span> <span class="sb">`</span>grep <span class="s2">&quot;X-Varnish&quot;</span> -rl /usr/local/src/varnish-2.0.4<span class="sb">`</span>

<span class="c1"># 查看服务器制造商</span>
dmidecode -s system-product-name

<span class="c1"># wget 模拟user-agent抓取网页</span>
wget -m -e <span class="nv">robots</span><span class="o">=</span>off -U <span class="s2">&quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6&quot;</span> http://www.example.com/

<span class="c1"># 统计目录下文件的大小（按M打印显示）</span>
du <span class="nv">$1</span> --max-depth<span class="o">=</span><span class="m">1</span> <span class="p">|</span> sort -n<span class="p">|</span>awk <span class="s1">&#39;{printf &quot;%7.2fM ----&gt; %s\n&quot;,$1/1024,$2}&#39;</span><span class="p">|</span>sed <span class="s1">&#39;s:/.*/\([^/]\{1,\}\)$:\1:g&#39;</span>

<span class="c1"># 关于CND实施几个相关的统计</span>
统计一个目录中的目录个数
ls -l <span class="p">|</span> awk <span class="s1">&#39;/^d/&#39;</span> <span class="p">|</span> wc -l
统计一个目录中的文件个数
ls -l <span class="p">|</span> awk <span class="s1">&#39;/^-/&#39;</span> <span class="p">|</span> wc -l
统计一个目录中的全部文件数
find ./ -type f -print <span class="p">|</span> wc -l
统计一个目录中的全部子目录数
find ./ -type d -print <span class="p">|</span> wc -l
统计某类文件的大小:
find ./ -name <span class="s2">&quot;*.jpg&quot;</span> -exec wc -c <span class="o">{}</span> <span class="se">\;</span><span class="p">|</span>awk <span class="s1">&#39;{print $1}&#39;</span><span class="p">|</span>awk <span class="s1">&#39;{a+=$1}END{print a}&#39;</span>

<span class="c1"># 查找占用磁盘IO最多的进程</span>
wget -c http://linux.web.psi.ch/dist/scientific/5/gfa/all/dstat-0.6.7-1.rf.noarch.rpm
dstat -M topio -d -M topbio

<span class="c1"># 去掉第一列（如行号代码）</span>
awk <span class="s1">&#39;{for(i=2;i&lt;=NF;i++) if(i!=NF){printf $i&quot; &quot;}else{print $i} }&#39;</span> list

<span class="c1"># 输出256中色彩</span>
<span class="k">for</span>
i in <span class="o">{</span><span class="m">0</span>..255<span class="o">}</span><span class="p">;</span> <span class="k">do</span> <span class="nb">echo</span> -e <span class="s2">&quot;\e[38;05;</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="s2">m</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span> <span class="k">done</span> <span class="p">|</span> column -c <span class="m">80</span> -s <span class="s1">&#39; &#39;</span><span class="p">;</span> <span class="nb">echo</span> -e <span class="s2">&quot;\e[m&quot;</span>

<span class="c1"># 查看机器支持内存</span>
机器插内存情况：
dmidecode <span class="p">|</span>grep -P <span class="s2">&quot;Maximum\s+Capacity&quot;</span>
机器最大支持内存：
dmidecode <span class="p">|</span>grep -P <span class="s2">&quot;Maximum\s+Capacity&quot;</span>

<span class="c1"># 查看PHP-CGI占用的内存总数：</span>
<span class="nv">total</span><span class="o">=</span><span class="m">0</span><span class="p">;</span> <span class="k">for</span> i in <span class="sb">`</span>ps -C php-cgi -o <span class="nv">rss</span><span class="o">=</span><span class="sb">`</span><span class="p">;</span> <span class="k">do</span> <span class="nv">total</span><span class="o">=</span><span class="k">$((</span><span class="nv">$total</span><span class="o">+</span><span class="nv">$i</span><span class="k">))</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">&quot;PHP-CGI Memory usage: </span><span class="nv">$total</span><span class="s2"> kb&quot;</span>
如果希望在成功地执行一个命令之后再执行另一个命令，或者在一个命令失败后再执行另一个命令，<span class="o">&amp;&amp;</span>和<span class="o">||</span>可以完成这样的功能。相应的命令可以是系统命令或shell脚本
Shell还提供了在当前shell或子shell中执行一组命令的方法，即使用（）和<span class="o">{}</span>

<span class="c1"># 杀掉hello这个进程，使用下面这个命令就能直接实现</span>
ps -ef <span class="p">|</span>grep hello <span class="p">|</span>awk <span class="s1">&#39;{print $2}&#39;</span><span class="p">|</span>xargs <span class="nb">kill</span> -9

<span class="c1"># 使用&amp;&amp;</span>
使用<span class="o">&amp;&amp;</span>的一般形式为：
命令1 <span class="o">&amp;&amp;</span> 命令2
这种命令执行方式相当地直接。<span class="o">&amp;&amp;</span>左边的命令（命令1）返回真<span class="o">(</span>即返回0，成功被执行）后，<span class="o">&amp;&amp;</span>右边的命令（命令2）才能够被执行；换句话说，“如果这个命令执行成功<span class="o">&amp;&amp;</span>那么执行这个命令”
这里有一个使用<span class="o">&amp;&amp;</span>的简单例子：
cp justing.doc justing.bak  <span class="o">&amp;&amp;</span> <span class="nb">echo</span> “if you are seeing this <span class="k">then</span> cp was OK”
<span class="k">if</span> you are seeing this <span class="k">then</span> cp  was OK
在上面的例子中，<span class="o">&amp;&amp;</span>前面的拷贝命令执行成功，所以<span class="o">&amp;&amp;</span>后面的命令（echo命令）被执行
再看一个更为实用的例子：
mv /apps/bin /apps/dev/bin  <span class="o">&amp;&amp;</span> rm -r /apps/bin
在上面的例子中，/apps/bin目录将会被移到/apps/dev/bin目录下，如果它没有被成功执行，就不会删除/apps/bin目录
在下面的例子中，文件quarter_end.txt首先将被排序并输出到文件quarter.sorted中，只有这一命令执行成功之后，文件quarter.sorted才会被打印出来：
sort quarter_end.txt &gt;  quarter.sorted <span class="o">&amp;&amp;</span> lp quarter.sorted
</pre></div>

<h3 id="_14">杀死进程命令例子<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>pgrep firefox <span class="p">|</span> xargs <span class="nb">kill</span> -s <span class="m">9</span>
<span class="nb">kill</span> -s <span class="m">9</span> <span class="sb">`</span>pgrep firefox<span class="sb">`</span>
pkill -9 firefox
killall -9 firefox（完整进程名称）
</pre></div>

<h3 id="_15">统计并杀死僵尸进程例子<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>统计僵尸进程数目
ps -ef <span class="p">|</span> grep defunct <span class="p">|</span> grep -v grep <span class="p">|</span> wc -l
或
ps -eo ppid,stat <span class="p">|</span> grep Z <span class="p">|</span> wc -l

杀死僵尸进程
ps -eo ppid,stat <span class="p">|</span> grep Z <span class="p">|</span> cut -d” ” -f2 <span class="p">|</span> xargs <span class="nb">kill</span> -9
或
<span class="nb">kill</span> -HUP <span class="sb">`</span>ps -A -ostat,ppid <span class="p">|</span> grep -e ’^<span class="o">[</span>Zz<span class="o">]</span>‘ <span class="p">|</span> awk ’<span class="o">{</span>print <span class="nv">$2</span><span class="o">}</span>’<span class="sb">`</span>
或
ps -A -ostat,ppid <span class="p">|</span> awk <span class="s1">&#39;/[zZ]/{print $2}&#39;</span>
或
<span class="nb">kill</span> <span class="k">$(</span>ps -A -ostat,ppid <span class="p">|</span> awk <span class="s1">&#39;/[zZ]/{print $2}&#39;</span> <span class="p">|</span> sort -u<span class="k">)</span>
</pre></div>

<h3 id="rss">进程按rss排序<a class="headerlink" href="#rss" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>ps p <span class="m">22763</span>  -L -o pcpu,pid,tid,time,tname,cmd,pmem,rss --sort rss
</pre></div>

<h3 id="1pcputid">进程按第1列pcpu排序、tid为线程号<a class="headerlink" href="#1pcputid" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>ps p <span class="m">26653</span> -L -o pcpu,tid <span class="p">|</span>sort -k1 -r -n<span class="p">|</span>less
</pre></div>

<h3 id="_16">按进程消耗内存多少排序<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>ps -eo rss,pmem,pcpu,vsize,args <span class="p">|</span> sort -k <span class="m">1</span> -r -n <span class="p">|</span> less

命令解释：
ps是linux,unix显示进程信息的, -e 是显示所有进程, -o是定制显示信息的格式

rss: resident <span class="nb">set</span> size, 表示进程占用RAM<span class="o">(</span>内存<span class="o">)</span>的大小，单位是KB

pmem: %M, 占用内存的百分比

pcpu：%C，占用cpu的百分比

vsize:表示进程占用的虚拟内存的大小，KB

args：进程名<span class="o">(</span><span class="nb">command</span><span class="o">)</span>

sort命令对ps结果进行排序

-k1 :按第一个参数 rss进行排序

-r：逆序

-n：numeric，按数字来排序
</pre></div>

<p>ps -mp pid -o THREAD,tid,time
其次将需要的线程ID转换为16进制格式：
printf "%x\n" tid
打印线程的堆栈信息：
jstack pid |grep tid -A 30</p>
<div class="codehilite"><pre><span></span>由于ps的输出是按PID号的顺序显示的，若要实现按照某一项使用量排序，需要把某项放入最前面

<span class="o">(</span>按照内存使用量从大到小排序<span class="o">)</span>
ps -auxww<span class="p">|</span>awk <span class="s1">&#39;{print $5,$1,$11}&#39;</span><span class="p">|</span>sort -r<span class="p">|</span>more

按虚拟内存从大到小排列进程:
ps -eo <span class="s2">&quot;%C%p%z%a&quot;</span><span class="p">|</span>sort -k3 -nr

按实际使用内存百分比排序
ps -eo user,pid,size,pmem,vsize,command<span class="p">|</span>sort -k4 -nr<span class="p">|</span>more

查看并发访问用户的前10位
netstat -anp<span class="p">|</span>grep <span class="m">80</span><span class="p">|</span>grep ESTAB<span class="p">|</span>awk <span class="s1">&#39;{print $5}&#39;</span><span class="p">|</span>awk -F <span class="s1">&#39;:&#39;</span> <span class="s1">&#39;{print $1}&#39;</span><span class="p">|</span>sort <span class="p">|</span>uniq -c<span class="p">|</span>sort -rn<span class="p">|</span>head -n <span class="m">10</span>

对cpu访问量高进程排序
ps -eo user,pid,size,pmem,vsize,command,%cpu<span class="p">|</span>sort -k7 -nr<span class="p">|</span>more<span class="sb">`</span>

杀死某一进程,杀死Nginx进程<span class="o">(</span>杀死某一进程<span class="o">)</span>
ps -ef<span class="p">|</span>grep -v grep <span class="p">|</span>grep nginx<span class="p">|</span>awk <span class="s1">&#39;{print $2}&#39;</span>
或
<span class="k">for</span> i in <span class="sb">`</span>ps aux <span class="p">|</span> grep nginx <span class="p">|</span> grep -v grep <span class="p">|</span> awk <span class="o">{</span><span class="s1">&#39;print $2&#39;</span><span class="o">}</span><span class="sb">`</span> <span class="p">;</span> <span class="k">do</span> <span class="nb">kill</span> <span class="nv">$i</span><span class="p">;</span> <span class="k">done</span>

清空Linux Buffer Cache
sync <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="m">3</span> &gt; /proc/sys/vm/drop_caches
</pre></div>

<h3 id="linux_6">Linux中查看所有正在运行的进程<a class="headerlink" href="#linux_6" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>ps aux或ps -ef
任务：查看系统中的每个进程
ps -A
ps -e
任务：查看非root运行的进程
ps -U root -u root -N
任务：查看用户vivek运行的进程
ps -u vivek
top命令提供了运行中系统的动态实时视图。在命令提示行中输入top：
top
pstree以树状显示正在运行的进程。树的根节点为pid或init。如果指定了用户名，进程树将以用户所拥有的进程作为根节点
pstree
任务：使用ps列印进程树
ps -ejH
ps axjf
任务：获得线程信息
输入下列命令：
ps -eLf
ps axms
任务：获得安全信息
输入下列命令：
ps -eo euser,ruser,suser,fuser,f,comm,label
ps axZ
ps -eM
任务：将进程快照储存到文件中。输入下列命令：
top -b -n1 &gt; /tmp/process.log
你也可以将结果通过邮件发给自己：
top -b -n1 <span class="p">|</span> mail -s <span class="s1">&#39;Process snapshot&#39;</span> you@example.com
任务：查找进程
使用pgrep命令。pgrep能查找当前正在运行的进程并列出符合条件的进程ID。例如显示firefox的进程ID：
pgrep firefox
下面命令将显示进程名为sshd、所有者为root的进程
pgrep -u root sshd
</pre></div>

<h3 id="linux-vmware-tools">Linux VMware Tools安装步骤简易版<a class="headerlink" href="#linux-vmware-tools" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="m">1</span>. 在CD-ROM虚拟光驱中选择使用ISO镜像，这个ISO是你安装VMware workstation 的目录下的Linux.iso，不是你的Linux OS 镜像文件。VMware Tools一般都在这个文件里
<span class="m">2</span>. 以管理员身份进入Linux，root账号
<span class="m">3</span>. 挂载光驱：执行mount /dev/cdrom /mnt/cdrom，这时如果进入/mnt 目录下，你会发现一个文件：VMwareTools-8.8.4-743747.tar.gz 有的虚拟机上估计如果提示如下错误，挂载点不存在。，
mount /dev/cdrom /mnt/cdrom
mount: mount point /mnt/cdrom dose not exist
请直接执行此命令：
mount /dev/cdrom /opt
<span class="nb">cd</span> /opt
或者应该可以使用自动挂载，直接进入
<span class="nb">cd</span> /misc/cd
<span class="m">4</span>. copy 此文件到临时文件夹
cp /mnt/mVMwareTools-8.8.4-743747.tar.gz /tmp
<span class="m">5</span>. 卸载CDROM，执行 umount /dev/cdrom
<span class="m">6</span>. 进入tmp文件目录并解压此文件包
<span class="nb">cd</span> /tmp
tar zxvf vmware-linux-tools.tar.gz
解压默认到vmware-tools-distrib目录下：此时你可以使用ls -ll 查看文件夹下的文件
<span class="m">7</span>. 进入vmware-tools-distrib，安装vmware tools
./vmware-install.pl  执行安装，
<span class="m">8</span>. 大约5分钟左右安装完成。 执行init 6重启ok
利用xshell的MODEM传输文件需安装lrzsz
</pre></div>

<h3 id="rm">恢复rm误删的文件<a class="headerlink" href="#rm" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>一、下载及安装软件
extundelete 主页：http://extundelete.sourceforge.net/
下载地址：http://nchc.dl.sourceforge.net/project/extundelete/extundelete/0.2.0/extundelete-0.2.0.tar.bz2
ubuntu用户可直接安装: apt-get install extundelete
./configure <span class="o">&amp;&amp;</span> make <span class="o">&amp;&amp;</span> make install    <span class="c1"># 如果提示找不到ext2fs库，使用 yum -y install e2fsprogs* 安装</span>
二、数据恢复
<span class="m">1</span>.卸载需要恢复文件的分区
fuser -k /mnt/test/               &lt;-- 结束使用某分区的进程树
umount /mnt/test                  &lt;-- 卸载分区
<span class="m">2</span>.使用extundelete查看分区上存在的文件
extundelete --inode <span class="m">2</span> /dev/sdb1    <span class="c1"># --inode 为查找某i节点中的内容，使用2则说明为搜索，如果需要进入目录搜索，只须要指定目录I节点即可</span>
extundelete --restore-inode <span class="m">13</span> /dev/sdb1    <span class="c1"># --restore-inode 恢复指定的I节点文件，默认全将恢复出来的文件放在当前路径 RECOVERED_FILES/ 目录下，文件名为 file.I节点号</span>
ls RECOVERED_FILES/
mount /dev/sdb1 /mnt/test/
mv RECOVERED_FILES/file.13 /mnt/test/resolv.conf
mv RECOVERED_FILES/file.14 /mnt/test/hosts
cat /mnt/test/hosts            <span class="c1"># 查看被恢复出来的文件 是否与源文件一致</span>
cat /mnt/test/resolv.conf
</pre></div>

<h3 id="linux_7">linux常用日志文件默认路径<a class="headerlink" href="#linux_7" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>IP登录日志默认路径：/var/log/wtmp
命令：last -f /var/log/wtmp
</pre></div>

<h3 id="1gswap">增加1G的swap空间<a class="headerlink" href="#1gswap" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="c1">#创建1G文件</span>
dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/opt/swap <span class="nv">bs</span><span class="o">=</span>1k <span class="nv">count</span><span class="o">=</span><span class="m">1024000</span>
mkswap /opt/swap    <span class="c1"># 将创建的文件用作交换分区</span>
swapon /opt/swap    <span class="c1"># 开启swap</span>
</pre></div>

<h3 id="linux_8">Linux备份<a class="headerlink" href="#linux_8" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>系统的潜在威胁
<span class="m">1</span>，系统硬件故障
<span class="m">2</span>，软件故障
<span class="m">3</span>，电源故障
<span class="m">4</span>，用户的误操作
<span class="m">5</span>，人为破坏
<span class="m">6</span>，缓存中的内容没有及时的写入磁盘
<span class="m">7</span>，自然灾害

备份介质的选择：
硬盘（文件存储服务器），光盘，磁带机，可移动存储设备
备注：一般在选择备份介质时，要从可靠性，速度和介质价格之间进行权衡

Linux备份策略：

<span class="m">1</span>.完全备份
    每隔一段时间对系统进行一次完全的备份，这样在备份时间间隔内，一旦系统发生了故障使得数据丢失时，就可以用上一次的备份数据恢复得到上一次备份时的情况

<span class="m">2</span>.增量备份:
     首先进行一次完全备份，然后每隔一段较短的时间进行一次备份，但是仅仅备份每个短时间内更改或者更新的内容

备份过程中考虑的因素：
<span class="m">1</span>，备份
<span class="m">2</span>，备份分区，ro,umount直接不挂载
<span class="m">3</span>, 压缩 bzip2
<span class="m">4</span>, 校验 md5sum -c
<span class="m">5</span>, 加密 GnupG

备份常用的指令：
备份目录：cp -Rpu 备份目录  目标目录
-p保持备份目录及文件的属性（默认的属性）
-u增量备份

案例:
mount -o remount,ro /backup
cp /etc/inittab /backup/inittab_20130511.bak <span class="c1">#出现报错信息</span>
mount -o  remount,rw /backup#解决问题的命令，亦可读写的方式挂载

<span class="c1">#远程备份可用SCP命令</span>

tar备份命令：
首先，备份/etc目录，可同时打包多个目录
tar -zcf /backup/sys_20130510.tar.gz /etc /boot

如何对/etc目录下指定文件进行备份？
tar -zcf backup_user_20130510.tar.gz /etc/passed /etc/shadow /etc/group /etc/gshadow

如何查看查看备份包文件？
tar -ztf /backup/user_20130510.tar.gz

如何恢复/etc目录？
tar -zxf /backup/sys_20130510.tar.gz
备注：默认还原到打包文件源目录，-C选项可以指定具体的还原目录

只恢复备份中的指定文件
tar -zxf backup_user_20130510.tar.gz /etc/passwd

备注：在备份过程中添加时间值是非常有必要额
</pre></div>

<h3 id="linux_9">Linux测试硬盘读写速度<a class="headerlink" href="#linux_9" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>time有计时作用，dd用于复制，从if读出，写到of。if<span class="o">=</span>/dev/zero不产生IO，因此可以用来测试纯写速度。同理of<span class="o">=</span>/dev/null不产生IO，可以用来测试纯读速度。bs是每次读或写的大小，即一个块的大小，count是读写块的数量

<span class="m">1</span>.测/目录所在磁盘的纯写速度：
<span class="nb">time</span> dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">bs</span><span class="o">=</span><span class="m">1024</span> <span class="nv">count</span><span class="o">=</span><span class="m">1000000</span> <span class="nv">of</span><span class="o">=</span>/1Gb.file

<span class="m">2</span>.测/目录所在磁盘的纯读速度：
dd <span class="k">if</span><span class="o">=</span>/kvm/ftp/other/1Gb.file <span class="nv">bs</span><span class="o">=</span>64k <span class="p">|</span>dd <span class="nv">of</span><span class="o">=</span>/dev/null

<span class="m">3</span>.测读写速度（这是什么）：
dd <span class="k">if</span><span class="o">=</span>/vat/test <span class="nv">of</span><span class="o">=</span>/oradata/test1 <span class="nv">bs</span><span class="o">=</span>64k

理论上复制量越大测试越准确
</pre></div>

<h3 id="8">获取8位随机字符串<a class="headerlink" href="#8" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>方法一：echo <span class="nv">$RANDOM</span> <span class="p">|</span>md5sum <span class="p">|</span>cut -c <span class="m">1</span>-8
方法二：openssl rand -base64 <span class="m">4</span>
方法三：cat /proc/sys/kernel/random/uuid <span class="p">|</span>cut -c <span class="m">1</span>-8
</pre></div>

<h3 id="8_1">获取8位随机数字<a class="headerlink" href="#8_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>方法一：echo <span class="nv">$RANDOM</span> <span class="p">|</span>cksum <span class="p">|</span>cut -c <span class="m">1</span>-8
方法二：openssl rand -base64 <span class="m">4</span> <span class="p">|</span>cksum <span class="p">|</span>cut -c <span class="m">1</span>-8
方法三：date +%N <span class="p">|</span>cut -c <span class="m">1</span>-8
cksum:打印CRC校检和统计字节
</pre></div>

<h3 id="_17">定义一个颜色输出字符串函数<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>方法一：
<span class="k">function</span> echo_color<span class="o">(){</span>
 <span class="k">if</span> <span class="o">[</span><span class="nv">$1</span> <span class="o">==</span> <span class="s2">&quot;green&quot;</span><span class="o">]</span><span class="p">;</span><span class="k">then</span>
  <span class="nb">echo</span> -e <span class="s2">&quot;\033[32;40m</span><span class="nv">$2</span><span class="s2">\033[0m&quot;</span>
 <span class="k">elif</span> <span class="o">[</span><span class="nv">$1</span> <span class="o">==</span> <span class="s2">&quot;red&quot;</span><span class="m">0</span><span class="o">]</span><span class="p">;</span><span class="k">then</span>
  <span class="nb">echo</span> -e <span class="s2">&quot;\\033[31;40m</span><span class="nv">$2</span><span class="s2">\033[0m&quot;</span>
 <span class="k">fi</span>
<span class="o">}</span>

方法二：
<span class="k">function</span> echo_color<span class="o">(){</span>
 <span class="k">case</span> <span class="nv">$1</span> in
  green<span class="o">)</span>
   <span class="nb">echo</span> -e <span class="s2">&quot;\033[32;40m</span><span class="nv">$2</span><span class="s2">\033[0m&quot;</span>
   <span class="p">;;</span>
  red<span class="o">)</span>
   <span class="nb">echo</span> -e <span class="s2">&quot;\033[31;40m</span><span class="nv">$2</span><span class="s2">\033[0m&quot;</span>
   <span class="p">;;</span>
  *<span class="o">)</span>
   <span class="nb">echo</span> <span class="s2">&quot;Example:echo_color red string&quot;</span>
  <span class="k">esac</span>
<span class="o">}</span>
function关键字定义一个函数，可加或不加
</pre></div>

<h3 id="_18">批量创建用户<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span>date+%F_%T<span class="k">)</span>
<span class="nv">USER_FILE</span><span class="o">=</span>user.txt
echo_color<span class="o">(){</span>
 <span class="k">if</span> <span class="o">[</span><span class="nv">$1</span> <span class="o">==</span> <span class="s2">&quot;green&quot;</span><span class="o">]</span><span class="p">;</span><span class="k">then</span>
  <span class="nb">echo</span> -e <span class="s2">&quot;\033[32;40m</span><span class="nv">$2</span><span class="s2">\033[0m&quot;</span>
 <span class="k">elif</span> <span class="o">[</span><span class="nv">$1</span> <span class="o">==</span> <span class="s2">&quot;red&quot;</span><span class="m">0</span><span class="o">]</span><span class="p">;</span><span class="k">then</span>
  <span class="nb">echo</span> -e <span class="s2">&quot;\\033[31;40m</span><span class="nv">$2</span><span class="s2">\033[0m&quot;</span>
 <span class="k">fi</span>
<span class="o">}</span>
<span class="c1"># 如果用户文件存在并大于0就备份</span>
 <span class="k">if</span> <span class="o">[</span>-s <span class="nv">$USER_FILE</span><span class="o">]</span><span class="p">;</span><span class="k">then</span>
  mv <span class="nv">$USER_FILE</span> <span class="si">${</span><span class="nv">USER_FILE</span><span class="si">}</span>-<span class="si">${</span><span class="nv">DATE</span><span class="si">}</span>.bak
  echo_color green <span class="s2">&quot;</span><span class="nv">$USER_FILE</span><span class="s2"> exist,rename </span><span class="si">${</span><span class="nv">USER_FILE</span><span class="si">}</span><span class="s2">-</span><span class="si">${</span><span class="nv">DATE</span><span class="si">}</span><span class="s2">.bak&quot;</span>
 <span class="k">fi</span>
 <span class="nb">echo</span>
</pre></div>

<h3 id="bash_1">简单检测某个进程是否存在的bash小脚本。代码如下<a class="headerlink" href="#bash_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nv">ps_out</span><span class="o">=</span><span class="sb">`</span>ps -ef <span class="p">|</span> grep <span class="nv">$1</span> <span class="p">|</span> grep -v <span class="s1">&#39;grep&#39;</span> <span class="p">|</span> grep -v <span class="nv">$0</span><span class="sb">`</span>
<span class="nv">result</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$ps_out</span> <span class="p">|</span> grep <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="k">)</span>
<span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$result</span><span class="s2">&quot;</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span><span class="p">;</span><span class="k">then</span>
 <span class="nb">echo</span> <span class="s2">&quot;Running&quot;</span>
<span class="k">else</span>
 <span class="nb">echo</span> <span class="s2">&quot;Not Running&quot;</span>
<span class="k">fi</span>
举例使用
比如我们启动了进程SimpleHTTPServer,我们想检测这个进程是否存在，可以这样
代码如下:
<span class="c1"># ./checkRunningProcess.sh &#39;SimpleHTTPServer&#39; Running</span>
</pre></div>

<h3 id="shell_1">shell变量的子串的删除/替换<a class="headerlink" href="#shell_1" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="si">${#</span><span class="nv">string</span><span class="si">}</span>返回<span class="nv">$string的长度</span>
<span class="si">${</span><span class="nv">string</span><span class="p">:</span><span class="nv">position</span><span class="si">}</span>在<span class="nv">$string中</span>，从<span class="nv">$position位置之后开始提取子串</span>
<span class="si">${</span><span class="nv">string</span><span class="p">:</span><span class="nv">position</span><span class="p">:</span><span class="nv">length</span><span class="si">}</span>在<span class="nv">$string中</span>，从<span class="nv">$position位置之后开始提取$length长度的子串</span>
<span class="si">${</span><span class="nv">string</span><span class="p">#substring</span><span class="si">}</span>从变量<span class="nv">$string开头开始删除最短匹配$substring子串</span>
<span class="si">${</span><span class="nv">string</span><span class="p">##substring</span><span class="si">}</span>从变量<span class="nv">$string开头开始删除最长匹配$sunstring子串</span>
<span class="si">${</span><span class="nv">string</span><span class="p">%substring</span><span class="si">}</span>从变量<span class="nv">$string结尾开始删除最短匹配$substring子串</span>
<span class="si">${</span><span class="nv">string</span><span class="p">%%substring</span><span class="si">}</span> 从变量<span class="nv">$string结尾开始删除最长匹配$substring子串</span>
注意：在进行#或##匹配时，<span class="nv">$string的首字符必须是被删除子串$substring的第一个字符</span>，不然无法匹配删除
在进行%或者%%匹配时，<span class="nv">$string的最后一个字符必须是被删除子串$substring的最后一个字符</span>，不然无法进行删除操作
<span class="si">${</span><span class="nv">parameter</span><span class="p">/parttern/string</span><span class="si">}</span> 用string来替换第一个匹配的pattern
<span class="si">${</span><span class="nv">parameter</span><span class="p">/#parttern/string</span><span class="si">}</span> 从开头匹配parameter变量中的pattern，匹配上后就用string来替换匹配的pattern
<span class="si">${</span><span class="nv">parameter</span><span class="p">/%pattern/string</span><span class="si">}</span> 从结尾开始匹配parameter变量中的pattern，匹配上后就用string替换匹配的pattern
<span class="si">${</span><span class="nv">parameter</span><span class="p">//pattern/string</span><span class="si">}</span> 用string来替换parameter变量中所有匹配的pattern
</pre></div>

<h3 id="5">清除大于5天的文件<a class="headerlink" href="#5" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/sh</span>
find /usr/local/tomcat/logs -name <span class="s1">&#39;catalina.*.log&#39;</span> -mtime +5 -print0 <span class="p">|</span> xargs -0 rm -f
find /usr/local/tomcat/logs -name <span class="s1">&#39;localhost_access_log.*.txt&#39;</span> -mtime +5 -print0 <span class="p">|</span> xargs -0 rm -f
</pre></div>

<h3 id="shellcpu">shell采集系统cpu 内存 磁盘 网络信息<a class="headerlink" href="#shellcpu" title="Permanent link">&para;</a></h3>
<h3 id="cpu">cpu信息采集<a class="headerlink" href="#cpu" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>cpu使用率采集算法
通过/proc/stat文件采集并计算CPU总使用率或者单个核使用率。以cpu0为例，算法如下：
<span class="m">1</span>. cat /proc/stat <span class="p">|</span> grep ‘cpu0’得到cpu0的信息
<span class="m">2</span>. <span class="nv">cpuTotal1</span><span class="o">=</span>user+nice+system+idle+iowait+irq+softirq
<span class="m">3</span>. <span class="nv">cpuUsed1</span><span class="o">=</span>user+nice+system+irq+softirq
<span class="m">4</span>. sleep 30秒
<span class="m">5</span>. 再次cat /proc/stat <span class="p">|</span> grep ‘cpu0’ 得到cpu的信息
<span class="m">6</span>. <span class="nv">cpuTotal2</span><span class="o">=</span>user+nice+system+idle+iowait+irq+softirq
<span class="m">7</span>. <span class="nv">cpuUsed2</span><span class="o">=</span>user+nice+system+irq+softirq
<span class="m">8</span>. 得到cpu0 在30秒内的单核利用率：<span class="o">(</span>cpuUsed2 – cpuUsed1<span class="o">)</span> * <span class="m">100</span> / <span class="o">(</span>cpuTotal2 – cpuTotal1<span class="o">)</span>
相当于使用top –d 30命令，把user、nice、system、irq、softirq五项的使用率相加

shell代码：

<span class="nv">a</span><span class="o">=(</span><span class="sb">`</span>cat /proc/stat <span class="p">|</span> grep -E <span class="s2">&quot;cpu\b&quot;</span> <span class="p">|</span> awk -v <span class="nv">total</span><span class="o">=</span><span class="m">0</span> <span class="s1">&#39;{$1=&quot;&quot;;for(i=2;i&lt;=NF;i++){total+=$i};used=$2+$3+$4+$7+$8 }END{print total,used}&#39;</span><span class="sb">`</span><span class="o">)</span>
sleep <span class="m">30</span>
<span class="nv">b</span><span class="o">=(</span><span class="sb">`</span>cat /proc/stat <span class="p">|</span> grep -E <span class="s2">&quot;cpu\b&quot;</span> <span class="p">|</span> awk -v <span class="nv">total</span><span class="o">=</span><span class="m">0</span> <span class="s1">&#39;{$1=&quot;&quot;;for(i=2;i&lt;=NF;i++){total+=$i};used=$2+$3+$4+$7+$8 }END{print total,used}&#39;</span><span class="sb">`</span><span class="o">)</span>
<span class="nv">cpu_usage</span><span class="o">=(((</span><span class="si">${</span><span class="nv">b</span><span class="p">[1]</span><span class="si">}</span>-<span class="si">${</span><span class="nv">a</span><span class="p">[1]</span><span class="si">}</span><span class="o">)</span>*100/<span class="o">(</span><span class="si">${</span><span class="nv">b</span><span class="p">[0]</span><span class="si">}</span>-<span class="si">${</span><span class="nv">a</span><span class="p">[0]</span><span class="si">}</span><span class="o">)))</span>

cpu负载
采集算法：
读取/proc/loadavg得到机器的1/5/15分钟平均负载，再乘以100

shell代码：

<span class="nv">cpuload</span><span class="o">=(</span><span class="sb">`</span>cat /proc/loadavg <span class="p">|</span> awk <span class="s1">&#39;{print $1,$2,$3}&#39;</span><span class="sb">`</span><span class="o">)</span>
<span class="nv">load1</span><span class="o">=</span><span class="si">${</span><span class="nv">cpuload</span><span class="p">[0]</span><span class="si">}</span>
<span class="nv">load5</span><span class="o">=</span><span class="si">${</span><span class="nv">cpuload</span><span class="p">[1]</span><span class="si">}</span>
<span class="nv">load15</span><span class="o">=</span><span class="si">${</span><span class="nv">cpuload</span><span class="p">[2]</span><span class="si">}</span>
</pre></div>

<h3 id="_19">内存采集<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>应用程序使用内存采集算法：
读取/proc/meminfo文件，<span class="o">(</span>MemTotal – MemFree – Buffers – Cached<span class="o">)</span>/1024得到应用程序使用内存数

shell代码：

awk <span class="s1">&#39;/MemTotal/{total=$2}/MemFree/{free=$2}/Buffers/{buffers=$2}/^Cached/{cached=$2}END{print (total-free-buffers-cached)/1024}&#39;</span>  /proc/meminfo

MEM使用量采集算法：
读取/proc/meminfo文件，MemTotal – MemFree得到MEM使用量

shell代码：

awk <span class="s1">&#39;/MemTotal/{total=$2}/MemFree/{free=$2}END{print (total-free)/1024}&#39;</span>  /proc/meminfo

SWAP使用大小采集算法：
通过/proc/meminfo文件，SwapTotal – SwapFree得到SWAP使用大小

shell代码：

awk <span class="s1">&#39;/SwapTotal/{total=$2}/SwapFree/{free=$2}END{print (total-free)/1024}&#39;</span>  /proc/meminfo
</pre></div>

<h3 id="_20">磁盘信息采集<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>disk io

<span class="m">1</span>、IN：平均每秒把数据从硬盘读到物理内存的数据量
采集算法：
读取/proc/vmstat文件得出最近240秒内pgpgin的增量，把pgpgin的增量再除以240得到每秒的平均增量
相当于vmstat 240命令bi一列的输出

shell代码：

<span class="nv">a</span><span class="o">=</span><span class="sb">`</span>awk <span class="s1">&#39;/pgpgin/{print $2}&#39;</span> /proc/vmstat<span class="sb">`</span>
sleep <span class="m">240</span>
<span class="nv">b</span><span class="o">=</span><span class="sb">`</span>awk <span class="s1">&#39;/pgpgin/{print $2}&#39;</span> /proc/vmstat<span class="sb">`</span>
<span class="nv">ioin</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span>b-a<span class="o">)/</span><span class="m">240</span><span class="k">))</span>

<span class="m">2</span>、OUT：平均每秒把数据从物理内存写到硬盘的数据量
采集算法：
读取/proc/vmstat文件得出最近240秒内pgpgout的增量，把pgpgout的增量再除以240得到每秒的平均增量
相当于vmstat 240命令bo一列的输出

shell代码：

<span class="nv">a</span><span class="o">=</span><span class="sb">`</span>awk <span class="s1">&#39;/pgpgout/{print $2}&#39;</span> /proc/vmstat<span class="sb">`</span>
sleep <span class="m">240</span>
<span class="nv">b</span><span class="o">=</span><span class="sb">`</span>awk <span class="s1">&#39;/pgpgout/{print $2}&#39;</span> /proc/vmstat<span class="sb">`</span>
<span class="nv">ioout</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span>b-a<span class="o">)/</span><span class="m">240</span><span class="k">))</span>
</pre></div>

<h3 id="_21">网络信息采集<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>流量

以https://www.centos.bz/为例，eth0是内网，eth1外网，获取60秒的流量
机器网卡的平均每秒流量
采集算法：
读取/proc/net/dev文件，得到60秒内发送和接收的字节数（KB），然后乘以8，再除以60，得到每秒的平均流量

shell代码：

<span class="nv">traffic_be</span><span class="o">=(</span><span class="sb">`</span>awk -F<span class="s1">&#39;[: ]+&#39;</span> <span class="s1">&#39;BEGIN{ORS=&quot; &quot;}/eth0/{print $3,$10}/eth1/{print $3,$11}&#39;</span> /proc/net/dev<span class="sb">`</span><span class="o">)</span>
sleep <span class="m">60</span>
<span class="nv">traffic_af</span><span class="o">=(</span><span class="sb">`</span>awk -F<span class="s1">&#39;[: ]+&#39;</span> <span class="s1">&#39;BEGIN{ORS=&quot; &quot;}/eth0/{print $3,$10}/eth1/{print $3,$11}&#39;</span> /proc/net/dev<span class="sb">`</span><span class="o">)</span>
<span class="nv">eth0_in</span><span class="o">=</span><span class="k">$((</span> <span class="o">(</span><span class="si">${</span><span class="nv">traffic_af</span><span class="p">[0]</span><span class="si">}</span><span class="o">-</span><span class="si">${</span><span class="nv">traffic_be</span><span class="p">[0]</span><span class="si">}</span><span class="o">)/</span><span class="m">60</span> <span class="k">))</span>
<span class="nv">eth0_out</span><span class="o">=</span><span class="k">$((</span> <span class="o">(</span><span class="si">${</span><span class="nv">traffic_af</span><span class="p">[1]</span><span class="si">}</span><span class="o">-</span><span class="si">${</span><span class="nv">traffic_be</span><span class="p">[1]</span><span class="si">}</span><span class="o">)/</span><span class="m">60</span> <span class="k">))</span>
<span class="nv">eth1_in</span><span class="o">=</span><span class="k">$((</span> <span class="o">(</span><span class="si">${</span><span class="nv">traffic_af</span><span class="p">[2]</span><span class="si">}</span><span class="o">-</span><span class="si">${</span><span class="nv">traffic_be</span><span class="p">[2]</span><span class="si">}</span><span class="o">)/</span><span class="m">60</span> <span class="k">))</span>
<span class="nv">eth1_out</span><span class="o">=</span><span class="k">$((</span> <span class="o">(</span><span class="si">${</span><span class="nv">traffic_af</span><span class="p">[3]</span><span class="si">}</span><span class="o">-</span><span class="si">${</span><span class="nv">traffic_be</span><span class="p">[3]</span><span class="si">}</span><span class="o">)/</span><span class="m">60</span> <span class="k">))</span>

包量

机器网卡的平均每秒包量
采集算法：
读取/proc/net/dev文件，得到60秒内发送和接收的包量，然后除以60，得到每秒的平均包量

shell代码：

<span class="nv">packet_be</span><span class="o">=(</span><span class="sb">`</span>awk -F<span class="s1">&#39;[: ]+&#39;</span> <span class="s1">&#39;BEGIN{ORS=&quot; &quot;}/eth0/{print $4,$12}/eth1/{print $4,$12}&#39;</span> /proc/net/dev<span class="sb">`</span><span class="o">)</span>
sleep <span class="m">60</span>
<span class="nv">packet_af</span><span class="o">=(</span><span class="sb">`</span>awk -F<span class="s1">&#39;[: ]+&#39;</span> <span class="s1">&#39;BEGIN{ORS=&quot; &quot;}/eth0/{print $4,$12}/eth1/{print $4,$12}&#39;</span> /proc/net/dev<span class="sb">`</span><span class="o">)</span>
<span class="nv">eth0_in</span><span class="o">=</span><span class="k">$((</span> <span class="o">(</span><span class="si">${</span><span class="nv">packet_af</span><span class="p">[0]</span><span class="si">}</span><span class="o">-</span><span class="si">${</span><span class="nv">packet_be</span><span class="p">[0]</span><span class="si">}</span><span class="o">)/</span><span class="m">60</span> <span class="k">))</span>
<span class="nv">eth0_out</span><span class="o">=</span><span class="k">$((</span> <span class="o">(</span><span class="si">${</span><span class="nv">packet_af</span><span class="p">[1]</span><span class="si">}</span><span class="o">-</span> <span class="si">${</span><span class="nv">packet_be</span><span class="p">[1]</span><span class="si">}</span><span class="o">)/</span><span class="m">60</span> <span class="k">))</span>
<span class="nv">eth1_in</span><span class="o">=</span><span class="k">$((</span> <span class="o">(</span><span class="si">${</span><span class="nv">packet_af</span><span class="p">[2]</span><span class="si">}</span><span class="o">-</span> <span class="si">${</span><span class="nv">packet_be</span><span class="p">[2]</span><span class="si">}</span><span class="o">)/</span><span class="m">60</span> <span class="k">))</span>
<span class="nv">eth1_out</span><span class="o">=</span><span class="k">$((</span> <span class="o">(</span><span class="si">${</span><span class="nv">packet_af</span><span class="p">[3]</span><span class="si">}</span><span class="o">-</span> <span class="si">${</span><span class="nv">packet_be</span><span class="p">[3]</span><span class="si">}</span><span class="o">)/</span><span class="m">60</span> <span class="k">))</span>
</pre></div>

<div class="codehilite"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="c1">#</span>
<span class="c1"># ShowTuxPerf</span>
<span class="c1"># A simple SH to display PC performance on a Linux OS</span>
<span class="c1">#</span>
<span class="c1"># Syntaxe: sudo ./showtuxperf.sh</span>
<span class="c1">#</span>
<span class="c1"># Nicolas Hennion -GPL</span>
<span class="c1">#</span>
<span class="nv">VERSION</span><span class="o">=</span><span class="s2">&quot;0.1&quot;</span>
dmidecode -s system-product-name
dmidecode -s system-version
lscpu - cat /proc/cpuinfo
lspci <span class="p">|</span> grep VGA
uname -a
</pre></div>

<h3 id="shell_2">系统管理的常用shell命令<a class="headerlink" href="#shell_2" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>显示消耗内存/CPU最多的十个进程
ps aux <span class="p">|</span> sort -nk +4 <span class="p">|</span> tail
ps aux <span class="p">|</span> sort -nk +3 <span class="p">|</span> tail

查看linux服务器物理CPU的个数
cat /proc/cpuinfo <span class="p">|</span> grep <span class="s2">&quot;physical id&quot;</span> <span class="p">|</span> sort <span class="p">|</span> uniq  <span class="p">|</span> wc -l

查看linux服务器逻辑CPU的个数
cat /proc/cpuinfo <span class="p">|</span> grep <span class="s2">&quot;processor &quot;</span> <span class="p">|</span> wc -l

精简开机启动服务器
<span class="k">for</span> server in <span class="sb">`</span>chkconfig --list<span class="p">|</span>egrep -v <span class="s1">&#39;crond|network|rsyslog|sshd|iptables&#39;</span><span class="p">|</span>awk <span class="s1">&#39;{print $1}&#39;</span><span class="sb">`</span><span class="p">;</span><span class="k">do</span> chkconfig <span class="nv">$server</span> off<span class="p">;</span> <span class="k">done</span>
关闭selinux
sed -i <span class="s1">&#39;s/SELINUX=enforcing/SELINUX=disabled/&#39;</span> /etc/selinux/config
setenforce <span class="m">0</span>

禁止root用户远程登录
sed -i <span class="s1">&#39;s/#PermitRootLogin yes/PermitRootLogin no/&#39;</span> /etc/ssh/sshd_config

修改最大连接数 ulimit（方法不只一种）
<span class="nb">echo</span> <span class="s1">&#39;* - noproc 65535&#39;</span> &gt;&gt; /etc/security/limits.conf

<span class="nb">echo</span> <span class="s1">&#39;* - nofile 65535&#39;</span> &gt;&gt; /etc/security/limits.conf

修改默认DNS
<span class="nb">echo</span> <span class="s2">&quot;nameserver 8.8.8.8&quot;</span> &gt; /etc/resolv.conf
<span class="nb">echo</span> <span class="s2">&quot;nameserver 8.8.4.4&quot;</span> &gt;&gt; /etc/resolv.conf

去除上次登录的信息
touch ~/.hushlogin

禁止使用Ctrl+Alt+Del快捷键重启服务器
方法一：
      sed -i <span class="s2">&quot;s/start on control-alt-delete/#start on control-alt-delete/g&quot;</span>                   /etc/init/control-alt-delete.conf
方法二：
      vim /etc/inittab
      <span class="c1">#ca::ctrlaltdel:/sbin/shutdown -t3 -r now</span>
      init q  （使用此命令使之生效<span class="o">)</span>

限制用户登录的tty终端
vim /etc/inittab   （在tty终端前加#号，注释掉就可以）

禁止root用户登录的终端
vim /etc/securetty （加#号注释）


禁止除root外的用户从tty1终端登录系统
①   vim /etc/pam.d/login
Account  required  pam_access.so  <span class="o">(</span>增加此认证<span class="o">)</span>
②   vim /etc/security/access.conf
-:ALL EXCEPT root:tty1  <span class="o">(</span>去掉#号<span class="o">)</span>
- : root : <span class="m">192</span>.168.12.0/24  <span class="m">172</span>.16.0.0/8（禁止root用户从这两个网段远程登录）
</pre></div>

<div class="codehilite"><pre><span></span>top -d <span class="m">1</span> -n <span class="m">1</span> -b <span class="p">|</span>awk -F <span class="s1">&#39;[ ,.%k]+&#39;</span> <span class="s1">&#39;/^Cpu/{printf &quot;UPU_USAGE %.f%%\t&quot;,100-$11}/^Mem/{printf &quot;MEM_USAGE %.f%%\n&quot;,($4-$8)/$2*100}&#39;</span>
top -d <span class="m">1</span> -n <span class="m">1</span> -b <span class="p">|</span>awk -F <span class="s1">&#39;[ ,.%k]+&#39;</span> <span class="s1">&#39;/^Cpu/{printf &quot;CPU_USAGE %.f%%\t&quot;,100-$11}/^Mem/{printf &quot;MEM_USAGE %.f%%\t&quot;,($4-$8)/$2*100;now=strftime(&quot;%D %T&quot;);print now}&#39;</span>
</pre></div>

<h2 id="openssl">openssl<a class="headerlink" href="#openssl" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>.key格式：私有的密钥

.csr格式：证书签名请求（证书请求文件），含有公钥信息，certificate signing request的缩写

.crt格式：证书文件，certificate的缩写

.crl格式：证书吊销列表，Certificate Revocation List的缩写

.pem格式：用于导出，导入证书时候的证书的格式，有证书开头，结尾的格式
CA根证书的生成步骤:生成CA私钥（.key）--&gt;生成CA证书请求（.csr）--&gt;自签名得到根证书（.crt）（CA给自已颁发的证书）
openssl genrsa -out ca.key <span class="m">4096</span>   <span class="c1"># 生成ca私钥</span>
openssl req -new -key ca.key -out ca.csr <span class="c1"># 生成csr</span>
openssl x509 -req -days <span class="m">365</span> -in ca.csr -signkey ca.key -out ca.crt  <span class="c1"># 生成ca根证书</span>

用户证书的生成步骤：生成私钥（.key）--&gt;生成证书请求（.csr）--&gt;用CA根证书签名得到证书（.crt）
服务器端用户证书：
<span class="c1"># private key</span>
openssl genrsa -des3 -out server.key <span class="m">1024</span>
<span class="c1"># generate csr</span>
openssl req -new -key server.key -out server.csr
<span class="c1"># generate certificate</span>
openssl ca -in server.csr -out server.crt -cert ca.crt -keyfile ca.key

客户端用户证书：
openssl genrsa -des3 -out client.key <span class="m">1024</span>
openssl req -new -key client.key -out client.csr
openssl ca -in client.csr -out client.crt -cert ca.crt -keyfile ca.key

生成pem格式证书
有时需要用到pem格式的证书，可以用以下方式合并证书文件（crt）和私钥文件（key）来生成
cat client.crt client.key&gt; client.pem
cat server.crt server.key &gt; server.pem
--------------------------------------------
<span class="m">1</span>:写下您的 SSL 证书的公共名称 <span class="o">(</span>CN<span class="o">)</span>。 该公共名称 <span class="o">(</span>CN<span class="o">)</span> 是使用该证书的系统的标准名称。 如果您使用的是动态 DNS，那么 CN 应该具有通配符，例如： *.api.com. 否则，使用网关集群中设置的主机名或 IP 地址
<span class="m">2</span>:生成您的专用密钥和公用证书。回答问题并在出现提示时输入公共名称
openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days <span class="m">365</span> -out certificate.pem
<span class="m">3</span>:检查已创建的证书
openssl x509 -text -noout -in certificate.pem
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Coreos/" title="ContainerOS" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  上一页
                </span>
                ContainerOS
              </span>
            </div>
          </a>
        
        
          <a href="../Utilities/" title="Iproute2&Net-tools" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  下一页
                </span>
                Iproute2&Net-tools
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/Black-Gold" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://www.instagram.com/black0gold/" class="md-footer-social__link fa fa-instagram"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.c648116f.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>